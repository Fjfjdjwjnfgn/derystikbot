// ==UserScript==
// @name         PPF dark bot
// @version      0.6
// @author       Darkness
// @description  Have fun
// @icon         https://raw.githubusercontent.com/TouchedByDarkness/PixelPlanet-Bot/master/rounded-avatar-128.png
// @grant        GM_xmlhttpRequest
// @grant        GM_openInTab
// @grant        unsafeWindow
// @run-at       document-start
// @downloadURL  https://github.com/Fjfjdjwjnfgn/derystikbot/raw/refs/heads/main/userscript.user.js
// @updateURL    https://github.com/Fjfjdjwjnfgn/derystikbot/raw/refs/heads/main/userscript.user.js
// @connect      black-and-red.space
// @connect      githubusercontent.com
// @connect      github.com
// @connect      backend.wplace.live
// @connect      fuckyouarkeros.fun
// @connect      pixelplanet.fun
// @connect      localhost
// @connect      pixmap.fun
// @connect      pixelya.fun
// @connect      pixelroyal.fun
// @connect      pixvas.fun
// @connect      countrypixel.fun
// @connect      wplace.live
// @connect      pxworld.xyz
// @match        *://*.fuckyouarkeros.fun/*
// @match        *://*.pixelplanet.fun/*
// @match        *://*.localhost/*
// @match        *://*.pixmap.fun/*
// @match        *://*.pixelya.fun/*
// @match        *://*.pixelroyal.fun/*
// @match        *://*.pixvas.fun/*
// @match        *://*.countrypixel.fun/*
// @match        *://*.wplace.live/*
// @match        *://*.pxworld.xyz/*
// ==/UserScript==

function parseVersion(versionString){return versionString.split(".").map(Number)}

function isVersionGreater(version2,version1){const v1=parseVersion(version1);const v2=parseVersion(version2);const maxLength=Math.max(v1.length,v2.length);for(let i=0;i<maxLength;i++){const num1=v1[i]||0;const num2=v2[i]||0;if(num1<num2)return true;if(num1>num2)return false}return false}

unsafeWindow.console.log("fetch remote bot code");
fetch(GM_info.script.updateURL, { headers: { Range: 'bytes=0-512' } })
.then(res => res.text())
.then(code => {
unsafeWindow.console.log("compare remote and installed bot versions");
const lines = code.replaceAll('\r', '').split('\n');
const versionLine = lines.find(line => line.includes('@version'));
const version = versionLine.match(/(\d|\.)+/g)?.pop();
if(version && isVersionGreater(version, GM_info.script.version)) {
unsafeWindow.console.log("update bot by opening github tab");
const tab = GM_openInTab(GM_info.script.updateURL, { active: true });
tab.onclose = () => location.reload();
}
});

const console={log:window.console.debug,warn:window.console.debug,debug:window.console.debug,error:window.console.debug,trace:window.console.trace};window.addEventListener("error",console.debug),(()=>{const t=["void-bot","darkness"];"undefined"==typeof unsafeWindow&&(globalThis.unsafeWindow=globalThis.window),(()=>{async function e(t){return new Promise((e=>{let n=new FileReader;n.onload=async()=>e(n.result),n.readAsDataURL(t)}))}function n(){window.addEventListener("mousemove",(()=>{let t=Et(".coorbox");if(!t)return;let e=bt(t.textContent??"");e&&2===e.length&&qe.emit("change_mouse_position",[e[0],e[1]])}))}function r(t,e){let n=0,r=t,i=3-(r<<1);for(;n<=r;)e(+n,+r),e(+n,-r),e(-n,+r),e(-n,-r),e(+r,+n),e(+r,-n),e(-r,+n),e(-r,-n),i<0?i+=6+(n<<2):(i+=10+(n-r<<2),r--),n++}function i(t){return t[0]|t[1]<<16}function o(t){return[255&t,t>>16]}function a(t){let e=0,n=0;return t.forEach((t=>{e+=t[0],n+=t[1]})),[Math.trunc(e/t.length),Math.trunc(n/t.length)]}function s(t,e){let n={};return e.forEach((e=>{let r=t.get(e[0],e[1]),i=n[r];i||(i=[],n[r]=i),i.push(e)})),n}function l(t){if(t.length<=5)return ir(t);let e=new Map;for(let n=1;n!==t.length;n++)e.set(i(t[n]),n);for(let n=0;n!==t.length-1;n++){let a,s,l=t[n],c=1/0,h=-1;if(1===e.size)a=o(e.keys().next().value);else for(;!a;)h++,r(h,((t,n)=>{let r=[l[0]+t,l[1]+n],o=e.get(i(r));if(void 0!==o){let t=or(l,r);(t<c||t==c&&o<s)&&(c=t,a=r,s=o)}}));e.delete(i(a)),t[n+1]=a}return t}function c(t,e=!1){let n=(t,e)=>Math.floor(Math.random()*(Math.abs(e-t)+1))+t,r=(t,e)=>{let n=t.slice();for(;n.length>1;)n=n.slice(1).map(((t,r)=>[Math.floor((1-e)*n[r][0]+e*t[0]),Math.floor((1-e)*n[r][1]+e*t[1])]));return n[0]},i=(t,e)=>{let n=[];for(let i=0;i<=1;i+=1/e)n.push(r(t,i));return n},o=(t,e,n)=>{let r=0,i=0;for(;0===r;)r=Math.random();for(;0===i;)i=Math.random();let o=Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*i);return o=Math.pow(o/10+.5,n)*(e-t)+t,o},a=(t,e,n,r)=>{let i=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,s=e<r?1:-1,l=i-o,c=[];for(;c.push([t,e]),t!==n||e!==r;){let n=2*l;n>-o&&(l-=o,t+=a),n<i&&(l+=i,e+=s)}return c},s=t=>{let e=[];for(let n=0;n<t.length-1;n++){let r=t[n],i=t[n+1],o=a(r[0],r[1],i[0],i[1]);e.push(...o)}return e},l=[],c=new Set,h=new Set(t.map((t=>`${t[0]},${t[1]}`))),u=0;for(;u<t.length;){let r=n(2,5),a=t.slice(u,u+r),d=a.at(0)[0],p=a.at(0)[1],g=a.at(-1)[0],m=a.at(-1)[1],f=Math.sqrt(gt(d-g)+gt(p-m)),b=i(a,Math.floor(o(7,20,.44))),y=e||f<5?s(b):b;for(let t of y){let e=`${t[0]},${t[1]}`;h.has(e)&&!c.has(e)&&(l.push(t),c.add(e))}u+=r}return l}function h(t){var e=!1,n=null;return function(...r){return e||(e=!0,n=t.apply(this,r)),n}}function u(t){return!("SCRIPT"!==t.tagName||!vi.some((e=>t.innerHTML.includes(e))))&&(t.remove(),!0)}function d(t){Ho=t(Ho)}function p(t){return(Ro||(Ro=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Go(this),e),m(this.request)}:function(...e){return m(t.apply(Go(this),e))}}function g(t){return"function"==typeof t?p(t):(t instanceof IDBTransaction&&function(t){if(Uo.has(t))return;let e=new Promise(((e,n)=>{let r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{e(),r()},o=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)}));Uo.set(t,e)}(t),zo(t,No||(No=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Ho):t)}function m(t){if(t instanceof IDBRequest)return function(t){let e=new Promise(((e,n)=>{let r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{e(m(t.result)),r()},o=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)}));return Fo.set(e,t),e}(t);if(Wo.has(t))return Wo.get(t);let e=g(t);return e!==t&&(Wo.set(t,e),Fo.set(e,t)),e}function f(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Yo.get(e))return Yo.get(e);let n=e.replace(/FromIndex$/,""),r=e!==n,i=Ko.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!$o.includes(n))return;let o=async function(t,...e){let o=this.transaction(t,i?"readwrite":"readonly"),a=o.store;return r&&(a=a.index(e.shift())),(await Promise.all([a[n](...e),i&&o.done]))[0]};return Yo.set(e,o),o}async function*b(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;let n=new Proxy(e,Xo);for(Zo.set(n,e),Fo.set(n,Go(e));e;)yield n,e=await(Vo.get(n)||e.continue()),Vo.delete(n)}function y(t,e){return e===Symbol.asyncIterator&&zo(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&zo(t,[IDBIndex,IDBObjectStore])}function w(t){return t.map((t=>{let e=/(-?\d+)|-/.exec(t);if(null===e)return"";let n=e[0],r=Number(n);return""===n?"":"-"===n?"-":r.toString()}))}function _(){Ls=window.requestAnimationFrame((()=>{document.body.style.filter=`hue-rotate(${Os}deg)`,(Os+=.5)>360&&(Os=0),_()}))}async function v(){async function t(){let t,e=await n();if(!e)return null;try{l||(l=x({api:r,template:e})),t=await l}catch(t){return function(t){ul.setBotStatus("error at targeter creation"),T(t)}(t),l=null,null}return{targeter:t,template:e}}async function n(){let t;try{c||(c=async function(){let t=Un.storage.get("template.x"),e=Un.storage.get("template.y");if(null===t||null===e)throw Gt;let n=await Jo.getTemplate();if(!n)throw Ht;let r=new Xn({name:n.filename,x:t,y:e});return await r.load(n.value),r}()),t=await c}catch(t){return function(t){t===Gt?ul.setBotStatus('fill "x" and "y" fields'):t===Ht?ul.setBotStatus("select template file"):(ul.setBotStatus("error at template creation"),T(t))}(t),c=null,null}if(A("template is loaded"),t.readyState!==Xn.QUANTIZED){let e=performance.now();t.quantize(r.palette),A("template quantized in",((performance.now()-e)/1e3).toFixed(3),"s.")}return t}await async function(){let t=Mn.get("template.src");t&&(await Jo.setTemplate({filename:"template.png",value:t}),Mn.delete("template.src"))}();let{api:r,csa:i}=await async function(){let[t,e]=await ce({func:Yn,maxAttempts:5,delay:1e3,onerror:t=>{ul.setBotStatus("cant create api"),A(t)}});Un.csa=e;let n=new ye(t);return A("api is ready"),ul.setBotStatus("idle"),ul.enableBotInputs(),setInterval((async()=>{ul.setCooldown(n.getCooldown()/1e3)}),110),{api:n,csa:e}}();Un.api=r,Un.csa=i,r.on("place_pixels",(t=>{let e=_t(t);e&&ul.setLastPlaced(e.x,e.y,r.palette.idToRGBA(e.id)??e.id)})),Un.storage.on("debug",(t=>t?C():async function(){kl.off("online",k)}())),Un.storage.get("debug")&&C();let o={worldX:0,worldY:0},a=!1,s=null,l=null,c=null;fl.on("bot_progress_info",(async e=>{let[n,r]=e?[e.errors,e.timeToEnd]:[null,null],i=await t();if(!i)return;let{targeter:o}=i,a=o.countTargets();r&&(r instanceof Array?ul.setBuildPredict(r[0]/1e3,r[1]/1e3):ul.setBuildPredict(r/1e3)),ul.setProgress(n,a)})),fl.on("captcha",(async()=>{s||A("captcha emited but there is no bot instance"),Un.storage.get("stopOnCaptcha")?(await s)?.stop():ul.setBotStatus("captcha"),a||(Ml(),It("you need solve CAPTCHA")),a=!0})),qe.on("change_mouse_position",(([t,e])=>{o.worldX=t,o.worldY=e})),qe.on("change_template_coords_to_mouse",(async()=>{qe.call("change_template_coords",[o.worldX,o.worldY])})),qe.on("change_template_file",(async t=>{(await s)?.works?A("bot is working, reject template change"):(await Jo.setTemplate({filename:t.name,value:await e(t)}),c=null,l=null,s=null)})),qe.on("change_template_coords",(async([t,e])=>{if((await s)?.works)return void A("bot is working, reject coords change");let n=!1;t!==Un.storage.get("template.x")&&(n=!0,Un.storage.set("template.x",t)),e!==Un.storage.get("template.y")&&(n=!0,Un.storage.set("template.y",e)),n&&(ul.setTemplateCoords(t,e),c&&(await c).move(t,e))})),qe.on("change_stop_on_captcha",(async t=>{(await s)?.works?A("bot is working, reject stop on captcha change"):Un.storage.set("stopOnCaptcha",t)})),qe.on("change_strategy",(async t=>{(await s)?.works?A("bot is working, reject strategy change"):(Un.storage.set("strategy",t),A(`change strategy to "${t}"`),l=null,s=null)})),qe.on("change_advanced",(t=>{Un.storage.set("advanced",t)})),qe.on("switch_bot",(async()=>{if(!s){let t=await n();if(!t)return;l||(l=x({api:r,template:t}),await l),s=async function({api:t,targeter:e}){let n=new ml({api:t,targeter:e,solver:null,smartPlace:Un.storage.get("smartPlace")??In});return n.on("bot_progress_info",(t=>fl.emit("bot_progress_info",t))),n.on("captcha",(()=>fl.emit("captcha"))),n.on("start",(()=>ul.disableBotInputs())),n.on("stop",(()=>ul.enableBotInputs())),n}({api:r,targeter:await l}),await s,A("bot instance is ready")}let t=await s;if(t.works)await t.stop(),a=!1;else if(t.idle){ul.setBotStatus("updating workspace..."),await async function(){if(!c)return;let t=r.createWorkspace(...(await c).toArray());r.hasWorkspace(t)||await r.changeWorkspace(t)}();try{ul.setBotStatus("works"),await t.start(),a&&Un.storage.get("stopOnCaptcha")?ul.setBotStatus("idle (captcha)"):ul.setBotStatus("idle")}catch(e){let n=e;e===ge.errMustAuth?(ul.setBotStatus("must be logged in"),t.stop()):e===An?(Un.storage.set("start_when_ready",!0),location.reload()):(A("got error at bot start or inside bot loop"),T(n),ul.setBotStatus(n),t.stop())}finally{a=!1}}})),qe.on("download_heatmap",(async()=>{let e=await t();if(!e)return;let{targeter:n,template:r}=e,i=yi(n);if(i){let[t,e]=r.name.split("."),n=Un.storage.get("strategy")??"nostrat";ue(i.canvas,`${t}-${n}.${e??"png"}`)}else A("heatmap canvas is undefined")})),qe.on("download_heatweb",(async()=>{let e=await t();if(!e)return;let n=_i({targeter:e.targeter,template:e.template,api:r});if(n){let[t]=e.template.name.split("."),r=Un.storage.get("strategy")??"nostrat";de(n,`${t}-${r}.html`)}})),qe.on("change_smart_place",(async t=>{(await s)?.works?A("bot is working, reject smart place change"):(Un.storage.set("smartPlace",t),(await s)?.changeSmartPlace(t))})),Un.storage.get("start_when_ready")&&(qe.call("switch_bot"),Un.storage.set("start_when_ready",!1))}async function x({api:t,template:e}){let n=fi(Un.storage.get("strategy")??Pn),r=performance.now(),i=n.builder(t,e);return await i.init(),A("targeter is ready in",((performance.now()-r)/1e3).toFixed(3),"s."),i}function k(t){let e=(0,bl.group)(t.connections).by("tags").asArrays();console.debug("void bot online:"),e.sort(((t,e)=>e.length-t.length)).forEach((e=>{let n=e[0].tags.map((e=>t.numberToTag[e])).join(", ");console.debug(`\t${n||"no tags"}: ${e.length}`)}))}async function C(){kl.on("online",k)}function A(...t){console.debug("[DB]",...t.map((t=>"object"==typeof t&&t.hasOwnProperty("toString")?t.toString():t)))}function T(t){A(t.name,t.message,t.stack??"")}var M,P,E,S,I,L,O,D,B,j,z,N,R,U,W,F,H,G,$,K,Y,q,Q,V,Z,X,J,tt,et,nt,rt,it,ot,at,st,lt,ct,ht,ut,dt,pt,gt,mt,ft,bt,yt,wt,_t,vt,xt,kt,Ct,At,Tt,Mt,Pt,Et,St,It,Lt,Ot,Dt,Bt,jt,zt,Nt,Rt,Ut,Wt,Ft,Ht,Gt,$t,Kt,Yt,qt,Qt,Vt,Zt,Xt,Jt,te,ee,ne,re,ie,oe,ae,se,le,ce,he,ue,de,pe,ge,me,fe,be,ye,we,_e,ve,xe,ke,Ce,Ae,Te,Me,Pe,Ee,Se,Ie,Le,Oe,De,Be,je,ze,Ne,Re,Ue,We,Fe,He,Ge,$e,Ke,Ye,qe,Qe,Ve,Ze,Xe,Je,tn,en,nn,rn,on,an,sn,ln,cn,hn,un,dn,pn,gn,mn,fn,bn,yn,wn,_n,vn,xn,kn,Cn,An,Tn,Mn,Pn,En,Sn,In,Ln,On,Dn,Bn,jn,zn,Nn,Rn,Un,Wn,Fn,Hn,Gn,$n,Kn,Yn,qn,Qn,Vn,Zn,Xn,Jn,tr,er,nr,rr,ir,or,ar,sr,lr,cr,hr,ur,dr,pr,gr,mr,fr,br,yr,wr,_r,vr,xr,kr,Cr,Ar,Tr,Mr,Pr,Er,Sr,Ir,Lr,Or,Dr,Br,jr,zr,Nr,Rr,Ur,Wr,Fr,Hr,Gr,$r,Kr,Yr,qr,Qr,Vr,Zr,Xr,Jr,ti,ei,ni,ri,ii,oi,ai,si,li,ci,hi,ui,di,pi,gi,mi,fi,bi,yi,wi,_i,vi,xi,ki,Ci,Ai,Ti,Mi,Pi,Ei,Si,Ii,Li,Oi,Di,Bi,ji,zi,Ni,Ri,Ui,Wi,Fi,Hi,Gi,$i,Ki,Yi,qi,Qi,Vi,Zi,Xi,Ji,to,eo,no,ro,io,oo,ao,so,lo,co,ho,uo,po,go,mo,fo,bo,yo,wo,_o,vo,xo,ko,Co,Ao,To,Mo,Po,Eo,So,Io,Lo,Oo,Do,Bo,jo,zo,No,Ro,Uo,Wo,Fo,Ho,Go,$o,Ko,Yo,qo,Qo,Vo,Zo,Xo,Jo,ta,ea,na,ra,ia,oa,aa,sa,la,ca,ha,ua,da,pa,ga,ma,fa,ba,ya,wa,_a,va,xa,ka,Ca,Aa,Ta,Ma,Pa,Ea,Sa,Ia,La,Oa,Da,Ba,ja,za,Na,Ra,Ua,Wa,Fa,Ha,Ga,$a,Ka,Ya,qa,Qa,Va,Za,Xa,Ja,ts,es,ns,rs,is,os,as,ss,ls,cs,hs,us,ds,ps,gs,ms,fs,bs,ys,ws,_s,vs,xs,ks,Cs,As,Ts,Ms,Ps,Es,Ss,Is,Ls,Os,Ds,Bs,js,zs,Ns,Rs,Us,Ws,Fs,Hs,Gs,$s,Ks,Ys,qs,Qs,Vs,Zs,Xs,Js,tl,el,nl,rl,il,ol,al,sl,ll,cl,hl,ul,dl,pl,gl,ml,fl,bl,yl,wl,_l,vl,xl,kl,Cl,Al,Tl,Ml,Pl=Object.create,El=Object.defineProperty,Sl=Object.getOwnPropertyDescriptor,Il=Object.getOwnPropertyNames,Ll=Object.getPrototypeOf,Ol=Object.prototype.hasOwnProperty,Dl=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Bl=(t,e)=>{for(var n in e)El(t,n,{get:e[n],enumerable:!0})},jl=(t,e,n,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of Il(e))!Ol.call(t,i)&&i!==n&&El(t,i,{get:()=>e[i],enumerable:!(r=Sl(e,i))||r.enumerable});return t},zl=(t,e,n)=>(n=null!=t?Pl(Ll(t)):{},jl(!e&&t&&t.__esModule?n:El(n,"default",{value:t,enumerable:!0}),t)),Nl=Dl(((t,e)=>{"use strict";var n,r;n=t,r=function(){var t="function"==typeof Promise,e=function(t){if("object"==typeof globalThis)return globalThis;Object.defineProperty(t,"typeDetectGlobalObject",{get:function(){return this},configurable:!0});var e=typeDetectGlobalObject;return delete t.typeDetectGlobalObject,e}(Object.prototype),n=typeof Symbol<"u",r=typeof Map<"u",i=typeof Set<"u",o=typeof WeakMap<"u",a=typeof WeakSet<"u",s=typeof DataView<"u",l=n&&typeof Symbol.iterator<"u",c=n&&typeof Symbol.toStringTag<"u",h=i&&"function"==typeof Set.prototype.entries,u=r&&"function"==typeof Map.prototype.entries,d=h&&Object.getPrototypeOf((new Set).entries()),p=u&&Object.getPrototypeOf((new Map).entries()),g=l&&"function"==typeof Array.prototype[Symbol.iterator],m=g&&Object.getPrototypeOf([][Symbol.iterator]()),f=l&&"function"==typeof String.prototype[Symbol.iterator],b=f&&Object.getPrototypeOf(""[Symbol.iterator]());return function(n){var l,h,u=typeof n;if("object"!==u)return u;if(null===n)return"null";if(n===e)return"global";if(Array.isArray(n)&&(!1===c||!(Symbol.toStringTag in n)))return"Array";if("object"==typeof window&&null!==window){if("object"==typeof window.location&&n===window.location)return"Location";if("object"==typeof window.document&&n===window.document)return"Document";if("object"==typeof window.navigator){if("object"==typeof window.navigator.mimeTypes&&n===window.navigator.mimeTypes)return"MimeTypeArray";if("object"==typeof window.navigator.plugins&&n===window.navigator.plugins)return"PluginArray"}if(("function"==typeof window.HTMLElement||"object"==typeof window.HTMLElement)&&n instanceof window.HTMLElement){if("BLOCKQUOTE"===n.tagName)return"HTMLQuoteElement";if("TD"===n.tagName)return"HTMLTableDataCellElement";if("TH"===n.tagName)return"HTMLTableHeaderCellElement"}}return"string"==typeof(l=c&&n[Symbol.toStringTag])?l:(h=Object.getPrototypeOf(n))===RegExp.prototype?"RegExp":h===Date.prototype?"Date":t&&h===Promise.prototype?"Promise":i&&h===Set.prototype?"Set":r&&h===Map.prototype?"Map":a&&h===WeakSet.prototype?"WeakSet":o&&h===WeakMap.prototype?"WeakMap":s&&h===DataView.prototype?"DataView":r&&h===p?"Map Iterator":i&&h===d?"Set Iterator":g&&h===m?"Array Iterator":f&&h===b?"String Iterator":null===h?"Object":Object.prototype.toString.call(n).slice(8,-1)}},"object"==typeof t&&typeof e<"u"?e.exports=r():"function"==typeof define&&define.amd?define(r):(n=typeof globalThis<"u"?globalThis:n||self).typeDetect=r()})),Rl=Dl(((t,e)=>{"use strict";function n(){this._key="chai/deep-eql__"+Math.random()+Date.now()}function r(t,e,n){var r,i;return!n||m(t)||m(e)?null:(r=n.get(t))&&"boolean"==typeof(i=r.get(e))?i:null}function i(t,e,n,r){if(n&&!m(t)&&!m(e)){var i=n.get(t);i?i.set(e,r):((i=new b).set(e,r),n.set(t,i))}}function o(t,e,n){if(n&&n.comparator)return s(t,e,n);var r=a(t,e);return null!==r?r:s(t,e,n)}function a(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e||!m(t)&&!m(e)&&null}function s(t,e,n){var s,m,w,_,v,x,k;if((n=n||{}).memoize=!1!==n.memoize&&(n.memoize||new b),s=n&&n.comparator,null!==(m=r(t,e,n.memoize)))return m;if(null!==(w=r(e,t,n.memoize)))return w;if(s){if(!1===(_=s(t,e))||!0===_)return i(t,e,n.memoize,_),_;if(null!==(v=a(t,e)))return v}return(x=y(t))!==y(e)?(i(t,e,n.memoize,!1),!1):(i(t,e,n.memoize,!0),k=function(t,e,n,r){switch(n){case"String":case"Number":case"Boolean":case"Date":return o(t.valueOf(),e.valueOf());case"Promise":case"Symbol":case"function":case"WeakMap":case"WeakSet":return t===e;case"Error":return g(t,e,["name","message","code"],r);case"Arguments":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"Array":return c(t,e,r);case"RegExp":return function(t,e){return t.toString()===e.toString()}(t,e);case"Generator":return function(t,e,n){return c(u(t),u(e),n)}(t,e,r);case"DataView":return c(new Uint8Array(t.buffer),new Uint8Array(e.buffer),r);case"ArrayBuffer":return c(new Uint8Array(t),new Uint8Array(e),r);case"Set":case"Map":return l(t,e,r);case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.Instant":case"Temporal.ZonedDateTime":case"Temporal.PlainYearMonth":case"Temporal.PlainMonthDay":return t.equals(e);case"Temporal.Duration":return t.total("nanoseconds")===e.total("nanoseconds");case"Temporal.TimeZone":case"Temporal.Calendar":return t.toString()===e.toString();default:return function(t,e,n){var r,i,o=d(t),a=d(e),s=p(t),l=p(e);if(o=o.concat(s),a=a.concat(l),o.length&&o.length===a.length)return!1!==c(f(o).sort(),f(a).sort())&&g(t,e,o,n);r=h(t),i=h(e);return r.length&&r.length===i.length?(r.sort(),i.sort(),c(r,i,n)):0===o.length&&0===r.length&&0===a.length&&0===i.length}(t,e,r)}}(t,e,x,n),i(t,e,n.memoize,k),k)}function l(t,e,n){try{if(t.size!==e.size)return!1;if(0===t.size)return!0}catch{return!1}var r=[],i=[];return t.forEach((function(t,e){r.push([t,e])})),e.forEach((function(t,e){i.push([t,e])})),c(r.sort(),i.sort(),n)}function c(t,e,n){var r,i=t.length;if(i!==e.length)return!1;if(0===i)return!0;for(r=-1;++r<i;)if(!1===o(t[r],e[r],n))return!1;return!0}function h(t){if(function(t){return typeof Symbol<"u"&&"object"==typeof t&&typeof Symbol.iterator<"u"&&"function"==typeof t[Symbol.iterator]}(t))try{return u(t[Symbol.iterator]())}catch{return[]}return[]}function u(t){for(var e=t.next(),n=[e.value];!1===e.done;)e=t.next(),n.push(e.value);return n}function d(t){var e,n=[];for(e in t)n.push(e);return n}function p(t){var e,n,r,i;for(e=[],n=Object.getOwnPropertySymbols(t),r=0;r<n.length;r+=1)i=n[r],Object.getOwnPropertyDescriptor(t,i).enumerable&&e.push(i);return e}function g(t,e,n,r){var i,a=n.length;if(0===a)return!0;for(i=0;i<a;i+=1)if(!1===o(t[n[i]],e[n[i]],r))return!1;return!0}function m(t){return null===t||"object"!=typeof t}function f(t){return t.map((function(t){return"symbol"==typeof t?t.toString():t}))}var b,y=Nl();n.prototype={get:function(t){return t[this._key]},set:function(t,e){Object.isExtensible(t)&&Object.defineProperty(t,this._key,{value:e,configurable:!0})}},b="function"==typeof WeakMap?WeakMap:n,e.exports=o,e.exports.MemoizeMap=b})),Ul=Dl((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asArraysFactory=void 0,t.asArraysFactory=function(t){return()=>t.map((t=>t.items))}})),Wl=Dl((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asEntriesFactory=void 0,t.asEntriesFactory=function(t){return e=>{var n,r;let i=null!==(n=e?.keyName)&&void 0!==n?n:"key",o=null!==(r=e?.itemsName)&&void 0!==r?r:"items";return t.map((t=>({[i]:t.key,[o]:t.items})))}}})),Fl=Dl((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asMapFactory=void 0,t.asMapFactory=function(t){return()=>{let e=new Map;for(let n of t)e.set(n.key,n.items);return e}}})),Hl=Dl((t=>{"use strict";function e(t){return"string"==typeof t||"number"==typeof t||"symbol"==typeof t}Object.defineProperty(t,"__esModule",{value:!0}),t.asObjectFactory=void 0,t.asObjectFactory=function(t){return()=>{let n={};for(let r of t)e(r.key)&&(n[r.key]=r.items);return n}}})),Gl=Dl((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asTuplesFactory=void 0,t.asTuplesFactory=function(t){return()=>t.map((t=>[t.key,t.items]))}})),$l=Dl((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keysFactory=void 0,t.keysFactory=function(t){return()=>t.map((t=>t.key))}})),Kl=Dl((t=>{"use strict";var e,n,r,i,o,a,s,l=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0}),t.group=void 0,e=l(Rl()),n=Ul(),r=Wl(),i=Fl(),o=Hl(),a=Gl(),s=$l(),t.group=function(t){return Object.freeze({by:l=>{let c=function(t,n){let r=[],i=new Map,o=0;for(let a of t){let t=n(a,o);o++;let s="object"==typeof t?JSON.stringify(t):t,l=i.get(s);null==l&&(l=[],i.set(s,l));let c=!1;for(let n of l)if((0,e.default)(n.key,t)){n.items.push(a),c=!0;break}if(!c){let e={key:t,items:[a]};r.push(e),l.push(e)}}return r}(t,"function"==typeof l?l:t=>t[l]);return Object.freeze({asArrays:(0,n.asArraysFactory)(c),asEntries:(0,r.asEntriesFactory)(c),asMap:(0,i.asMapFactory)(c),asObject:(0,o.asObjectFactory)(c),asTuples:(0,a.asTuplesFactory)(c),keys:(0,s.keysFactory)(c)})}})}})),Yl=Dl((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.group=void 0;var e=Kl();Object.defineProperty(t,"group",{enumerable:!0,get:function(){return e.group}})})),ql=Dl(((t,e)=>{"use strict";var n=function(){function t(t,e){if(!i[t]){i[t]={};for(var n=0;n<t.length;n++)i[t][t.charAt(n)]=n}return i[t][e]}var e=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={},o={compressToBase64:function(t){if(null==t)return"";var e=o._compress(t,6,(function(t){return n.charAt(t)}));switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:o._decompress(e.length,32,(function(r){return t(n,e.charAt(r))}))},compressToUTF16:function(t){return null==t?"":o._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:o._decompress(t.length,16384,(function(e){return t.charCodeAt(e)-32}))},compressToUint8Array:function(t){var e,n,r,i,a;for(e=o.compress(t),n=new Uint8Array(2*e.length),r=0,i=e.length;r<i;r++)a=e.charCodeAt(r),n[2*r]=a>>>8,n[2*r+1]=a%256;return n},decompressFromUint8Array:function(t){var n,r,i,a;if(null==t)return o.decompress(t);for(r=0,i=(n=new Array(t.length/2)).length;r<i;r++)n[r]=256*t[2*r]+t[2*r+1];return a=[],n.forEach((function(t){a.push(e(t))})),o.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":o._compress(t,6,(function(t){return r.charAt(t)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),o._decompress(e.length,32,(function(n){return t(r,e.charAt(n))})))},compress:function(t){return o._compress(t,16,(function(t){return e(t)}))},_compress:function(t,e,n){if(null==t)return"";var r,i,o,a={},s={},l="",c="",h="",u=2,d=3,p=2,g=[],m=0,f=0;for(o=0;o<t.length;o+=1)if(l=t.charAt(o),Object.prototype.hasOwnProperty.call(a,l)||(a[l]=d++,s[l]=!0),c=h+l,Object.prototype.hasOwnProperty.call(a,c))h=c;else{if(Object.prototype.hasOwnProperty.call(s,h)){if(h.charCodeAt(0)<256){for(r=0;r<p;r++)m<<=1,f==e-1?(f=0,g.push(n(m)),m=0):f++;for(i=h.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&i,f==e-1?(f=0,g.push(n(m)),m=0):f++,i>>=1}else{for(i=1,r=0;r<p;r++)m=m<<1|i,f==e-1?(f=0,g.push(n(m)),m=0):f++,i=0;for(i=h.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&i,f==e-1?(f=0,g.push(n(m)),m=0):f++,i>>=1}0==--u&&(u=Math.pow(2,p),p++),delete s[h]}else for(i=a[h],r=0;r<p;r++)m=m<<1|1&i,f==e-1?(f=0,g.push(n(m)),m=0):f++,i>>=1;0==--u&&(u=Math.pow(2,p),p++),a[c]=d++,h=String(l)}if(""!==h){if(Object.prototype.hasOwnProperty.call(s,h)){if(h.charCodeAt(0)<256){for(r=0;r<p;r++)m<<=1,f==e-1?(f=0,g.push(n(m)),m=0):f++;for(i=h.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&i,f==e-1?(f=0,g.push(n(m)),m=0):f++,i>>=1}else{for(i=1,r=0;r<p;r++)m=m<<1|i,f==e-1?(f=0,g.push(n(m)),m=0):f++,i=0;for(i=h.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&i,f==e-1?(f=0,g.push(n(m)),m=0):f++,i>>=1}0==--u&&(u=Math.pow(2,p),p++),delete s[h]}else for(i=a[h],r=0;r<p;r++)m=m<<1|1&i,f==e-1?(f=0,g.push(n(m)),m=0):f++,i>>=1;0==--u&&(u=Math.pow(2,p),p++)}for(i=2,r=0;r<p;r++)m=m<<1|1&i,f==e-1?(f=0,g.push(n(m)),m=0):f++,i>>=1;for(;;){if(m<<=1,f==e-1){g.push(n(m));break}f++}return g.join("")},decompress:function(t){return null==t?"":""==t?null:o._decompress(t.length,32768,(function(e){return t.charCodeAt(e)}))},_decompress:function(t,n,r){var i,o,a,s,l,c,h,u=[],d=4,p=4,g=3,m="",f=[],b={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)u[i]=i;for(a=0,l=Math.pow(2,2),c=1;c!=l;)s=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(s>0?1:0)*c,c<<=1;switch(a){case 0:for(a=0,l=Math.pow(2,8),c=1;c!=l;)s=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(s>0?1:0)*c,c<<=1;h=e(a);break;case 1:for(a=0,l=Math.pow(2,16),c=1;c!=l;)s=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(s>0?1:0)*c,c<<=1;h=e(a);break;case 2:return""}for(u[3]=h,o=h,f.push(h);;){if(b.index>t)return"";for(a=0,l=Math.pow(2,g),c=1;c!=l;)s=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(s>0?1:0)*c,c<<=1;switch(h=a){case 0:for(a=0,l=Math.pow(2,8),c=1;c!=l;)s=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(s>0?1:0)*c,c<<=1;u[p++]=e(a),h=p-1,d--;break;case 1:for(a=0,l=Math.pow(2,16),c=1;c!=l;)s=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(s>0?1:0)*c,c<<=1;u[p++]=e(a),h=p-1,d--;break;case 2:return f.join("")}if(0==d&&(d=Math.pow(2,g),g++),u[h])m=u[h];else{if(h!==p)return null;m=o+o.charAt(0)}f.push(m),u[p++]=o+m.charAt(0),o=m,0==--d&&(d=Math.pow(2,g),g++)}}};return o}();"function"==typeof define&&define.amd?define((function(){return n})):typeof e<"u"&&null!=e?e.exports=n:typeof angular<"u"&&null!=angular&&angular.module("LZString",[]).factory("LZString",(function(){return n}))})),Ql=Dl(((t,e)=>{"use strict";var n="object"==typeof globalThis&&globalThis&&globalThis.Object===Object&&globalThis;e.exports=n})),Vl=Dl(((t,e)=>{"use strict";var n=Ql(),r="object"==typeof self&&self&&self.Object===Object&&self,i=n||r||Function("return this")();e.exports=i})),Zl=Dl(((t,e)=>{"use strict";var n=Vl().Symbol;e.exports=n})),Xl=Dl(((t,e)=>{"use strict";var n=Zl(),r=Object.prototype,i=r.hasOwnProperty,o=r.toString,a=n?n.toStringTag:void 0;e.exports=function(t){var e,n,r=i.call(t,a),s=t[a];try{t[a]=void 0,e=!0}catch{}return n=o.call(t),e&&(r?t[a]=s:delete t[a]),n}})),Jl=Dl(((t,e)=>{"use strict";var n=Object.prototype.toString;e.exports=function(t){return n.call(t)}})),tc=Dl(((t,e)=>{"use strict";var n=Zl(),r=Xl(),i=Jl(),o=n?n.toStringTag:void 0;e.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":o&&o in Object(t)?r(t):i(t)}})),ec=Dl(((t,e)=>{"use strict";e.exports=function(t){return null!=t&&"object"==typeof t}})),nc=Dl(((t,e)=>{"use strict";e.exports=function(t,e){return function(n){return t(e(n))}}})),rc=Dl(((t,e)=>{"use strict";var n=nc()(Object.getPrototypeOf,Object);e.exports=n})),ic=Dl(((t,e)=>{"use strict";var n=tc(),r=rc(),i=ec(),o=Function.prototype,a=Object.prototype,s=o.toString,l=a.hasOwnProperty,c=s.call(Object);e.exports=function(t){var e,o;return!(!i(t)||"[object Object]"!=n(t))&&(null===(e=r(t))||"function"==typeof(o=l.call(e,"constructor")&&e.constructor)&&o instanceof o&&s.call(o)==c)}})),oc=Dl(((t,e)=>{"use strict";var n=tc(),r=ec(),i=ic();e.exports=function(t){if(!r(t))return!1;var e=n(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!i(t)}})),ac=Uint8Array,sc=Uint16Array,lc=Int32Array,cc=new ac([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),hc=new ac([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),uc=new ac([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dc=function(t,e){var n,r,i,o;for(n=new sc(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(i=new lc(n[30]),r=1;r<30;++r)for(o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return{b:n,r:i}},pc=dc(cc,2),gc=pc.b,mc=pc.r;for(gc[28]=258,mc[258]=28,M=dc(hc,0),P=M.b,E=M.r,S=new sc(32768),L=0;L<32768;++L)I=(61680&(I=(52428&(I=(43690&L)>>1|(21845&L)<<1))>>2|(13107&I)<<2))>>4|(3855&I)<<4,S[L]=((65280&I)>>8|(255&I)<<8)>>1;for(O=function(t,e,n){var r,i,o,a,s,l,c,h,u,d;for(r=t.length,i=0,o=new sc(e);i<r;++i)t[i]&&++o[t[i]-1];for(a=new sc(e),i=1;i<e;++i)a[i]=a[i-1]+o[i-1]<<1;if(n){for(s=new sc(1<<e),l=15-e,i=0;i<r;++i)if(t[i])for(c=i<<4|t[i],h=e-t[i],d=(u=a[t[i]-1]++<<h)|(1<<h)-1;u<=d;++u)s[S[u]>>l]=c}else for(s=new sc(r),i=0;i<r;++i)t[i]&&(s[i]=S[a[t[i]-1]++]>>15-t[i]);return s},D=new ac(288),L=0;L<144;++L)D[L]=8;for(L=144;L<256;++L)D[L]=9;for(L=256;L<280;++L)D[L]=7;for(L=280;L<288;++L)D[L]=8;for(B=new ac(32),L=0;L<32;++L)B[L]=5;j=O(D,9,0),z=O(D,9,1),N=O(B,5,0),R=O(B,5,1),U=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},W=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},F=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},H=function(t){return(t+7)/8|0},G=function(t,e,n){return(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length),new ac(t.subarray(e,n))},$=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],K=function(t,e,n){var r=new Error(e||$[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,K),!n)throw r;return r},Y=function(t,e,n,r){var i,o,a,s,l,c,h,u,d,p,g,m,f,b,y,w,_,v,x,k,C,A,T,M,E,S,I,L,D,B,j,N,$,Y,q,Q,V,Z,X,J,tt,et=t.length,nt=r?r.length:0;if(!et||e.f&&!e.l)return n||new ac(0);o=(i=!n)||2!=e.i,a=e.i,i&&(n=new ac(3*et)),s=function(t){var e,r=n.length;t>r&&((e=new ac(Math.max(2*r,t))).set(n),n=e)},l=e.f||0,c=e.p||0,h=e.b||0,u=e.l,d=e.d,p=e.m,g=e.n,m=8*et;do{if(!u){if(l=W(t,c,1),f=W(t,c+1,3),c+=3,!f){if((B=(M=H(c)+4)+(D=t[M-4]|t[M-3]<<8))>et){a&&K(0);break}o&&s(h+D),n.set(t.subarray(M,B),h),e.b=h+=D,e.p=c=8*B,e.f=l;continue}if(1==f)u=z,d=R,p=9,g=5;else if(2==f){for(b=W(t,c,31)+257,y=W(t,c+10,15)+4,w=b+W(t,c+5,31)+1,c+=14,_=new ac(w),v=new ac(19),x=0;x<y;++x)v[uc[x]]=W(t,c+3*x,7);for(c+=3*y,C=(1<<(k=U(v)))-1,A=O(v,k,1),x=0;x<w;)if(c+=15&(T=A[W(t,c,C)]),(M=T>>4)<16)_[x++]=M;else for(E=0,S=0,16==M?(S=3+W(t,c,3),c+=2,E=_[x-1]):17==M?(S=3+W(t,c,7),c+=3):18==M&&(S=11+W(t,c,127),c+=7);S--;)_[x++]=E;I=_.subarray(0,b),L=_.subarray(b),p=U(I),g=U(L),u=O(I,p,1),d=O(L,g,1)}else K(1);if(c>m){a&&K(0);break}}for(o&&s(h+131072),j=(1<<p)-1,N=(1<<g)-1,$=c;;$=c){if(Y=(E=u[F(t,c)&j])>>4,(c+=15&E)>m){a&&K(0);break}if(E||K(2),Y<256)n[h++]=Y;else{if(256==Y){$=c,u=null;break}if(q=Y-254,Y>264&&(Q=cc[x=Y-257],q=W(t,c,(1<<Q)-1)+gc[x],c+=Q),Z=(V=d[F(t,c)&N])>>4,V||K(3),c+=15&V,L=P[Z],Z>3&&(Q=hc[Z],L+=F(t,c)&(1<<Q)-1,c+=Q),c>m){a&&K(0);break}if(o&&s(h+131072),X=h+q,h<L)for(J=nt-L,tt=Math.min(L,X),J+h<0&&K(3);h<tt;++h)n[h]=r[J+h];for(;h<X;++h)n[h]=n[h-L]}}e.l=u,e.p=$,e.b=h,e.f=l,u&&(l=1,e.m=p,e.d=d,e.n=g)}while(!l);return h!=n.length&&i?G(n,0,h):n.subarray(0,h)},q=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},Q=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},V=function(t,e){var n,r,i,o,a,s,l,c,h,u,d,p,g,m,f,b,y,w,_;for(n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});if(i=n.length,o=n.slice(),!i)return{t:rt,l:0};if(1==i)return(a=new ac(n[0].s+1))[n[0].s]=1,{t:a,l:1};for(n.sort((function(t,e){return t.f-e.f})),n.push({s:-1,f:25001}),s=n[0],l=n[1],c=0,h=1,u=2,n[0]={s:-1,f:s.f+l.f,l:s,r:l};h!=i-1;)s=n[n[c].f<n[u].f?c++:u++],l=n[c!=h&&n[c].f<n[u].f?c++:u++],n[h++]={s:-1,f:s.f+l.f,l:s,r:l};for(d=o[0].s,r=1;r<i;++r)o[r].s>d&&(d=o[r].s);if(p=new sc(d+1),(g=Z(n[h-1],p,0))>e){for(r=0,m=0,b=1<<(f=g-e),o.sort((function(t,e){return p[e.s]-p[t.s]||t.f-e.f}));r<i&&(y=o[r].s,p[y]>e);++r)m+=b-(1<<g-p[y]),p[y]=e;for(m>>=f;m>0;)w=o[r].s,p[w]<e?m-=1<<e-p[w]++-1:++r;for(;r>=0&&m;--r)_=o[r].s,p[_]==e&&(--p[_],++m);g=e}return{t:new ac(p),l:g}},Z=function(t,e,n){return-1==t.s?Math.max(Z(t.l,e,n+1),Z(t.r,e,n+1)):e[t.s]=n},X=function(t){var e,n,r,i,o,a,s;for(e=t.length;e&&!t[--e];);for(n=new sc(++e),r=0,i=t[0],o=1,a=function(t){n[r++]=t},s=1;s<=e;++s)if(t[s]==i&&s!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(i),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(i);o=1,i=t[s]}return{c:n.subarray(0,r),n:e}},J=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},tt=function(t,e,n){var r,i=n.length,o=H(e+2);for(t[o]=255&i,t[o+1]=i>>8,t[o+2]=255^t[o],t[o+3]=255^t[o+1],r=0;r<i;++r)t[o+r+4]=n[r];return 8*(o+4+i)},et=function(t,e,n,r,i,o,a,s,l,c,h){var u,d,p,g,m,f,b,y,w,_,v,x,k,C,A,T,M,P,E,S,I,L,z,R,U,W,F,H,G,$,K,Y;for(q(e,h++,n),++i[256],d=(u=V(i,15)).t,p=u.l,m=(g=V(o,15)).t,f=g.l,y=(b=X(d)).c,w=b.n,v=(_=X(m)).c,x=_.n,k=new sc(19),C=0;C<y.length;++C)++k[31&y[C]];for(C=0;C<v.length;++C)++k[31&v[C]];for(T=(A=V(k,7)).t,M=A.l,P=19;P>4&&!T[uc[P-1]];--P);if(E=c+5<<3,S=J(i,D)+J(o,B)+a,I=J(i,d)+J(o,m)+a+14+3*P+J(k,T)+2*k[16]+3*k[17]+7*k[18],l>=0&&E<=S&&E<=I)return tt(e,h,t.subarray(l,l+c));if(q(e,h,1+(I<S)),h+=2,I<S){for(L=O(d,p,0),z=d,R=O(m,f,0),U=m,W=O(T,M,0),q(e,h,w-257),q(e,h+5,x-1),q(e,h+10,P-4),h+=14,C=0;C<P;++C)q(e,h+3*C,T[uc[C]]);for(h+=3*P,F=[y,v],H=0;H<2;++H)for(G=F[H],C=0;C<G.length;++C)$=31&G[C],q(e,h,W[$]),h+=T[$],$>15&&(q(e,h,G[C]>>5&127),h+=G[C]>>12)}else L=j,z=D,R=N,U=B;for(C=0;C<s;++C)(K=r[C])>255?(Q(e,h,L[($=K>>18&31)+257]),h+=z[$+257],$>7&&(q(e,h,K>>23&31),h+=cc[$]),Q(e,h,R[Y=31&K]),h+=U[Y],Y>3&&(Q(e,h,K>>5&8191),h+=hc[Y])):(Q(e,h,L[K]),h+=z[K]);return Q(e,h,L[256]),h+z[256]},nt=new lc([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),rt=new ac(0),it=function(t,e,n,r,i,o){var a,s,l,c,h,u,d,p,g,m,f,b,y,w,_,v,x,k,C,A,T,M,P,S,I,L,O,D,B,j,z,N,R,U,W,F,$,K,Y=o.z||t.length,q=new ac(r+Y+5*(1+Math.ceil(Y/7e3))+i),Q=q.subarray(r,q.length-i),V=o.l,Z=7&(o.r||0);if(e){for(Z&&(Q[0]=o.r>>3),s=(a=nt[e-1])>>13,l=8191&a,c=(1<<n)-1,h=o.p||new sc(32768),u=o.h||new sc(c+1),d=Math.ceil(n/3),p=2*d,g=function(e){return(t[e]^t[e+1]<<d^t[e+2]<<p)&c},m=new lc(25e3),f=new sc(288),b=new sc(32),y=0,w=0,_=o.i||0,v=0,x=o.w||0,k=0;_+2<Y;++_)if(A=32767&_,T=u[C=g(_)],h[A]=T,u[C]=A,x<=_){if(M=Y-_,(y>7e3||v>24576)&&(M>423||!V)){for(Z=et(t,Q,0,m,f,b,w,v,k,_-k,Z),v=y=w=0,k=_,P=0;P<286;++P)f[P]=0;for(P=0;P<30;++P)b[P]=0}if(S=2,I=0,L=l,O=A-T&32767,M>2&&C==g(_-O))for(D=Math.min(s,M)-1,B=Math.min(32767,_),j=Math.min(258,M);O<=B&&--L&&A!=T;){if(t[_+S]==t[_+S-O]){for(z=0;z<j&&t[_+z]==t[_+z-O];++z);if(z>S){if(S=z,I=O,z>D)break;for(N=Math.min(O,z-2),R=0,P=0;P<N;++P)(W=(U=_-O+P&32767)-h[U]&32767)>R&&(R=W,T=U)}}O+=(A=T)-(T=h[A])&32767}I?(m[v++]=268435456|mc[S]<<18|E[I],F=31&mc[S],$=31&E[I],w+=cc[F]+hc[$],++f[257+F],++b[$],x=_+S,++y):(m[v++]=t[_],++f[t[_]])}for(_=Math.max(_,x);_<Y;++_)m[v++]=t[_],++f[t[_]];Z=et(t,Q,V,m,f,b,w,v,k,_-k,Z),V||(o.r=7&Z|Q[Z/8|0]<<3,Z-=7,o.h=u,o.p=h,o.i=_,o.w=x)}else{for(_=o.w||0;_<Y+V;_+=65535)(K=_+65535)>=Y&&(Q[Z/8|0]=V,K=Y),Z=tt(Q,Z+1,t.subarray(_,K));o.i=Y}return G(q,0,r+H(Z)+i)},ot=function(){var t,e,n,r;for(t=new Int32Array(256),e=0;e<256;++e){for(n=e,r=9;--r;)n=(1&n&&-306674912)^n>>>1;t[e]=n}return t}(),at=function(){var t=-1;return{p:function(e){for(var n=t,r=0;r<e.length;++r)n=ot[255&n^e[r]]^n>>>8;t=n},d:function(){return~t}}},st=function(t,e,n,r,i){if(!i&&(i={l:1},e.dictionary)){var o=e.dictionary.subarray(-32768),a=new ac(o.length+t.length);a.set(o),a.set(t,o.length),t=a,i.w=o.length}return it(t,null==e.level?6:e.level,null==e.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+e.mem,n,r,i)},lt=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},ct=function(t,e){var n,r=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&lt(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),r)for(t[3]=8,n=0;n<=r.length;++n)t[n+10]=r.charCodeAt(n)},ht=function(t){var e,n,r;for((31!=t[0]||139!=t[1]||8!=t[2])&&K(6,"invalid gzip data"),n=10,4&(e=t[3])&&(n+=2+(t[10]|t[11]<<8)),r=(e>>3&1)+(e>>4&1);r>0;r-=!t[n++]);return n+(2&e)},ut=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},dt=function(t){return 10+(t.filename?t.filename.length+1:0)},pt=typeof TextDecoder<"u"&&new TextDecoder;try{pt.decode(rt,{stream:!0})}catch{}gt=t=>t*t,mt=t=>new Promise((e=>setTimeout(e,t))),ft=new RegExp(/-?\d+/g),bt=t=>t.match(ft)?.map(parseFloat),yt=t=>gt(Math.floor(t)),wt=t=>{let e=0;for(let n=0;n!==t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e},_t=t=>t[t.length-1],vt=t=>t[~~(Math.random()*t.length)],xt=t=>{let e=new Uint8Array(t.length);for(let n=0;n!==t.length;n++)e[n]=t.charCodeAt(n);return e},kt=t=>String.fromCharCode(...t),Ct=(t,e)=>t+Math.floor(Math.random()*(e-t)),At=(t,e,n)=>Math.max(t,Math.min(e,n)),Tt=t=>{let e=function(t,e){var n=ht(t);return n+8>t.length&&K(6,"invalid gzip data"),Y(t.subarray(n,-8),{i:2},e&&e.out||new ac(ut(t)),e&&e.dictionary)}(new Uint8Array(t));return Mt(new Int16Array(e.buffer))},Mt=t=>{if(0===t.length)return[];let e=[[t[0],t[1]]],n=t.length>>1;for(let r=1;r<n;r++){let n=e[r-1],i=r<<1;e.push([t[0|i]+n[0],t[1|i]+n[1]])}return e},Pt=t=>t[0],Et=t=>document.querySelector(t),St=t=>t.split("").join("â€Ž"),It=(t,e)=>{"Notification"in window&&("granted"===Notification.permission?new Notification(t,e):"denied"!==Notification.permission&&Notification.requestPermission((n=>"granted"===n&&new Notification(t,e))))},Lt=()=>"image/*",Ot=t=>new Promise((e=>{let n=document.createElement("input");n.type="file",t&&(n.accept=t),n.addEventListener("change",(()=>e(n.files?.length?n.files[0]:null))),n.click()})),Dt=()=>Ot(Lt()),Bt=(t,e)=>{let n=document.createElement("canvas").getContext("2d");return n.canvas.width=t,n.canvas.height=e,n},jt=()=>navigator.language.split("-")[0]??"en",zt={},Nt=!1,(Rt=function(){function t(){t.init.call(this)}function e(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function n(e){return void 0===e._maxListeners?t.defaultMaxListeners:e._maxListeners}function r(t,r,i,o){var a,s,l,c;return e(i),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",r,i.listener?i.listener:i),s=t._events),l=s[r]),void 0===l?(l=s[r]=i,++t._eventsCount):("function"==typeof l?l=s[r]=o?[i,l]:[l,i]:o?l.unshift(i):l.push(i),(a=n(t))>0&&l.length>a&&!l.warned&&(l.warned=!0,(c=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",c.emitter=t,c.type=r,c.count=l.length,function(t){console&&console.warn&&console.warn(t)}(c))),t}function i(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function o(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=i.bind(r);return o.listener=n,r.wrapFn=o,o}function a(t,e,n){var r,i=t._events;return void 0===i||void 0===(r=i[e])?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(r):l(r,r.length)}function s(t){var e,n=this._events;if(void 0!==n){if("function"==typeof(e=n[t]))return 1;if(void 0!==e)return e.length}return 0}function l(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function c(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(o){r.once&&t.removeEventListener(e,i),n(o)}))}}var h,u,d,p,g;return Nt||(Nt=!0,h="object"==typeof Reflect?Reflect:null,u=h&&"function"==typeof h.apply?h.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},d=h&&"function"==typeof h.ownKeys?h.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)},p=Number.isNaN||function(t){return t!=t},(zt=t).once=function(t,e){return new Promise((function(n,r){function i(n){t.removeListener(e,o),r(n)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",i),n([].slice.call(arguments))}c(t,e,o,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&c(t,"error",e,n)}(t,i,{once:!0})}))},t.EventEmitter=t,t.prototype._events=void 0,t.prototype._eventsCount=0,t.prototype._maxListeners=void 0,g=10,Object.defineProperty(t,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(t){if("number"!=typeof t||t<0||p(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");g=t}}),t.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||p(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},t.prototype.getMaxListeners=function(){return n(this)},t.prototype.emit=function(t){var e,n,r,i,o,a,s,c,h;for(e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);if(r="error"===t,void 0!==(i=this._events))r=r&&void 0===i.error;else if(!r)return!1;if(r){if(e.length>0&&(o=e[0]),o instanceof Error)throw o;throw(a=new Error("Unhandled error."+(o?" ("+o.message+")":""))).context=o,a}if(void 0===(s=i[t]))return!1;if("function"==typeof s)u(s,this,e);else for(h=l(s,c=s.length),n=0;n<c;++n)u(h[n],this,e);return!0},t.prototype.addListener=function(t,e){return r(this,t,e,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(t,e){return r(this,t,e,!0)},t.prototype.once=function(t,n){return e(n),this.on(t,o(this,t,n)),this},t.prototype.prependOnceListener=function(t,n){return e(n),this.prependListener(t,o(this,t,n)),this},t.prototype.removeListener=function(t,n){var r,i,o,a,s;if(e(n),void 0===(i=this._events))return this;if(void 0===(r=i[t]))return this;if(r===n||r.listener===n)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if("function"!=typeof r){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===n||r[a].listener===n){s=r[a].listener,o=a;break}if(o<0)return this;0===o?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,o),1===r.length&&(i[t]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",t,s||n)}return this},t.prototype.off=t.prototype.removeListener,t.prototype.removeAllListeners=function(t){var e,n,r,i,o;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){for(i=Object.keys(n),r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},t.prototype.listeners=function(t){return a(this,t,!0)},t.prototype.rawListeners=function(t){return a(this,t,!1)},t.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):s.call(t,e)},t.prototype.listenerCount=s,t.prototype.eventNames=function(){return this._eventsCount>0?d(this._events):[]}),zt}()).once,Rt.once=function(t,e){return new Promise(((n,r)=>{function i(...e){void 0!==o&&t.removeListener("error",o),n(e)}let o;"error"!==e&&(o=e=>{t.removeListener(name,i),r(e)},t.once("error",o)),t.once(e,i)}))},Rt.on=function(t,e){function n(...t){let e=o.shift();e?e.resolve(createIterResult(t,!1)):i.push(t)}function r(t){s=!0;let e=o.shift();e?e.reject(t):a=t,l.return()}let i=[],o=[],a=null,s=!1,l={async next(){let t=i.shift();if(t)return createIterResult(t,!1);if(a){let t=Promise.reject(a);return a=null,t}return s?createIterResult(void 0,!0):new Promise(((t,e)=>o.push({resolve:t,reject:e})))},async return(){t.removeListener(e,n),t.removeListener("error",r),s=!0;for(let t of o)t.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(i){a=i,t.removeListener(e,n),t.removeListener("error",r)},[Symbol.asyncIterator](){return this}};return t.on(e,n),t.on("error",r),l};var{EventEmitter:fc,defaultMaxListeners:bc,init:yc,listenerCount:wc,on:_c,once:vc}=Rt;if(Ut=class extends Rt{wait(t,e=1e4){return new Promise(((e,n)=>{this.once(t,(t=>{e(t)}))}))}},Wt=class extends Ut{on(t,e){return super.on(t,e)}once(t,e){return super.once(t,e)}wait(t,e){return super.wait(t,e)}off(t,e){return super.off(t,e)}removeAllListeners(t){return super.removeAllListeners(t)}emit(...t){1===t.length?super.emit(t[0]):super.emit(t[0],t[1])}},Ft=new Error("no connection"),Ht=new Error("need template source"),new Error("no access to canvas api"),Gt=new Error("need template position"),$t=new Error("canvas undefined"),new Error("strategy undefined"),Kt=new Error("promise deadline"),Yt=new Error("errAborterTriggered"),qt=new Error("default strategy doesnt exists"),Qt=new Error("errSeveralNoPlacePixelResult"),Vt=new Error("Max attempts reached"),Zt=class extends Wt{constructor(t,e){super(),this.ws=null,this.url=t,e&&e.reconnectDelay&&this.on("disconnect",(t=>{t.wasClean||setTimeout(!0===e.hideReconnectErrors?()=>this.connect().catch((()=>{})):()=>this.connect(),e.reconnectDelay)}))}get connected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}get disconnected(){return!this.connected}get connecting(){return this.ws&&this.ws.readyState===WebSocket.CONNECTING}connect(){return new Promise(((t,e)=>{(this.ws?.readyState===WebSocket.CONNECTING||this.ws?.readyState===WebSocket.OPEN)&&e(new Error("try connect when websocket is OPEN or CONNECTING"));let n=!1;this.ws=new WebSocket(this.url),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{this.emit("connect"),n=!0,t()},this.ws.onclose=t=>{this.emit("disconnect",t),n||e(t)},this.ws.onerror=t=>{this.emit("error",t)},this.ws.onmessage=({data:t})=>{"string"==typeof t?this.emit("string",t):this.emit("binary",t)}}))}async disconnect(){this.ws&&(this.ws.close(),await this.wait("disconnect"),this.ws=null)}send(t){if(null===this.ws||this.disconnected)throw Ft;this.ws.send(t)}},Xt=class t{constructor(t,e,n,r){this.x1=t,this.y1=e,this.x2=n,this.y2=r}get width(){return this.x2-this.x1}set width(t){this.x2=this.x1+t}get height(){return this.y2-this.y1}set height(t){this.y2=this.y1+t}get localCenter(){return[this.width/2,this.height/2]}get center(){return[(this.x1+this.x2)/2,(this.y1+this.y2)/2]}in(t,e){return this.x1<=t&&t<this.x2&&this.y1<=e&&e<this.y2}localIn(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height}toArray(){return[this.x1,this.y1,this.x2,this.y2]}moveY(t){this.move(this.x1,t)}moveX(t){this.move(t,this.y1)}move(t,e){let n=this.width,r=this.height;this.x1=t,this.y1=e,this.width=n,this.height=r}copy(){return new t(this.x1,this.y1,this.x2,this.y2)}},Jt=class{constructor(t=6e4){this.triggered=!1,this.resolve=()=>{},this.timeout=setTimeout((()=>this.destroy()),t),this.promise=new Promise((t=>this.resolve=t))}abort(){this.resolve(Yt),clearTimeout(this.timeout),this.triggered=!0}destroy(){this.resolve(),clearTimeout(this.timeout)}},ee="wss://"+(te="black-and-red.space")+"/ws",ne=`https://${te}/process-template`,re="https://boosty.to/touchedbydarkness",ie="https://discord.gg/VyfVmD2nhZ",oe="http://github.com/TouchedByDarkness",ae=["From Void with love","Made in Void","From Void to all","Let's all love void"],se="darkness_bot",le=async(...t)=>await(await fetch(...t)).json(),ce=async({delay:t,func:e,maxAttempts:n,onerror:r})=>{let i=0;for(;i<n;)try{return await e()}catch(e){i++,r?.(e),await mt(t)}throw Vt},he=t=>new Promise(((e,n)=>{let r=new Image;r.crossOrigin="",r.onload=()=>e(r),r.onerror=n,r.src=t})),ue=(t,e="unnamed")=>{let n=document.createElement("a");n.setAttribute("href",t.toDataURL("image/png")),n.setAttribute("download",e),n.click()},de=(t,e="unnamed")=>{let n=document.createElement("a");n.setAttribute("href","data:text/html;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.click()},pe=t=>"string"==typeof t?t:t instanceof URL?t.toString():t.url,ge={errNoPlacePixelResult:new Error("errNoPlacePixelResult"),errMustAuth:new Error("errMustAuth"),errTooLowScore:new Error("errTooLowScore"),errPixelProtected:new Error("errPixelProtected"),errFullStack:new Error("errFullStack"),errCaptcha:new Error("errCaptcha"),errYouAreProxy:new Error("errYouAreProxy"),errCanvasAPIInteraction:new Error("errCanvasAPIInteraction"),errUnknownError:new Error("errUnknownError"),errAPIIsntReady:new Error("errAPIIsntReady"),errResponseIsntOk:new Error('response isnt "ok"'),errResponseStatusIsnt200:new Error("response status isnt 200"),errParallelPlace:new Error("errParallelPlace"),errYouAreBanned:new Error("errYouAreBanned")},me=class{constructor(t,e){this.offset=t,this.colors=e.map((t=>3===t.length?[t[0],t[1],t[2],255]:t)),this.monochromes=this.colors.map((t=>4===t.length&&0===t[3]?0:t.reduce(((t,e)=>t+e))/3)),this.rgbaToIdDict=Object.fromEntries(this.colors.map(((t,e)=>[t.toString(),e]))),this.sameColorIds=Object.fromEntries(this.colors.map(((t,e)=>[e,this.colors.findIndex(((n,r)=>e!==r&&t.every(((t,e)=>t===n[e]))))])).filter((([,t])=>-1!==t)))}monochrome(t){return this.monochromes[t]}sameColors(t,e){return t===e||this.sameColorIds[t]===e}idToRGBA(t){return this.colors[t]}quantize(t,e,n,r=255){let i=this.rgbaToId([t,e,n,r]);if(null!==i)return i;let o=0,a=1/0;for(let r=this.offset;r!==this.colors.length;r++){let i=this.colors[r],s=gt(i[0]-t)+gt(i[1]-e)+gt(i[2]-n);s<a&&(a=s,o=r)}return o}rgbaToId(t){return this.rgbaToIdDict[t.toString()]??null}},fe=(t,e)=>t[0]===e[0]&&t[1]===e[1],be=(t,e)=>t.some((t=>fe(t,e))),ye=class{constructor(t){this.low=t,this.workspaces=[],this.chunks=[],this.on=this.low.on.bind(this.low),this.emit=this.low.emit.bind(this.low),this.wait=this.low.wait.bind(this.low),this.getCanvasNameByIdent=this.low.getCanvasNameByIdent?.bind(this.low);let{offset:e,colors:n}=this.info.palette;this.palette=new me(e,n)}get info(){return this.low.info}getCaptcha(){if(!this.low.getCaptcha)throw new Error("getCaptcha not implemented");return this.low.getCaptcha()}sendAnswer(t){if(!this.low.sendAnswer)throw new Error("sendAnswer not implemented");return this.low.sendAnswer(t)}getCooldown(){return this.low.timer.get()}pixelsCanPlace(){let t=Math.max(this.info.minCd,this.info.maxCd);return Math.floor((this.info.stack-this.getCooldown())/t)}get(t,e){return this.low.get(t,e)}compare(t){let e=this.get(t.x,t.y);return this.palette.sameColors(e,t.id)}predictCooldown(t,e){return this.low.predictCooldown(t,e)}createWorkspace(t,e,n,r){return{x1:t,y1:e,x2:n,y2:r,chunks:this.low.getChunksCoords(t,e,n,r)}}hasWorkspace(t){return this.workspaces.some((e=>e.x1===t.x1&&e.y1===t.y1&&e.x2===t.x2&&e.y2===t.y2))}async changeWorkspace(t){this.clearWorkspaces(),await this.addWorkspace(t)}async addWorkspace(t){let e=t.chunks.filter((t=>!be(this.chunks,t)));await this.low.prepareChunks(e),this.chunks.push(...e),this.workspaces.push(t)}clearWorkspaces(){this.chunks.length&&this.low.dropChunks(this.chunks),this.chunks=[]}placePixels(t){return this.low.placePixels(t)}async smartPlace(t,e){for(t=t.slice(0);;){if(e?.triggered)throw Yt;let n=t.shift();if(!n)break;await this.low.placePixels([n]);let r=Pt(t);r&&await this.waitBecausePixelsDistance(n,r)}e&&e.destroy()}async download({bounds:t,onProgress:e}){let{x1:n,y1:r,x2:i,y2:o}=t;if(e){let t=this.low.getChunksCoords(n,r,i,o),a=0;this.low.on("chunk",(n=>{t.some((t=>t[0]===n[0]&&t[1]===n[1]))&&(a++,e(a/t.length))}))}await this.low.prepareChunks(this.low.getChunksCoords(n,r,i,o));let a=Bt(t.width,t.height),s=a.getImageData(0,0,t.width,t.height),l=s.data;for(let t=r,e=0;t!==o;t++)for(let r=n;r!==i;r++,e+=4){let n=this.palette.idToRGBA(this.get(r,t));void 0!==n?l.set(n,e):console.debug("wrong id",this.get(r,t),"at",r,t)}a.putImageData(s,0,0);let c=new Date,h=c.getDate()+"-"+(c.getMonth()+1)+"-"+c.getFullYear()+"_"+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds();ue(a.canvas,`${h}_${n}_${r}_${i}_${o}`)}destroy(){return this.low.destroy()}waitBecausePixelsDistance(t,e){let n,r=Math.sqrt(gt(t.x-e.x)+gt(t.y-e.y));return n=1===r?50:r<1.5?100:125*r,mt(Math.min(.75*this.info.minCd,n))}},we=class{constructor(){this.updatedAt=0,this.cooldown=0}update(t){this.cooldown=t,this.updatedAt=Date.now()}get(){return Math.max(0,this.cooldown-(Date.now()-this.updatedAt))}},_e=class{static{this.REG_CANVAS_OP=160}static{this.REG_CHUNK_OP=161}static{this.DEREG_CHUNK_OP=162}static{this.REG_MCHUNKS_OP=163}static{this.DEREG_MCHUNKS_OP=164}static{this.CHANGE_ME_OP=166}static{this.ONLINE_COUNTER_OP=167}static{this.PING_OP=176}static{this.PIXEL_UPDATE_OP=193}static{this.COOLDOWN_OP=194}static{this.PIXEL_RETURN_OP=195}static{this.CHUNK_UPDATE_MB_OP=196}static{this.PIXEL_UPDATE_MB_OP=197}static{this.CAPTCHA_RETURN_OP=198}static deserializePixelUpdate(t){let e=t.getUint8(1),n=t.getUint8(2),r=[],i=t.byteLength;for(;i>3;){let e=t.getUint8(i-=1),n=t.getUint16(i-=2),o=t.getUint8(i-=1)<<16;r.push([o|n,e])}return{i:e,j:n,pixels:r}}static deserializePixelReturn(t){return{retCode:t.getUint8(1),wait:t.getUint32(2),coolDownSeconds:t.getInt16(6),pxlCnt:t.getUint8(8),rankedPxlCnt:t.getUint8(9)}}static deserializeCoolDown(t){return t.getUint32(1)}static deserializeCaptchaReturn(t){return t.getUint8(1)}static serializeRegCanvas(t){let e=new ArrayBuffer(2),n=new DataView(e);return n.setInt8(0,this.REG_CANVAS_OP),n.setInt8(1,Number(t)),e}static serializeRegChunk(t){let e=new ArrayBuffer(3),n=new DataView(e);return n.setInt8(0,this.REG_CHUNK_OP),n.setInt16(1,t),e}static serializeDeRegChunk(t){let e=new ArrayBuffer(3),n=new DataView(e);return n.setInt8(0,this.DEREG_CHUNK_OP),n.setInt16(1,t),e}static serializeRegMChunks(t){let e=new ArrayBuffer(2+2*t.length),n=new Uint16Array(e);n[0]=this.REG_MCHUNKS_OP;for(let e=0;e<t.length;e+=1)n[e+1]=t[e];return e}static serializeDeRegMChunks(t){let e=new ArrayBuffer(2+2*t.length),n=new Uint16Array(e);n[0]=this.DEREG_MCHUNKS_OP;for(let e=0;e<t.length;e+=1)n[e+1]=t[e];return e}static serializePing(){return new Uint8Array([this.PING_OP]).buffer}static serializePixelUpdate(t,e,n){let r=new ArrayBuffer(3+4*n.length),i=new DataView(r);i.setUint8(0,this.PIXEL_UPDATE_OP),i.setUint8(1,t),i.setUint8(2,e);let o=2,a=n.length;for(;a;){a-=1;let[t,e]=n[a];i.setUint8(o+=1,t>>>16),i.setUint16(o+=1,65535&t),i.setUint8(o+=2,e)}return r}},ve=class extends _e{static{this.PIXEL_UPDATE_OP=145}},xe=t=>{let{size:e}=t;return{palette:{offset:t.cli,colors:t.colors},chunkWidth:256,chunkHeight:256,worldWidth:e,worldHeight:e,haveStack:!0,stack:t.cds,minCd:t.bcd,maxCd:t.pcd,borders:new Xt(-e/2,-e/2,e/2,e/2)}},ke=class extends Wt{constructor(){super(...arguments),this.timer=new we}get chunkSize(){return this.info.chunkWidth*this.info.chunkHeight}getChunksCoords(t,e,n,r){t=Math.floor((t+this.info.worldWidth/2)/this.info.chunkWidth),e=Math.floor((e+this.info.worldHeight/2)/this.info.chunkHeight),n=Math.floor((n-1+this.info.worldWidth/2)/this.info.chunkWidth),r=Math.floor((r-1+this.info.worldHeight/2)/this.info.chunkHeight);let i=[];for(let o=t;o<=n;o++)for(let t=e;t<=r;t++)i.push([o,t]);return i}toTiled(t,e){return t+=this.info.worldWidth>>1,e+=this.info.worldHeight>>1,[Math.floor(t/this.info.chunkWidth),Math.floor(e/this.info.chunkHeight),e%this.info.chunkHeight*this.info.chunkWidth+t%this.info.chunkWidth]}toWorld(t,e,n){return[t*this.info.chunkWidth-(this.info.worldWidth>>1)+n%this.info.chunkWidth,e*this.info.chunkHeight-(this.info.worldHeight>>1)+Math.floor(n/this.info.chunkWidth)]}},Ce=class{constructor(){this.dict=new Map}get(t,e){return this.dict.get(this.coordsToIndex(t,e))}delete(t,e){return this.dict.delete(this.coordsToIndex(t,e))}has(t,e){return this.dict.has(this.coordsToIndex(t,e))}set(t,e,n){this.dict.set(this.coordsToIndex(e,n),t)}clear(){this.dict.clear()}coordsToIndex(t,e){return t.toString()+"_"+e.toString()}},Ae=class{constructor(t){this.data=t}get length(){return this.data.length}get(t){return this.data[t]}set(t,e){this.data[t]=e}},Te=zl(Yl()),Me=0,Pe=1,Ee=2,Se=3,Ie=4,Le=5,Oe=6,De=7,Be=8,je=9,ze=10,Ne=11,Re=12,Ue=13,We=14,Fe={errCaptchaTimeout:new Error("You took too long, try again."),errInvalidSolution:new Error("No or invalid captcha text")},He=(()=>{if(!unsafeWindow?.ssv?.shard||"fuckyouarkeros.fun"===unsafeWindow.location.host)return"";let t=window.location.host.split(".");return t.length>2&&t.shift(),`${unsafeWindow.ssv.shard}.${t.join(".")}`})(),Ge=He&&`${unsafeWindow.location.protocol}//${He}`,$e=t=>t[0]<<8|t[1],Ke=t=>[t>>8,255&t],Ye=class t extends ke{constructor({canvasId:t}){super(),this._info=Je,this.loadQueue=[],this.pixelsDelay=150+50*Math.random(),this.delayedPixels=[],this.chunks=new Ce,this.maxLoaders=5,this.loaders=[],this.chunksProcessing=!1,this.local=new Wt,this.timer=new we,this.packets=_e,this.canvasId=t,this.ws=new Zt(this.getWsUrl()),this.ws.on("connect",(async()=>{for(this.emit("connect"),this.selectCanvas(this.canvasId),this.emit("ready");await mt(19e3),!this.ws.disconnected;)this.ws.send(this.packets.serializePing())})),this.ws.on("binary",(t=>{let e=new DataView(t);switch(e.getUint8(0)){case this.packets.PIXEL_UPDATE_OP:this.handleArrivedPixel(this.packets.deserializePixelUpdate(e));break;case this.packets.PIXEL_RETURN_OP:let{retCode:t,wait:n}=this.packets.deserializePixelReturn(e);this.timer.update(n),this.local.emit("ret_code",t);break;case this.packets.CAPTCHA_RETURN_OP:this.local.emit("captcha_result",this.packets.deserializeCaptchaReturn(e));break;case this.packets.COOLDOWN_OP:this.timer.update(this.packets.deserializeCoolDown(e))}})),this.ws.on("disconnect",(()=>this.emit("disconnect")))}static{this.me=null}get info(){if(this._info===Je)throw ge.errAPIIsntReady;return this._info}set info(t){this._info=t}static async build(e){let n=await t.getMe(),r=new this({canvasId:e});return r.info=xe(n.canvases[e]),await r.ws.connect(),r}static async fetchSiteCanvases(){return le(`${Ge}/api/me`)}static async getMe(){return t.me||(t.me=await t.fetchSiteCanvases()),t.me}static async getCanvasIdByCanvasIdent(e){let n=await t.getMe();for(let[t,r]of Object.entries(n.canvases))if(r.ident===e)return+t;throw new Error("no canvas char in me info")}getCanvasNameByIdent(e){for(let n in t.me.canvases){let r=t.me.canvases[n];if(r.ident===e)return r.title}return null}getWsUrl(){return`${"https:"===window.location.protocol?"wss:":"ws:"}//${He||window.location.host}/ws`}get(t,e){for(let n of this.delayedPixels){let r=n.find((n=>n.x===t&&n.y===e));if(r)return r.id}return this.getHumanlike(t,e)}getHumanlike(t,e){let n=this.toTiled(t,e);return this.chunks.get(n[0],n[1]).get(n[2])}dropChunks(t){let e=[];for(let n of t){let t=$e(n);if(this.chunks.has(n[0],n[1])){e.push(n),this.chunks.delete(n[0],n[1]);continue}if(this.loadQueue.includes(t)){this.loadQueue=this.loadQueue.filter((e=>e!==t));continue}let r=this.loaders.filter((e=>e.chunk===t));r.length&&(r.forEach((t=>t.aborter.abort())),this.loaders=this.loaders.filter((e=>e.chunk!==t)))}e.length&&this.deRegisterChunks(e)}async prepareChunks(t){this.ws.disconnected&&await this.wait("ready"),t.forEach((t=>this.loadQueue.push($e(t)))),this.processMarked(),await this.waitChunks(t)}async placePixels(t){let e=this.groupPixels(t);for(let t in e){let n,r=e[t],i=Ke(+t);this.emit("place_pixels",r.map((({offset:t,id:e})=>{let[n,r]=this.toWorld(i[0],i[1],t);return{x:n,y:r,id:e}}))),this.ws.send(this.packets.serializePixelUpdate(i[0],i[1],r.map((t=>[t.offset,t.id]))));try{n=await this.local.wait("ret_code",4e3)}catch(t){let e=t;throw e===Kt?ge.errNoPlacePixelResult:e}switch(n){case Me:break;case Pe:case Ee:case Se:case Ie:case Le:throw ge.errCanvasAPIInteraction;case Oe:throw ge.errMustAuth;case De:throw ge.errTooLowScore;case Be:throw ge.errPixelProtected;case je:throw ge.errFullStack;case ze:throw ge.errCaptcha;case Ne:throw ge.errYouAreProxy;case Re:throw ge.errTooLowScore;case Ue:throw ge.errParallelPlace;case We:throw ge.errYouAreBanned;default:throw new Error(`unknown retcode: ${n}`)}}}async getCaptcha(){let t=await fetch(Ge+"/captcha.svg",{cache:"no-cache"});if(!t.ok||200!==t.status)throw ge.errCanvasAPIInteraction;let e=URL.createObjectURL(await t.blob()),n=t.headers.get("captcha-id");if(null===n)throw ge.errCanvasAPIInteraction;return{id:n,svg:await fetch(e).then((t=>t.text()))}}async sendAnswer({solution:t,id:e}){this.ws.send(`cs,${JSON.stringify([t,e])}`);let n=await this.local.wait("captcha_result"),r=[!0,Fe.errCaptchaTimeout,!1,Fe.errInvalidSolution,ge.errCanvasAPIInteraction];return r.length>n?r[n]:ge.errUnknownError}predictCooldown(t,e){let n=this.toTiled(t,e);return this.chunks.get(n[0],n[1]).get(n[2])<this.info.palette.offset?this.info.minCd:this.info.maxCd}destroy(){return this.dropChunks(this.loadQueue.map(Ke)),this.ws.disconnect()}groupPixels(t){let e=(0,Te.group)(t).by((t=>$e(this.toTiled(t.x,t.y).slice(0,2)))).asArrays(),n={};return e.forEach((t=>{let e=this.toTiled(t[0].x,t[0].y),r=$e(e.slice(0,2));n[r]=t.map((t=>({offset:this.toTiled(t.x,t.y)[2],id:t.id})))})),n}async waitChunks(t){for(t=t.slice().filter((t=>!this.chunks.has(t[0],t[1])));t.length;){let e=await this.wait("chunk",1e4),n=$e(e),r=t.findIndex((t=>$e(t)===n));-1!==r&&t.splice(r,1)}}processMarked(){if(!this.chunksProcessing){for(this.chunksProcessing=!0;this.loaders.length<this.maxLoaders;){let t=this.loadQueue.pop();if(void 0===t)break;let e=Ke(t);if(this.chunks.has(e[0],e[1])||this.loaders.some((e=>e.chunk===t)))continue;let n={chunk:t,aborter:new AbortController};this.loaders.push(n),this.fetchChunk(e,n.aborter).then((t=>{this.chunks.set(t,e[0],e[1]),this.registerChunk(e),this.loaders.splice(this.loaders.indexOf(n),1),this.processMarked()}))}this.chunksProcessing=!1}}getChunkUrl(t){return`${Ge}/chunks/${this.canvasId}/${t[0]}/${t[1]}.bmp`}async fetchChunk(t,e){let n=e?{signal:e.signal}:{},r=await fetch(this.getChunkUrl(t),n);if(!r.ok)throw console.debug(r),ge.errResponseIsntOk;if(200!==r.status)throw console.debug(r),ge.errResponseStatusIsnt200;let i=await r.arrayBuffer(),o=new Uint8Array(i),a=new Uint32Array(this.chunkSize);if(i.byteLength)for(let t=0;t!==o.length;t++)a[t]=63&o[t];return this.emit("chunk",t),new Ae(a)}registerChunk(t){this.ws.send(this.packets.serializeRegChunk($e(t)))}deRegisterChunks(t){this.ws.send(this.packets.serializeDeRegMChunks(t.map((t=>$e(t)))))}toTiled(t,e){let n=t+(this.info.worldWidth>>1),r=e+(this.info.worldHeight>>1);return[n>>8,r>>8,(255&r)<<8|255&n]}toWorld(t,e,n){return[(t<<8)-(this.info.worldWidth>>1)+(255&n),(e<<8)-(this.info.worldHeight>>1)+(n>>8)]}selectCanvas(t){this.ws.send(this.packets.serializeRegCanvas(t))}handleArrivedPixel(t){let e=t.pixels.map((e=>{let[n,r]=this.toWorld(t.i,t.j,e[0]);return{x:n,y:r,id:e[1]}}));this.emit("pixels",e),this.delayedPixels.push(e),setTimeout((()=>{let n=this.delayedPixels.indexOf(e);if(-1!==n){this.delayedPixels.splice(n,1);let e=this.chunks.get(t.i,t.j);e&&t.pixels.forEach((t=>e.set(t[0],t[1])))}}),this.pixelsDelay)}},qe=new class extends Wt{constructor(){super(...arguments),this.call=this.emit}},Qe=class extends Wt{goto(t){let e=this.getCurrentLocation(),n=t.canvasIdent?`${t.canvasIdent},`:e?.canvasIdent?`${e.canvasIdent},`:"",r=`${t.x},`,i=`${t.y},`,o=t.zoom?`${t.zoom},`:e?.zoom?`${e.zoom},`:"";location.hash=n+r+i+o}getCurrentLocation(){if(!location.hash)return null;let t=location.hash.split(",").filter(Boolean);if(t.length<4)return null;let e=t[0].substring(1),n=t[1],r=t[2],i=t[3];return{canvasIdent:e,x:Number(n),y:Number(r),zoom:Number(i)}}},Ve=async()=>new Qe,Ze=h(n),Xe=class t extends Ye{constructor(){super(...arguments),this.packets=ve}getChunkUrl(t){return`https://cdn.gs-os.com/chunks/${this.canvasId}/${t[0]}/${t[1]}.bmp`}static async fetchSiteCanvases(){let t=await fetch(location.origin+"/api/canvases"),{canvases:e}=await t.json();return{canvases:e}}static async build(e){let n=await t.getMe(),r=new this({canvasId:e});return r.info=xe(n.canvases[e]),await r.ws.connect(),r}static async getMe(){return t.me||(t.me=await t.fetchSiteCanvases()),t.me}static async getCanvasIdByCanvasIdent(e){let n=await t.getMe();for(let[t,r]of Object.entries(n.canvases))if(r.ident===e)return+t;throw new Error("no canvas char in me info")}},Je={palette:{offset:0,colors:[]},chunkWidth:0,chunkHeight:0,worldWidth:0,worldHeight:0,haveStack:!1,stack:0,minCd:0,maxCd:0,borders:new Xt(0,0,0,0)},tn=class extends _e{static{this.TIMESTAMP_OP=168}static{this.dehydrateTimestamp=t=>{let e=new ArrayBuffer(5),n=new DataView(e);return n.setUint8(0,this.TIMESTAMP_OP),n.setInt32(1,+t.getTime().toString().slice(0,5)),e}}},en=h(n),nn=class extends Ye{constructor(t){super({canvasId:t}),this.packets=tn,this.ws.on("connect",(()=>{this.ws.send(this.packets.dehydrateTimestamp(new Date))}))}},rn=class extends _e{static{this.TOKEN=199}static{this.deserializeTokenPacket=t=>{if(t.byteLength<4)return null;let e=t.getUint8(1),n=t.getUint16(2);if(n>0&&4+n<=t.byteLength){let r=new Uint8Array(t.buffer,4,n),i=new Uint8Array(n);for(let t=0;t<n;t++)i[t]=r[t]^e+t&255;try{return{token:new TextDecoder("utf-8").decode(i),timestamp:Date.now()}}catch(t){return console.error("Failed to decode canvas token",t),null}}}}static serializePixelUpdate(t,e,n){let r=new ArrayBuffer(3+4*n.length),i=new DataView(r);i.setUint8(0,this.PIXEL_UPDATE_OP),i.setUint8(1,e),i.setUint8(2,t);let o=2,a=n.length;for(;a;){a-=1;let[t,e]=n[a];i.setUint8(o+=1,t>>>16),i.setUint16(o+=1,65535&t),i.setUint8(o+=2,e)}return r}},on=h((()=>{n()})),an=class t extends Ye{constructor(){super(...arguments),this.packets=rn,this._token=null,this._tokenTimestamp=null}getRequestHeaders(){return this._token&&Date.now()-this._tokenTimestamp<55e3?{"X-Canvas-Token":this._token}:{}}async fetchSiteCanvases(){let t=this.getRequestHeaders();if(!t["X-Canvas-Token"])throw new Error("no canvas token");return le("https://scb.pixmap.fun/api/me",{credentials:"include",headers:t})}static async build(){let e=new this({canvasId:-1});e.ws.removeAllListeners("connect"),e.ws.on("connect",(async()=>{for(e.emit("connect");await mt(19e3),!e.ws.disconnected;)e.ws.send(e.packets.serializePing())})),await e.ws.connect();let{resolve:n,promise:r}=Promise.withResolvers(),i=t=>{let r=new DataView(t);if(r.getUint8(0)===e.packets.TOKEN){let t=e.packets.deserializeTokenPacket(r);t&&(e._token=t.token,e._tokenTimestamp=t.timestamp),e.ws.off("binary",i),n()}};e.ws.on("binary",i),await r,t.me=await e.fetchSiteCanvases();let o=location.hash.match(/#[a-z]/g),a=o?o[0][1]:"d";return e.canvasId=await t.getCanvasIdByCanvasIdent(a),e.info=xe(t.me.canvases[e.canvasId]),e.selectCanvas(e.canvasId),e.emit("ready"),e}static async getCanvasIdByCanvasIdent(e){let n=await t.getMe();for(let[t,r]of Object.entries(n.canvases))if(r.ident===e)return+t;throw new Error("no canvas char in me info")}static async getMe(){if(!t.me)throw new Error("no me info in PixmapAPI");return t.me}getWsUrl(){return location.origin.replace("http","ws")+"/ws"}},sn=h(n),ln=class extends Ye{},cn=class extends _e{static{this.PIXEL_UPDATE_OP=145}},hn=h(n),un=class extends Ye{constructor(){super(...arguments),this.packets=cn}},dn=class extends _e{static{this.PIXEL_UPDATE_OP=145}},pn=h(n),gn=class t extends Ye{constructor(){super(...arguments),this.packets=dn}static async fetchSiteCanvases(){let t=await fetch(location.origin+"/api/canvases"),{canvases:e}=await t.json();return{canvases:e}}static async build(e){let n=await t.getMe(),r=new this({canvasId:e});return r.info=xe(n.canvases[e]),await r.ws.connect(),r}static async getMe(){return t.me||(t.me=await t.fetchSiteCanvases()),t.me}static async getCanvasIdByCanvasIdent(e){let n=await t.getMe();for(let[t,r]of Object.entries(n.canvases))if(r.ident===e)return+t;throw new Error("no canvas char in me info")}},mn=h(n),fn=class extends Ye{},bn=[{tileSize:1e3,zoom:11}],yn=4,wn=2*Math.PI*6378137/2,_n=class{static parseTileCoords(t){let[e,n]=t.split("_").map(Number);return{tileX:e,tileY:n}}static stringifyTileCoords(t,e){return`${t}_${e}`}constructor(t=256){this.tileSize=t,this.initialResolution=2*wn/this.tileSize}latLonToMeters(t,e){return[e/180*wn,Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180)*wn/180]}metersToLatLon(t,e){let n=t/wn*180,r=e/wn*180;return r=180/Math.PI*(2*Math.atan(Math.exp(r*Math.PI/180))-Math.PI/2),[r,n]}pixelsToMeters(t,e,n){let r=this.resolution(n);return[t*r-wn,wn-e*r]}pixelsToLatLon(t,e,n){let[r,i]=this.pixelsToMeters(t,e,n);return this.metersToLatLon(r,i)}latLonToPixels(t,e,n){let[r,i]=this.latLonToMeters(t,e);return this.metersToPixels(r,i,n)}latLonToPixelsFloor(t,e,n){let[r,i]=this.latLonToPixels(t,e,n);return[Math.floor(r),Math.floor(i)]}metersToPixels(t,e,n){let r=this.resolution(n);return[(t+wn)/r,(wn-e)/r]}latLonToTile(t,e,n){let[r,i]=this.latLonToMeters(t,e);return this.metersToTile(r,i,n)}metersToTile(t,e,n){let[r,i]=this.metersToPixels(t,e,n);return this.pixelsToTile(r,i)}pixelsToTile(t,e){return[Math.ceil(t/this.tileSize)-1,Math.ceil(e/this.tileSize)-1]}pixelsToTileLocal(t,e){return{tile:this.pixelsToTile(t,e),pixel:[Math.floor(t)%this.tileSize,Math.floor(e)%this.tileSize]}}tileBounds(t,e,n){let[r,i]=this.pixelsToMeters(t*this.tileSize,e*this.tileSize,n),[o,a]=this.pixelsToMeters((t+1)*this.tileSize,(e+1)*this.tileSize,n);return{min:[r,i],max:[o,a]}}tileBoundsLatLon(t,e,n){let r=this.tileBounds(t,e,n);return{min:this.metersToLatLon(r.min[0],r.min[1]),max:this.metersToLatLon(r.max[0],r.max[1])}}resolution(t){return this.initialResolution/2**t}latLonToTileAndPixel(t,e,n){let[r,i]=this.latLonToMeters(t,e),[o,a]=this.metersToTile(r,i,n),[s,l]=this.metersToPixels(r,i,n);return{tile:[o,a],pixel:[Math.floor(s)%this.tileSize,Math.floor(l)%this.tileSize]}}pixelBounds(t,e,n){return{min:this.pixelsToMeters(t,e,n),max:this.pixelsToMeters(t+1,e+1,n)}}pixelToBoundsLatLon(t,e,n){let r=this.pixelBounds(t,e,n),i=.001885,o=(r.max[0]-r.min[0])*i,a=(r.max[1]-r.min[1])*i;return r.min[0]-=o,r.max[0]-=o,r.min[1]-=a,r.max[1]-=a,{min:this.metersToLatLon(r.min[0],r.min[1]),max:this.metersToLatLon(r.max[0],r.max[1])}}latLonToTileBoundsLatLon(t,e,n){let[r,i]=this.latLonToMeters(t,e),[o,a]=this.metersToTile(r,i,n);return this.tileBoundsLatLon(o,a,n)}latLonToPixelBoundsLatLon(t,e,n){let[r,i]=this.latLonToMeters(t,e),[o,a]=this.metersToPixels(r,i,n);return this.pixelToBoundsLatLon(Math.floor(o),Math.floor(a),n)}latLonToRegionAndPixel(t,e,n,r=yn){let[i,o]=this.latLonToPixelsFloor(t,e,n),a=this.tileSize*r;return{region:[Math.floor(i/a),Math.floor(o/a)],pixel:[i%a,o%a]}}tiledToWorld(t,e,n){let r=~~(n/this.tileSize),i=n-r*this.tileSize;return[t*this.tileSize+i,e*this.tileSize+r]}latLonToWorld(t,e,n){let{tile:r,pixel:i}=this.latLonToTileAndPixel(t,e,n);return[r[0]*this.tileSize+i[0],r[1]*this.tileSize+i[1]]}worldToTiled(t,e){let n=Math.floor(t/this.tileSize),r=Math.floor(e/this.tileSize);return[n,r,t-n*this.tileSize+(e-r*this.tileSize)*this.tileSize]}latLonToTiled(t,e,n){let{tile:r,pixel:i}=vn.latLonToTileAndPixel(t,e,n);return[r[0],r[1],i[0]+i[1]*this.tileSize]}worldToLatLon(t,e,n){throw new Error("not implemented")}},vn=new _n(bn[0].tileSize),xn=[[170,170,170],[165,14,30],[250,128,114],[228,92,26],[214,181,148],[156,132,49],[197,173,49],[232,212,95],[74,107,58],[90,148,74],[132,197,115],[15,121,159],[187,250,242],[125,199,255],[77,49,184],[74,66,132],[122,113,196],[181,174,241],[219,164,99],[209,128,81],[255,197,165],[155,82,73],[209,128,120],[250,182,164],[123,99,82],[156,132,107],[51,57,65],[109,117,141],[179,185,209],[109,100,63],[148,140,107],[205,197,158]],kn=[...[{name:"Transparent",rgba:[0,0,0,0]},{name:"Black",rgba:[0,0,0,255]},{name:"Dark Gray",rgba:[60,60,60,255]},{name:"Gray",rgba:[120,120,120,255]},{name:"Light Gray",rgba:[210,210,210,255]},{name:"White",rgba:[255,255,255,255]},{name:"Deep Red",rgba:[96,0,24,255]},{name:"Red",rgba:[237,28,36,255]},{name:"Orange",rgba:[255,127,39,255]},{name:"Gold",rgba:[246,170,9,255]},{name:"Yellow",rgba:[249,221,59,255]},{name:"Light Yellow",rgba:[255,250,188,255]},{name:"Dark Green",rgba:[14,185,104,255]},{name:"Green",rgba:[19,230,123,255]},{name:"Light Green",rgba:[135,255,94,255]},{name:"Dark Teal",rgba:[12,129,110,255]},{name:"Teal",rgba:[16,174,166,255]},{name:"Light Teal",rgba:[19,225,190,255]},{name:"Dark Blue",rgba:[40,80,158,255]},{name:"Blue",rgba:[64,147,228,255]},{name:"Cyan",rgba:[96,247,242,255]},{name:"Indigo",rgba:[107,80,246,255]},{name:"Light Indigo",rgba:[153,177,251,255]},{name:"Dark Purple",rgba:[120,12,153,255]},{name:"Purple",rgba:[170,56,185,255]},{name:"Light Purple",rgba:[224,159,249,255]},{name:"Dark Pink",rgba:[203,0,122,255]},{name:"Pink",rgba:[236,31,128,255]},{name:"Light Pink",rgba:[243,141,169,255]},{name:"Dark Brown",rgba:[104,70,52,255]},{name:"Brown",rgba:[149,104,42,255]},{name:"Beige",rgba:[248,178,119,255]},{name:"Medium Gray",rgba:[170,170,170,255]},{name:"Dark Red",rgba:[165,14,30,255]},{name:"Light Red",rgba:[250,128,114,255]},{name:"Dark Orange",rgba:[228,92,26,255]},{name:"Light Tan",rgba:[214,181,148,255]},{name:"Dark Goldenrod",rgba:[156,132,49,255]},{name:"Goldenrod",rgba:[197,173,49,255]},{name:"Light Goldenrod",rgba:[232,212,95,255]},{name:"Dark Olive",rgba:[74,107,58,255]},{name:"Olive",rgba:[90,148,74,255]},{name:"Light Olive",rgba:[132,197,115,255]},{name:"Dark Cyan",rgba:[15,121,159,255]},{name:"Light Cyan",rgba:[187,250,242,255]},{name:"Light Blue",rgba:[125,199,255,255]},{name:"Dark Indigo",rgba:[77,49,184,255]},{name:"Dark Slate Blue",rgba:[74,66,132,255]},{name:"Slate Blue",rgba:[122,113,196,255]},{name:"Light Slate Blue",rgba:[181,174,241,255]},{name:"Light Brown",rgba:[219,164,99,255]},{name:"Dark Beige",rgba:[209,128,81,255]},{name:"Light Beige",rgba:[255,197,165,255]},{name:"Dark Peach",rgba:[155,82,73,255]},{name:"Peach",rgba:[209,128,120,255]},{name:"Light Peach",rgba:[250,182,164,255]},{name:"Dark Tan",rgba:[123,99,82,255]},{name:"Tan",rgba:[156,132,107,255]},{name:"Dark Slate",rgba:[51,57,65,255]},{name:"Slate",rgba:[109,117,141,255]},{name:"Light Slate",rgba:[179,185,209,255]},{name:"Dark Stone",rgba:[109,100,63,255]},{name:"Stone",rgba:[148,140,107,255]},{name:"Light Stone",rgba:[205,197,158,255]}].map((t=>t.rgba)),...xn.map((t=>[...t,255]))],Cn=class extends Wt{constructor({loadChunk:t,concurrency:e}){super(),this.queue=[],this.loadChunk=t,this.concurrency=e}get activeLoaders(){return this.queue.filter((t=>t.loading))}get inactiveLoaders(){return this.queue.filter((t=>!t.loading))}add(t){let e=this.get(t);return e||(e={coords:t,controller:new AbortController,result:null,loading:!1},this.queue.push(e),this.processQueue(),e)}processQueue(){for(;this.activeLoaders.length<this.concurrency;){let t=this.inactiveLoaders.at(0);if(!t)break;t.loading=!0,this.loadChunk(t.coords,t.controller).then((e=>{t.result=e,this.emit("chunk_loaded",{...t,result:e})})).catch((e=>{console.error("error at loading chunk",t.coords,e)})).finally((()=>{t.loading=!1,this.remove(t.coords),this.processQueue()}))}}async waitChunks(t){let e=t.map((t=>{let e=this.get(t);if(!e)throw new Error(`Loader not found for coords ${t}`);return e})),n=e.filter((t=>t.result)),r=e.filter((t=>!t.result));if(0===r.length){if(n.length!==t.length)throw new Error("coordsList and loaded chunks length mismatch");return n}let{promise:i,resolve:o,reject:a}=Promise.withResolvers();r.forEach((t=>{t.controller.signal.addEventListener("abort",(()=>{a(new Error(`loader for ${t.coords} was aborted`))}))}));let s=t=>{let e=r.findIndex((e=>e.coords[0]===t.coords[0]&&e.coords[1]===t.coords[1]));-1!==e&&(n.push(t),r.splice(e,1),0===r.length&&(this.off("chunk_loaded",s),o(n)))};return this.on("chunk_loaded",s),i}get(t){let e=this.getIndex(t);return-1===e?null:this.queue[e]}has(t){return-1!==this.getIndex(t)}getIndex(t){return this.queue.findIndex((e=>e.coords[0]===t[0]&&e.coords[1]===t[1]))}remove(t){let e=this.getIndex(t);-1!==e&&(this.queue[e].loading&&this.queue[e].controller.abort(),this.queue.splice(e,1))}destroy(){for(;;){let t=this.queue.pop();if(!t)break;t.loading&&t.controller.abort()}}},An=new Error("Refresh required"),Tn=new Error("Too many requests"),Mn=new class{constructor(t){this.localStorageData={},this.data={},this.localStorageKey="storage",this.emitter=new Rt,t&&t.localStorageKey&&(this.localStorageKey=t.localStorageKey),this.load()}on(t,e){this.emitter.on(t,e)}set(t,e,n=!0){if(n&&t in this.data||!n&&t in this.localStorageData)throw new Error(`try to duplicate field "${t}" with value "${e}"`);n?(this.localStorageData[t]=e,this.save()):this.data[t]=e,this.emitter.emit(t,e)}get(t){return t in this.data?this.data[t]:t in this.localStorageData?this.localStorageData[t]:null}has(t){return t in this.data||t in this.localStorageData}delete(t){t in this.data&&delete this.data[t],t in this.localStorageData&&delete this.localStorageData[t]}save(){Object.keys(this.localStorageData).length&&localStorage.setItem(this.localStorageKey,JSON.stringify(this.localStorageData))}load(){let t=localStorage.getItem(this.localStorageKey);null!==t&&(this.localStorageData=JSON.parse(t))}}({localStorageKey:se}),Pn="human",En={smartPlace:!0,showErrors:!0},Sn=!0,In=!0,Ln=[16,16],On={switch_bot:"b",change_template_coords_to_mouse:"n"},Dn={a:"KeyA",b:"KeyB",c:"KeyC",d:"KeyD",e:"KeyE",f:"KeyF",g:"KeyG",h:"KeyH",i:"KeyI",j:"KeyJ",k:"KeyK",l:"KeyL",m:"KeyM",n:"KeyN",o:"KeyO",p:"KeyP",q:"KeyQ",r:"KeyR",s:"KeyS",t:"KeyT",u:"KeyU",v:"KeyV",w:"KeyW",x:"KeyX",y:"KeyY",z:"KeyZ"},Bn=Object.fromEntries(Object.entries(Dn).map((([t,e])=>[e,t]))),jn=class{constructor({blockInputPredicate:t}){this.emitter=new Rt,window.addEventListener("keydown",(e=>{t(e)||this.emit(e)}))}static getCode(t){return Dn[t]}static getKey(t){return Bn[t]}on(t,e){"*"===t?this.emitter.on("*",e):this.emitter.on(t,e)}off(t,e){"*"===t?this.emitter.off("*",e):this.emitter.off(Dn[t],e)}emit(t){this.emitter.emit(Bn[t.code],t),this.emitter.emit("*",t)}once(t,e){"*"===t?this.emitter.once("*",e):this.emitter.once(Dn[t],e)}removeAllListeners(t){t?this.emitter.removeAllListeners(Dn[t]):this.emitter.removeAllListeners()}},zn=class t{constructor(e){this.keyboard=new jn({blockInputPredicate:()=>!(!Et(".show form")&&!Et("#wm .show"))}),this.currentMap=t.cloneMap(e),this.set(e)}static cloneMap(t){return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,e])))}getCurrentMap(){return this.currentMap}set(e){this.currentMap=t.cloneMap(e),this.rebind()}inputNewBinding({action:e,onChange:n}){this.keyboard.removeAllListeners();let r=i=>{let o=jn.getKey(i.code);this.hasKeyInMap(o)||(this.currentMap[e]=o,n(t.cloneMap(this.currentMap)),this.keyboard.off("*",r))};this.keyboard.on("*",(t=>r(t)));let i=new AbortController;return i.signal.addEventListener("abort",(()=>{this.keyboard.off("*",r),this.rebind()})),i}rebind(){this.keyboard.removeAllListeners();for(let t of Nn){let e=t,n=this.currentMap[e];this.keyboard.on(n,(()=>qe.call(e)))}}hasKeyInMap(t){return Object.values(this.currentMap).includes(t)}},Nn=["switch_bot","change_template_coords_to_mouse"],Mn.has("strategy")||Mn.set("strategy",Pn),Mn.has("stopOnCaptcha")||Mn.set("stopOnCaptcha",Sn),Mn.has("smartPlace")||Mn.set("smartPlace",In),Mn.has("debug")||Mn.set("debug",!1),Mn.has("keyboard_map")||Mn.set("keyboard_map",On),Mn.has("language")||Mn.set("language",jt()),Mn.has("checkpoints")||Mn.set("checkpoints",[]),Mn.has("fun_thing")||Mn.set("fun_thing",!1),Mn.has("void_theme")||Mn.set("void_theme",!1),Mn.has("start_when_ready")||Mn.set("start_when_ready",!1),Rn=new zn(Mn.get("keyboard_map")),Mn.on("keyboard_map",(t=>Rn.set(t))),Un={storage:Mn,keyboardBindings:Rn,csa:null},Wn=bn[0].zoom,Fn=class t extends Wt{constructor(){super(),this.currentLocation=null,this.guiMousemove=null,this.init()}static{this.instance=null}static getInstance(){return t.instance||(t.instance=new t),t.instance}init(){this.catchMousemoves(),this.catchCaptchaToken(),this.buildCoordsGui()}goto(t){let e=vn.worldToLatLon(t.x,t.y,Wn);location.replace(`${location.origin}/?lat=${e[0]}&lng=${e[1]}&zoom=${t.zoom}`)}getCurrentLocation(){if(!this.currentLocation)return null;let t=vn.latLonToWorld(this.currentLocation[0],this.currentLocation[1],Wn);return{canvasIdent:"",x:t[0],y:t[1],zoom:15}}buildCoordsGui(){let t=document.createElement("div");t.style="position: fixed; z-index: 1000; top: 10px; left: 50%; transform: translateX(-50%); width: 240px; height: auto; background-color: rgba(0, 0, 0, 0.9); color: red; font-family: monospace; border: 1px solid darkred; display: grid; grid-template-columns: auto 1fr; gap: 4px; padding: 4px; white-space: pre-wrap; overflow: hidden;",document.body.appendChild(t),Un.storage.get("debug")?t.style.display="block":t.style.display="none",Un.storage.on("debug",(e=>{t.style.display=e?"block":"none"})),this.guiMousemove=e=>{if(!Un.storage.get("debug"))return;let n=vn.latLonToTileAndPixel(e[0],e[1],Wn),r=vn.latLonToRegionAndPixel(e[0],e[1],Wn);t.innerHTML=`<div>lat:</div><div>${e[0]}</div><div>lng:</div><div>${e[1]}</div><div>tile:</div><div>${n.tile.join("_")} ${n.pixel.join("_")}</div><div>region:</div><div>${r.region.join("_")} ${r.pixel.join("_")}</div><div>world:</div><div>${vn.latLonToWorld(e[0],e[1],Wn).join(" ")}</div>`}}catchMousemoves(){let t=Array.isArray;Array.isArray=e=>{let n=t(e);if(n&&(2===e.length||3===e.length)&&~~e[0]!==e[0]&&~~e[1]!==e[1]&&"number"==typeof e[0]&&"number"==typeof e[1]){this.currentLocation=[e[1],e[0]],this.guiMousemove?.(this.currentLocation);let t=vn.latLonToWorld(this.currentLocation[0],this.currentLocation[1],bn[0].zoom);qe.emit("change_mouse_position",t)}return n}}catchCaptchaToken(){window.addEventListener("message",(t=>{try{if("https://challenges.cloudflare.com"!==t.origin)return;let e=t.data,n=null;e&&"object"==typeof e&&(n=e.token||e.response||e["cf-turnstile-response"]),n&&(console.log("got captcha token",n),this.emit("captcha_token",n))}catch(t){console.warn("error in catchCaptchaToken",t)}}))}},Hn=async()=>Fn.getInstance(),Gn=class t extends Wt{constructor({getToken:t}){super(),this.season=0,this.chunks=new Ce,this.chunkLoadingQueue=new Cn({concurrency:5,loadChunk:this.loadTile.bind(this)}),this._me=null,this.info={...Je,worldWidth:1/0,worldHeight:1/0,borders:new Xt(0,0,1/0,1/0),palette:{offset:1,colors:kn},chunkWidth:bn[0].tileSize,chunkHeight:bn[0].tileSize,haveStack:!0,stack:62},this.palette=new me(this.info.palette.offset,this.info.palette.colors),this.timer=new we,this.getToken=t}async init(){await this.fetchMeAndUpdateState(),this.chunkLoadingQueue.on("chunk_loaded",(t=>{this.chunks.set(t.result,t.coords[0],t.coords[1]),this.emit("chunk",t.coords)})),this.emit("ready")}async fetchMeAndUpdateState(){let e=await t.fetchMeWithRetry();e&&this.updateStateWithMe(e)}getCurrentMe(){if(!this._me)throw ge.errMustAuth;return this._me}updateStateWithMe(t){this._me=t,this.info.stack=t.charges.max*t.charges.cooldownMs,this.info.minCd=t.charges.cooldownMs,this.info.maxCd=t.charges.cooldownMs,this.timer.update((this._me.charges.max-this._me.charges.count)*this._me.charges.cooldownMs)}static async build({getToken:t}){let e=new this({getToken:t});return await e.init(),e}static async fetchMeWithRetry(){try{return await this.fetchMe()}catch(t){console.warn("error while first time fetching me"),console.warn(t)}return await mt(2e3),await this.fetchMe()}static async fetchMe(){let t=await fetch("https://backend.wplace.live/me",{credentials:"include"});return 401===t.status?null:await t.json()}static preparePixelsForSend(t){let e={};return t.forEach((t=>{let[n,r,i]=vn.worldToTiled(t.x,t.y),o=_n.stringifyTileCoords(n,r);e[o]||(e[o]=[]),e[o].push({id:t.id,offset:i})})),e}async destroy(){this.chunkLoadingQueue.destroy(),this.chunks.clear(),this.removeAllListeners()}async prepareChunks(t){t.forEach((t=>this.chunkLoadingQueue.add(t))),await this.chunkLoadingQueue.waitChunks(t)}async dropChunks(t){t.forEach((t=>{this.chunks.delete(t[0],t[1]),this.chunkLoadingQueue.remove(t)}))}getChunksCoords(t,e,n,r){let[i,o]=vn.worldToTiled(t,e),[a,s]=vn.worldToTiled(n,r),l=[];for(let t=i;t<=a;t++)for(let e=o;e<=s;e++)l.push([t,e]);return l}predictCooldown(){return this.getCurrentMe().charges.cooldownMs}get(t,e){let[n,r,i]=vn.worldToTiled(t,e);return this.chunks.get(n,r).get(i)}async placePixels(e){let n=t.preparePixelsForSend(e),r=null;for(let[t,e]of Object.entries(n)){let{tileX:n,tileY:i}=_n.parseTileCoords(t);try{await this.placeTilePixels({tileX:n,tileY:i,pixels:e}),await mt(2e3)}catch(t){r=t;break}}if(r===An)throw r;await this.fetchMeAndUpdateState()}async placeTilePixels({tileX:t,tileY:e,pixels:n}){let r=await fetch(`https://backend.wplace.live/s${this.season}/pixel/${t}/${e}`,{method:"POST",credentials:"include",body:JSON.stringify({colors:n.map((t=>t.id)),coords:n.map((t=>{let e=~~(t.offset/this.info.chunkWidth);return[t.offset-e*this.info.chunkWidth,e]})).flat(),t:this.getToken()})}),i=await r.json();if("error"in i&&"refresh"===i.error)throw An;if(429===r.status)throw Tn;if(!r.ok)throw new Error(`Failed to place pixels for group: ${r.statusText}`);return i}async loadTile(t,e){let n=`https://backend.wplace.live/files/s${this.season}/tiles/${t[0]}/${t[1]}.png`,r=await fetch(n,e);if(!r.ok)throw new Error(`Failed to load chunk ${t[0]}/${t[1]} (${r.status})`);let i=await r.blob(),o=await createImageBitmap(i);if(1===o.width&&1===o.height)return new Ae(new Uint32Array(this.info.chunkWidth*this.info.chunkHeight));let a=Bt(o.width,o.height);a.drawImage(o,0,0);let s=new Uint32Array(a.getImageData(0,0,o.width,o.height).data),l=new Uint32Array(s.length/4);for(let t=0;t<l.length;t++){let e=t<<2,n=this.palette.rgbaToId([s[0|e],s[1|e],s[2|e],s[3|e]]);l[t]=n??0}return o.close(),new Ae(l)}},$n=h(n),Kn=class extends Ye{},Yn=async()=>{if(/.*:\/\/.*(pixelplanet)|(fuckyouarkeros)\.fun.*/.test(location.origin)){let t=location.hash.match(/#[a-z]/g),e=t?t[0][1]:"d",n=await Xe.getCanvasIdByCanvasIdent(e);return Ze(),Promise.all([Xe.build(n),Ve()])}if(/localhost/.test(location.origin)){let t=location.hash.match(/#[a-z]/g),e=t?t[0][1]:"d",n=await un.getCanvasIdByCanvasIdent(e);return hn(),Promise.all([un.build(n),Ve()])}if(/.*:\/\/.*pixmap\.fun.*/.test(location.origin))return on(),Promise.all([an.build(),Ve()]);if(/.*:\/\/.*pixelya\.fun.*/.test(location.origin)){let t=location.hash.match(/#[a-z]/g),e=t?t[0][1]:"d",n=await nn.getCanvasIdByCanvasIdent(e);return en(),Promise.all([nn.build(n),Ve()])}if(/.*:\/\/.*pixelroyal\.fun.*/.test(location.origin)){let t=location.hash.match(/#[a-z]/g),e=t?t[0][1]:"d",n=await ln.getCanvasIdByCanvasIdent(e);return sn(),Promise.all([ln.build(n),Ve()])}if(/.*:\/\/.*pixvas\.fun.*/.test(location.origin)){let t=location.hash.match(/#[a-z]/g),e=t?t[0][1]:"d",n=await gn.getCanvasIdByCanvasIdent(e);return pn(),Promise.all([gn.build(n),Ve()])}if(/.*:\/\/.*countrypixel\.fun.*/.test(location.origin)){let t=location.hash.match(/#[a-z]/g),e=t?t[0][1]:"d",n=await fn.getCanvasIdByCanvasIdent(e);return mn(),Promise.all([fn.build(n),Ve()])}if(/.*:\/\/.*wplace\.live.*/.test(location.origin)){let t=await Hn(),e=await t.wait("captcha_token");return t.on("captcha_token",(t=>{e=t})),[await Gn.build({getToken:()=>e}),t]}if(/.*:\/\/.*pxworld\.xyz.*/.test(location.origin)){let t=location.hash.match(/#[a-z]/g),e=t?t[0][1]:"d",n=await Kn.getCanvasIdByCanvasIdent(e);return $n(),Promise.all([Kn.build(n),Ve()])}throw $t},Bl(qn={},{chessCorner_1x1:()=>Or,chess_1x1:()=>Mr,chess_2x2:()=>Er,chess_3x3:()=>Ir,circle_inToOut:()=>wr,circle_outToIn:()=>vr,line_RightToLeft:()=>br,line_downToUp:()=>pr,line_leftToRight:()=>mr,line_upToDown:()=>ur,random:()=>cr,squareBySquare:()=>Br,throughLine:()=>kr,woyken:()=>zr,zipper:()=>Ar}),Qn=new Error("template unloaded"),Vn=new Error("template unquantized"),Zn=255,Xn=class t extends Xt{constructor(e){super(e.x,e.y,e.x+(e.width??0),e.y+(e.height??0)),this.readyState=t.UNLOADED,this.ctx=null,this.ids=new Uint8Array(0),this.name=e.name}static{this.UNLOADED=0}static{this.LOADING=1}static{this.LOADED=2}static{this.QUANTIZED=3}get canvas(){return this.ctx?.canvas}get size(){return this.width*this.height}get(t,e){return this.ids[t+e*this.width]}isTransparent(t,e){return this.get(t,e)===Zn}iterateOverVisible(t){for(let e=0,n=0;e!==this.height;e++)for(let r=0;r!==this.width;r++,n++){let i=this.ids[n];i!==Zn&&t(r,e,i)}}countTransparent(){if(this.readyState===t.QUANTIZED){let t=0;for(let e of this.ids)e===Zn&&t++;return t}throw Vn}isOutline(t,e){let n=this.get(t,e);return this.get(t-1,e-1)!==n||this.get(t-1,e)!==n||this.get(t-1,e+1)!==n||this.get(t,e-1)!==n||this.get(t,e+1)!==n||this.get(t+1,e-1)!==n||this.get(t+1,e)!==n||this.get(t+1,e+1)!==n}intersects(t,e,n,r){return this.x1<n&&this.x2>t&&this.y1<r&&this.y2>e}async load(e){this.readyState=t.LOADING;let n=await he(e);return this.width=n.width,this.height=n.height,this.ctx=Bt(this.width,this.height),this.ctx.drawImage(n,0,0),this.readyState=t.LOADED,this}quantize(e){if(!this.ctx)throw Qn;let n=this.ctx.getImageData(0,0,this.width,this.height),r=n.data;this.ids=new Uint8Array(r.length>>2);let i=new Map;for(let t=0;t!==r.length;t+=4)if(0===r[3|t])this.ids[t>>2]=255,r[0|t]=r[1|t]=r[2|t]=r[3|t]=0;else{let n=r[0|t]<<24|r[1|t]<<16|r[2|t]<<8|r[3|t],o=i.get(n);o||(o=e.quantize(r[0|t],r[1|t],r[2|t],r[3|t]),i.set(n,o)),this.ids[t>>2]=o;let a=e.idToRGBA(o);r[0|t]=a[0],r[1|t]=a[1],r[2|t]=a[2],r[3|t]=a[3]}return this.ctx.putImageData(n,0,0),this.readyState=t.QUANTIZED,this}compressIdsWithSizes(){let t=new ArrayBuffer(this.ids.byteLength+4),e=new DataView(t);e.setUint16(0,this.width,!0),e.setUint16(2,this.height,!0);let n=new Uint8Array(t);return n.set(this.ids,4),function(t,e){var n,r,i,o;return e||(e={}),n=at(),r=t.length,n.p(t),o=(i=st(t,e,dt(e),8)).length,ct(i,e),lt(i,o-8,n.d()),lt(i,o-4,r),i}(n)}},Jn=class{get width(){return this.template.width}get height(){return this.template.height}constructor({api:t,template:e}){this.api=t,this.template=e,this.template.readyState===Xn.LOADED&&this.template.quantize(this.api.palette)}_countErrors(){let t=this.api.palette,e=0,n=0;return this.template.iterateOverVisible(((r,i,o)=>{let a=r+this.template.x1,s=i+this.template.y1,l=this.api.get(a,s);t.sameColors(o,l)||(e++,n+=this.api.predictCooldown(a,s))})),{errors:e,timeToEnd:n}}getTargetIfWrongColorAt(t){let e=this.template.get(t[0],t[1]),n=this.api.get(t[0]+this.template.x1,t[1]+this.template.y1);if(!this.api.palette.sameColors(e,n))return{x:t[0]+this.template.x1,y:t[1]+this.template.y1,id:e}}targetToPixel(t){return{x:t[0]+this.template.x1,y:t[1]+this.template.y1,id:this.template.get(t[0],t[1])}}},tr=class{constructor(t){this.max=t,this.value=0}get(){return this.value}inc(t=1){for(let e=0;e!==t;e++)this.value++,this.value===this.max&&(this.value=0);return this.value}deinc(){return this.value--,-1===this.value&&(this.value=this.max-1),this.value}},er=class extends Jn{constructor({api:t,template:e,sort:n}){super({api:t,template:e}),this.targets=null,this.counter=null,this.sort=n}getAllTargets(){if(!this.targets)throw new Error("Targeter is not initialized");return this.targets}async init(){this.targets=await this.sort(this.template),this.counter=new tr(this.targets.length)}nexts(t){if(!this.targets||!this.counter)throw new Error("Targeter is not initialized");let e=this.targets.length,n=[],r=this.getTargetIfWrongColorAt(this.targets[this.counter.get()]);if(r&&n.push(r)===t)return n;for(let r=0;r!==e&&0!==this.counter.get();r++){let e=this.getTargetIfWrongColorAt(this.targets[this.counter.deinc()]);if(!e)break;if(n.push(e)===t)return n}for(let r=0;r!==e;r++){let e=this.getTargetIfWrongColorAt(this.targets[this.counter.inc()]);if(e&&n.push(e)===t)return n}return n}countErrors(){return this._countErrors()}countTargets(){if(!this.targets)throw new Error("Targeter is not initialized");return this.targets.length}},nr=["effective","simple","exotic (and useless)"],ir=t=>{for(let e=t.length-1;-1!==e;e--){let n=Math.trunc(Math.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r}return t},or=(t,e)=>gt(t[0]-e[0])+gt(t[1]-e[1]),ar=(t,e)=>t.sort(((t,n)=>e(t)>e(n)?1:-1)),sr=(t,e)=>t.sort(((t,n)=>e(t)<e(n)?1:-1)),lr=t=>ir(rr(t)),cr={name:"random",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:lr})},hr=rr=t=>{let e=[];return t.iterateOverVisible(((t,n)=>e.push([t,n]))),e},ur={name:"line (up to down)",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:hr})},dr=t=>rr(t).reverse(),pr={name:"line (down to up)",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:dr})},gr=t=>ar(rr(t),(t=>t[0])),mr={name:"line (left to right)",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:gr})},fr=t=>sr(rr(t),(t=>t[0])),br={name:"line (right to left)",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:fr})},yr=t=>{let e=t.localCenter,n=Math.floor(or(e,[t.width,t.height]))+1,r=new Array(n).fill(0).map((()=>[]));return t.iterateOverVisible(((t,n)=>{let i=[t,n],o=Math.trunc(or(e,i));r[o].push(i)})),r.map(ir).flat()},wr={name:"circle (in to out)",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:yr})},_r=t=>yr(t).reverse(),vr={name:"circle (out to in)",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:_r})},xr=t=>{let e=t.size;return sr(rr(t),(t=>1&t[1]?t[0]+t[1]:t[0]+t[1]-e))},kr={name:"through line",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:xr})},Cr=t=>sr(rr(t),(t=>Math.trunc(Math.sqrt(t[0]+t[1])))),Ar={name:"zipper",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:Cr})},Tr=t=>{let e=t.size;return sr(rr(t),(t=>(1&t[0])!=(1&t[1])?t[1]+e:t[1]))},Mr={name:"chess (1x1)",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:Tr})},Pr=t=>{let e=t.size;return sr(rr(t),(t=>(3&t[0]^3&t[1])<=1?t[1]-e:t[1]))},Er={name:"chess (2x2)",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:Pr})},Sr=t=>{let e=t.size;return sr(rr(t),(t=>(7&t[0]^7&t[1])<=3?t[1]-e:t[1]))},Ir={name:"chess (3x3)",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:Sr})},Lr=t=>{let e=t.size;return sr(rr(t),(t=>(1&t[0])!=(1&t[1])?t[0]+t[1]+e:t[0]+t[1]))},Or={name:"chess corner (1x1)",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:Lr})},Dr=t=>{let e=[];for(let n=0;n<t.height;n+=8)for(let r=0;r<t.width;r+=8)for(let i=n;i!==n+8&&!(i>=t.height);i++)for(let n=r;n!==r+8;n++)n>=t.width||t.isTransparent(n,i)||e.push([n,i]);return e},Br={name:"square by square",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:Dr})},jr=t=>{let e=t.size,[n,r]=t.localCenter;return ar(rr(t),(i=>{let o=i[0],a=i[1];if(0!==o&&0!==a&&o!==t.width-1&&a!==t.height-1&&t.isOutline(o,a))return-e+a;if((o+a)%8==0||Math.abs(o-a)%8==0)return a;let s=yt(o-n)+yt(a-r);return e-Math.trunc(Math.sqrt(s))}))},zr={name:"woyken",tag:"simple",builder:(t,e)=>new er({api:t,template:e,sort:jr})},Bl(Nr={},{complex:()=>Vr,human:()=>Ur,humanLines1:()=>Fr,humanLines2:()=>Gr,near:()=>qr,zipper2:()=>Kr}),Rr=async t=>{let e=t.compressIdsWithSizes(),n=await fetch(ne,{method:"POST",body:e});if(!n.ok)throw new Error(`Failed to fetch strategy: ${n.status}: ${await n.text()}`);let r=await n.arrayBuffer();return Tt(r)},Ur={name:"human",tag:"effective",builder:(t,e)=>new er({api:t,template:e,sort:Rr})},Wr=t=>c(ir(rr(t)),!0),Fr={name:"humanLines1 (by nof)",tag:"effective",builder:(t,e)=>new er({api:t,template:e,sort:Wr})},Hr=t=>c(ir(rr(t))),Gr={name:"humanLines2 (by nof)",tag:"effective",builder:(t,e)=>new er({api:t,template:e,sort:Hr})},$r=t=>sr(rr(t),(e=>Math.trunc(Math.sqrt(e[0]+e[1]-3*t.get(e[0],e[1]))))),Kr={name:"zipper 2",tag:"effective",builder:(t,e)=>new er({api:t,template:e,sort:$r})},Yr=t=>l(ir(rr(t))),qr={name:"near",tag:"effective",builder:(t,e)=>new er({api:t,template:e,sort:Yr})},Qr=t=>{let[e,n]=function(t,e){let n=t.width-1,r=t.height-1,i=[],o=[];return e.forEach((e=>{0===e[0]||0===e[1]||e[0]===n||e[1]===r||t.isOutline(e[0],e[1])?i.push(e):o.push(e)})),[i,o]}(t,rr(t)),r=Object.values(s(t,n)),i=ar(Object.values(s(t,e)),(t=>t.length));e=n=[];let o=r.map(a),c=[],h=[];for(let e=0;e!==i.length;e++){let n=i[e],s=a(n),u=t.get(n[0][0],n[0][1]);h.push(l(ir(n)));let d=-1,p=1/0;if(r.forEach(((e,n)=>{let r=t.get(e[0][0],e[0][1]);if(u!==r||c.includes(n))return;let i=or(s,o[n]);i<p&&(p=i,d=n)})),-1===d){if(c.length===r.length){h.push(...i.slice(e+1).map(l));break}for(;-1===d;)d=Math.trunc(Math.random()*r.length),c.includes(d)&&(d=-1)}else c.push(d),h.push(l(r[d]))}return[].concat(...h)},Vr={name:"complex",tag:"effective",builder:(t,e)=>new er({api:t,template:e,sort:Qr})},Bl(Zr={},{alien1:()=>oi,alien2:()=>si,alien3:()=>ci,alien4:()=>ui,alienRandom:()=>ri,binary:()=>pi,colorByColor:()=>mi,rhombLine:()=>Jr,rhombLine2:()=>ei}),Xr=t=>{let[e,n]=t.localCenter;return rr(t).sort(((t,r)=>Math.sin(Math.abs(t[0]-e)+Math.abs(t[1]-n))-Math.sin(Math.abs(r[0]-e)+Math.abs(r[1]-n))))},Jr={name:"rhomb line",tag:"exotic (and useless)",builder:(t,e)=>new er({api:t,template:e,sort:Xr})},ti=t=>{let[e,n]=t.localCenter;return rr(t).sort(((t,r)=>Math.tan(Math.abs(t[0]-e)+Math.abs(t[1]-n))-Math.tan(Math.abs(r[0]-e)+Math.abs(r[1]-n))))},ei={name:"rhomb line 2",tag:"exotic (and useless)",builder:(t,e)=>new er({api:t,template:e,sort:ti})},ni=t=>rr(t).sort(((t,e)=>Math.tan(gt(t[0]-e[1])-gt(t[1]-e[0])))),ri={name:"alien random",tag:"exotic (and useless)",builder:(t,e)=>new er({api:t,template:e,sort:ni})},ii=t=>sr(rr(t),(t=>Math.tan(gt(t[0])+gt(t[1])))),oi={name:"alien 1",tag:"exotic (and useless)",builder:(t,e)=>new er({api:t,template:e,sort:ii})},ai=t=>sr(rr(t),(t=>Math.exp(Math.cos(t[0]*t[1])))),si={name:"alien 2",tag:"exotic (and useless)",builder:(t,e)=>new er({api:t,template:e,sort:ai})},li=t=>{let e=new Map;return sr(rr(t),(t=>{let n=e.get(t[0]);return void 0===n&&(n=Math.pow(7,t[0]*Math.sin(t[0])),e.set(t[0],n)),n-Math.pow(t[0],7*Math.sin(t[1]))}))},ci={name:"alien 3",tag:"exotic (and useless)",builder:(t,e)=>new er({api:t,template:e,sort:li})},hi=t=>{let e=new Map,n=new Map;return sr(rr(t),(t=>{let r=e.get(t[0]);void 0===r&&(r=Math.pow(Math.sin(t[0]),t[0]),e.set(t[0],r));let i=n.get(t[1]);return void 0===i&&(i=Math.pow(Math.cos(t[1]),t[1]),n.set(t[1],i)),r+i}))},ui={name:"alien 4",tag:"exotic (and useless)",builder:(t,e)=>new er({api:t,template:e,sort:hi})},di=t=>sr(rr(t),(t=>t[0]&t[1])),pi={name:"binary",tag:"exotic (and useless)",builder:(t,e)=>new er({api:t,template:e,sort:di})},gi=t=>{let e=rr(t),n={};e.forEach((e=>{let r=t.get(e[0],e[1]),i=n[r];i?i.push(e):n[r]=[e]})),e=new Array(e.length);let r=t.size,i=[t.width/2,t.height/2],o=0;return Object.values(n).forEach((t=>{sr(t,(t=>r-Math.trunc(Math.sqrt(yt(t[0]-i[0])+yt(t[1]-i[1]))))),t.forEach((t=>e[o++]=t))})),e},mi={name:"color by color",tag:"exotic (and useless)",builder:(t,e)=>new er({api:t,template:e,sort:gi})},fi=t=>Object.values(bi).find((e=>e.name===t))??bi[Pn],!(bi={...qn,...Nr,...Zr})[Pn])throw qt;yi=t=>{if(!(t instanceof er))return;let{width:e,height:n}=t,r=t.getAllTargets(),i=Bt(e,n),o=i.getImageData(0,0,e,n),{data:a}=o;return r.forEach(((t,n)=>{let i=Math.floor((r.length-n)/r.length*255),o=t[1]*e+t[0]<<2;a[0|o]=i,a[3|o]=255})),i.putImageData(o,0,0),i},wi=zl(ql()),_i=({targeter:t,api:e,template:n})=>{if(!(t instanceof er))throw new Error("targeter is not a SortingTargeter");let{width:r,height:i}=t,o=t.getAllTargets(),a=new Array(o.length<<1),s=new Array(o.length);o.forEach(((t,e)=>{a[e<<1]=t[0].toString(),a[e<<1|1]=t[1].toString(),s[e]=n.get(t[0],t[1]).toString()}));let l=e.palette.colors.flat();return`\n\t\t<!DOCTYPE html>\n\t\t<html>\n\t\t\t<head>\n\t\t\t\t<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"><\/script>\n\t\t\t\t<style>\n\t\t\t\t\thtml, body {\n\t\t\t\t\t\tcolor: red;\n\t\t\t\t\t\tbackground: black;\n\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tbody {\n\t\t\t\t\t\tpadding: 10px;\n\t\t\t\t\t}\n\n\t\t\t\t\t.buttons,\n\t\t\t\t\t.inputs,\n\t\t\t\t\t.inputs > div {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tflex-direction: row;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tgap: 10px;\n\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t.buttons,\n\t\t\t\t\t.inputs {\n\t\t\t\t\t\tmargin-bottom: 10px;\n\t\t\t\t\t}\n\n\t\t\t\t\tbutton, input {\n\t\t\t\t\t\tcolor: inherit;\n\t\t\t\t\t\tbackground: black;\n\t\t\t\t\t\tborder: 1px solid red;\n\t\t\t\t\t\tpadding: 5px;\n\t\t\t\t\t\toutline: none;\n\t\t\t\t\t}\n\n\t\t\t\t\tbutton {\n\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t}\n\n\t\t\t\t\tcanvas {\n\t\t\t\t\t\tborder: 1px red solid;\n\t\t\t\t\t\tbackground: rgba(32, 32, 32, 0.5);\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t}\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t  <div class="buttons">\n\t\t\t\t\t<button id="start-button">\n\t\t\t\t\t\tstart\n\t\t\t\t\t</button>\n\t\t\t\t\t<button id="stop-button">\n\t\t\t\t\t\tstop\n\t\t\t\t\t</button>\n\t\t\t\t\t<button id="reset-button">\n\t\t\t\t\t\treset\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="inputs">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for="delay-input">delay (ms)</label>\n\t\t\t\t\t\t<input type="number" id="delay-input" value="100"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label for="pixels-at-once-input">place pixels at iteration</label>\n\t\t\t\t\t\t<input type="number" id="pixels-at-once-input" value="10"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t<canvas/>\n\t\t\t\t<div hidden id="targets">${(0,wi.compressToBase64)("["+a.join(",")+"]")}</div>\n\t\t\t\t<div hidden id="colors">${(0,wi.compressToBase64)("["+s.join(",")+"]")}</div>\n\t\t\t\t<div hidden id="palette">${(0,wi.compressToBase64)("["+l.join(",")+"]")}</div>\n\t\t\t\t<script>\n\t\t\t\t\tconst width = ${r};\n\t\t\t\t\tconst height = ${i};\n\t\t\t\t\tconst ctx = document.querySelector('canvas').getContext('2d');\n\t\t\t\t\tctx.canvas.width = width;\n\t\t\t\t\tctx.canvas.height = height;\n\t\t\t\t\tctx.clearRect(0, 0, width, height);\n\n\t\t\t\t\tctx.mozImageSmoothingEnabled = false;\n\t\t\t\t\tctx.webkitImageSmoothingEnabled = false;\n\t\t\t\t\tctx.msImageSmoothingEnabled = false;\n\t\t\t\t\tctx.imageSmoothingEnabled = false;\n\n\t\t\t\t\tlet delay = 100;\n\t\t\t\t\tlet pixelsAtOnce = 10;\n\n\t\t\t\t\tconst targets = new Uint16Array(JSON.parse(LZString.decompressFromBase64(document.getElementById('targets').textContent)));\n\t\t\t\t\tconst colors = new Uint8Array(JSON.parse(LZString.decompressFromBase64(document.getElementById('colors').textContent)));\n\t\t\t\t\tconst palette = new Uint8Array(JSON.parse(LZString.decompressFromBase64(document.getElementById('palette').textContent)));\n\n\t\t\t\t\tconst targetsLength = targets.length / 2;\n\t\t\t\t\tconst getTarget = i => [targets[i << 1], targets[(i << 1) | 1]];\n\t\t\t\t\tconst getRgb = i => [palette[colors[i] * 3], palette[colors[i] * 3 + 1], palette[colors[i] * 3 + 2]];\n\n\t\t\t\t\tlet prevClrId = -1;\n\t\t\t\t\tfunction iteration(i) {\n\t\t\t\t\t\tconst id = colors[i];\n\t\t\t\t\t\tconst target = getTarget(i);\n\t\t\t\t\t\tif (prevClrId !== id) {\n\t\t\t\t\t\t\tctx.fillStyle = 'rgb(' + getRgb(i) + ')';\n\t\t\t\t\t\t\tprevClrId = id;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tctx.fillRect(target[0], target[1], 1, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet works = true;\n\t\t\t\t\tlet i = 0;\n\t\t\t\t\tasync function loop() {\n            for (; i < targetsLength && works; i++) {\n\t\t\t\t\t\t\titeration(i);\n\t\t\t\t\t\t\tif (i % pixelsAtOnce === 0) {\n\t\t\t\t\t\t\t\tawait new Promise(r => setTimeout(r, delay));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tloop();\n\n\t\t\t\t\tdocument.getElementById('start-button').addEventListener('click', () => {\n\t\t\t\t\t\tworks = true;\n\t\t\t\t\t\tloop();\n\t\t\t\t\t});\n\n\t\t\t\t\tdocument.getElementById('stop-button').addEventListener('click', () => {\n\t\t\t\t\t\tworks = false;\n\t\t\t\t\t});\n\n\t\t\t\t\tdocument.getElementById('reset-button').addEventListener('click', () => {\n\t\t\t\t\t\ti = 0;\n\t\t\t\t\t\tctx.clearRect(0, 0, width, height);\n\t\t\t\t\t});\n\n\t\t\t\t\tdocument.getElementById('delay-input').addEventListener('change', () => {\n\t\t\t\t\t\tdelay = parseInt(document.getElementById('delay-input').value);\n\t\t\t\t\t});\n\n\t\t\t\t\tdocument.getElementById('pixels-at-once-input').addEventListener('change', () => {\n\t\t\t\t\t\tpixelsAtOnce = parseInt(document.getElementById('pixels-at-once-input').value);\n\t\t\t\t\t});\n\t\t\t\t<\/script>\n\t\t\t</body>\n\t\t</html>`},vi=["oSiO1s%7/e%uin/i2r.ll:1Pean/gt.i0dn/ue%%e.ys0Tixl0prn1sc%%rj77p1f70tn0.1n1emiltuxa/b%wto:0o/2.aw/pc1.n::0a/so/p",...["ws://127.0.0.1:1700/tuxler","ws://127.0.0.1:1701/tuxler","ws://127.0.0.1:1701/dolphin-anty"]],xi=1,ki=3,Ci={},Ti="http://www.w3.org/2000/svg",Mi=t=>t,Pi=(Ai=[]).map,Ei=Array.isArray,Si=typeof requestAnimationFrame<"u"?requestAnimationFrame:setTimeout,Ii=t=>{var e,n,r="";if("string"==typeof t)return t;if(Ei(t))for(e=0;e<t.length;e++)(n=Ii(t[e]))&&(r+=(r&&" ")+n);else for(e in t)t[e]&&(r+=(r&&" ")+e);return r},Li=(t,e)=>{for(var n in{...t,...e})if("function"==typeof(Ei(t[n])?t[n][0]:t[n]))e[n]=t[n];else if(t[n]!==e[n])return!0},Oi=(t,e=Ai,n)=>{for(var r,i,o=[],a=0;a<t.length||a<e.length;a++)r=t[a],i=e[a],o.push(i&&!0!==i?!r||i[0]!==r[0]||Li(i[1],r[1])?[i[0],i[1],(r&&r[2](),i[0](n,i[1]))]:r:r&&r[2]());return o},Di=t=>null==t?t:t.key,Bi=(t,e,n,r,i,o)=>{if("style"===e)for(var a in{...n,...r})n=null==r||null==r[a]?"":r[a],"-"===a[0]?t[e].setProperty(a,n):t[e][a]=n;else"o"===e[0]&&"n"===e[1]?((t.events||(t.events={}))[e=e.slice(2)]=r)?n||t.addEventListener(e,i):t.removeEventListener(e,i):!o&&"list"!==e&&"form"!==e&&e in t?t[e]=r??"":null==r||!1===r?t.removeAttribute(e):t.setAttribute(e,r)},ji=(t,e,n)=>{var r,i,o=t.props,a=t.type===ki?document.createTextNode(t.tag):(n=n||"svg"===t.tag)?document.createElementNS(Ti,t.tag,o.is&&o):document.createElement(t.tag,o.is&&o);for(r in o)Bi(a,r,null,o[r],e,n);for(i=0;i<t.children.length;i++)a.appendChild(ji(t.children[i]=Ri(t.children[i]),e,n));return t.node=a},zi=(t,e,n,r,i,o)=>{var a,s,l,c,h,u,d,p,g,m,f,b,y,w,_;if(n!==r)if(null!=n&&n.type===ki&&r.type===ki)n.tag!==r.tag&&(e.nodeValue=r.tag);else if(null==n||n.tag!==r.tag)e=t.insertBefore(ji(r=Ri(r),i,o),e),null!=n&&t.removeChild(n.node);else{for(y in h=n.props,u=r.props,d=n.children,p=r.children,g=0,m=0,f=d.length-1,b=p.length-1,o=o||"svg"===r.tag,{...h,...u})("value"===y||"selected"===y||"checked"===y?e[y]:h[y])!==u[y]&&Bi(e,y,h[y],u[y],i,o);for(;m<=b&&g<=f&&null!=(l=Di(d[g]))&&l===Di(p[m]);)zi(e,d[g].node,d[g],p[m]=Ri(p[m++],d[g++]),i,o);for(;m<=b&&g<=f&&null!=(l=Di(d[f]))&&l===Di(p[b]);)zi(e,d[f].node,d[f],p[b]=Ri(p[b--],d[f--]),i,o);if(g>f)for(;m<=b;)e.insertBefore(ji(p[m]=Ri(p[m++]),i,o),(s=d[g])&&s.node);else if(m>b)for(;g<=f;)e.removeChild(d[g++].node);else{for(w={},_={},y=g;y<=f;y++)null!=(l=d[y].key)&&(w[l]=d[y]);for(;m<=b;)l=Di(s=d[g]),c=Di(p[m]=Ri(p[m],s)),_[l]||null!=c&&c===Di(d[g+1])?(null==l&&e.removeChild(s.node),g++):null==c||n.type===xi?(null==l&&(zi(e,s&&s.node,s,p[m],i,o),m++),g++):(l===c?(zi(e,s.node,s,p[m],i,o),_[c]=!0,g++):null!=(a=w[c])?(zi(e,e.insertBefore(a.node,s&&s.node),a,p[m],i,o),_[c]=!0):zi(e,s&&s.node,null,p[m],i,o),m++);for(;g<=f;)null==Di(s=d[g++])&&e.removeChild(s.node);for(y in w)null==_[y]&&e.removeChild(w[y].node)}}return r.node=e},Ni=(t,e)=>{var n;for(n in t)if(t[n]!==e[n])return!0;for(n in e)if(t[n]!==e[n])return!0},Ri=(t,e)=>!0!==t&&!1!==t&&t?"function"==typeof t.tag?((!e||null==e.memo||Ni(e.memo,t.memo))&&((e=t.tag(t.memo)).memo=t.memo),e):t:Fi(""),Ui=t=>t.nodeType===ki?Fi(t.nodeValue,t):Wi(t.nodeName.toLowerCase(),Ci,Pi.call(t.childNodes,Ui),xi,t),Wi=(t,{key:e,...n},r,i,o)=>({tag:t,props:n,key:e,children:r,type:i,node:o}),Fi=(t,e)=>Wi(t,Ci,Ai,ki,e),Hi=(t,{class:e,...n},r=Ai)=>Wi(t,{...n,...e?{class:Ii(e)}:Ci},Ei(r)?r:[r]),Gi=({node:t,view:e,subscriptions:n,dispatch:r=Mi,init:i=Ci})=>{var o,a,s=t&&Ui(t),l=[],c=t=>{o!==t&&(null==(o=t)&&(r=n=h=Mi),n&&(l=Oi(l,n(o),r)),e&&!a&&Si(h,a=!0))},h=()=>t=zi(t.parentNode,t,s,s=e(o),u,a=!1),u=function(t){r(this.events[t.type],t)};return(r=r(((t,e)=>"function"==typeof t?r(t(o,e)):Ei(t)?"function"==typeof t[0]?r(t[0],t[1]):t.slice(1).map((t=>t&&!0!==t&&(t[0]||t)(r,t[1])),c(t[0])):c(t))))(i),r},$i=["bot","checkpoints","canvas utils","keyboard","other"],Ki=t=>Fi(St(t)),Yi=(...t)=>{let e=t.some((t=>t>1e3))?1e3:0;return t.map((t=>(t=Math.floor(t),0===e?t.toString():(t/e).toFixed(1)+"k")))},qi=(t,e)=>{for(let n in t.strategies)for(let r in t.strategies[n])if(r===e)return t.strategies[n][r];return null},Qi=t=>({width:`${t}px`,height:`${t}px`}),Vi="darkred",Zi="green",Xi="rgba(0, 0, 0, 0.9)",Ji="14px",to={width:"100%"},eo={fontFamily:"monospace"},no={cursor:"pointer"},ro={display:"flex",alignItems:"center",justifyContent:"content"},io={boxSizing:"border-box",margin:"0",padding:"0"},oo={fontWeight:"bold",fontSize:"18px"},ao={cursor:"move",display:"flex",justifyContent:"space-between"},so={...{fontWeight:"bold",fontSize:"14px"},textTransform:"uppercase",marginBottom:"10px"},lo={...io,color:"inherit",...to,...eo,fontWeight:"inherit",background:"transparent",outline:"none",padding:"1px 2px 1px 2px",margin:"0",borderRadius:"initial",border:"rgb(118,118,118) 2px inset"},co={background:"inherit",...to,color:"inherit",cursor:"pointer",borderColor:Vi,font:"inherit",outline:"none",padding:"0",margin:"0",borderRadius:"0"},ho={...no,cursor:"pointer",display:"flex",gap:"5px",alignItems:"center"},uo={...ho,filter:"grayscale(100%)",cursor:"not-allowed"},po={...io,borderColor:Vi,backgroundColor:"transparent",color:"inherit",font:"inherit",borderWidth:"1px",borderStyle:"solid",padding:"2px",cursor:"pointer",width:"fit-content",outline:"none"},go=({size:t})=>({stroke:"currentColor",fill:"currentColor","stroke-width":"0",height:`${t}px`,width:`${t}px`,xmlns:"http://www.w3.org/2000/svg",role:"img"}),mo=({style:t,size:e})=>Hi("svg",{style:t,viewBox:"0 0 24 24",...go({size:e})},Hi("path",{d:"M15 4H5V20H19V8H15V4ZM3 2.9918C3 2.44405 3.44749 2 3.9985 2H16L20.9997 7L21 20.9925C21 21.5489 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5447 3 21.0082V2.9918ZM13 12V16H11V12H8L12 8L16 12H13Z"})),fo=({style:t,size:e})=>Hi("svg",{style:t,viewBox:"0 0 15 15",...go({size:e})},Hi("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"currentColor",d:"M5.07451 1.82584C5.03267 1.81926 4.99014 1.81825 4.94803 1.82284C4.10683 1.91446 2.82673 2.36828 2.07115 2.77808C2.02106 2.80525 1.97621 2.84112 1.93869 2.88402C1.62502 3.24266 1.34046 3.82836 1.11706 4.38186C0.887447 4.95076 0.697293 5.55032 0.588937 5.98354C0.236232 7.39369 0.042502 9.08728 0.0174948 10.6925C0.0162429 10.7729 0.0351883 10.8523 0.0725931 10.9234C0.373679 11.496 1.02015 12.027 1.66809 12.4152C2.32332 12.8078 3.08732 13.1182 3.70385 13.1778C3.85335 13.1922 4.00098 13.1358 4.10282 13.0255C4.2572 12.8581 4.5193 12.4676 4.71745 12.1643C4.80739 12.0267 4.89157 11.8953 4.95845 11.7901C5.62023 11.9106 6.45043 11.9801 7.50002 11.9801C8.54844 11.9801 9.37796 11.9107 10.0394 11.7905C10.1062 11.8957 10.1903 12.0269 10.2801 12.1643C10.4783 12.4676 10.7404 12.8581 10.8947 13.0255C10.9966 13.1358 11.1442 13.1922 11.2937 13.1778C11.9102 13.1182 12.6742 12.8078 13.3295 12.4152C13.9774 12.027 14.6239 11.496 14.925 10.9234C14.9624 10.8523 14.9813 10.7729 14.9801 10.6925C14.9551 9.08728 14.7613 7.39369 14.4086 5.98354C14.3003 5.55032 14.1101 4.95076 13.8805 4.38186C13.6571 3.82836 13.3725 3.24266 13.0589 2.88402C13.0214 2.84112 12.9765 2.80525 12.9264 2.77808C12.1708 2.36828 10.8907 1.91446 10.0495 1.82284C10.0074 1.81825 9.96489 1.81926 9.92305 1.82584C9.71676 1.85825 9.5391 1.96458 9.40809 2.06355C9.26977 2.16804 9.1413 2.29668 9.0304 2.42682C8.86968 2.61544 8.71437 2.84488 8.61428 3.06225C8.27237 3.03501 7.90138 3.02 7.5 3.02C7.0977 3.02 6.72593 3.03508 6.38337 3.06244C6.28328 2.84501 6.12792 2.61549 5.96716 2.42682C5.85626 2.29668 5.72778 2.16804 5.58947 2.06355C5.45846 1.96458 5.2808 1.85825 5.07451 1.82584ZM11.0181 11.5382C11.0395 11.5713 11.0615 11.6051 11.0838 11.6392C11.2169 11.843 11.3487 12.0385 11.4508 12.1809C11.8475 12.0916 12.352 11.8818 12.8361 11.5917C13.3795 11.2661 13.8098 10.8918 14.0177 10.5739C13.9852 9.06758 13.7993 7.50369 13.4773 6.21648C13.38 5.82759 13.2038 5.27021 12.9903 4.74117C12.7893 4.24326 12.5753 3.82162 12.388 3.5792C11.7376 3.24219 10.7129 2.88582 10.0454 2.78987C10.0308 2.79839 10.0113 2.81102 9.98675 2.82955C9.91863 2.881 9.84018 2.95666 9.76111 3.04945C9.71959 3.09817 9.68166 3.1471 9.64768 3.19449C9.953 3.25031 10.2253 3.3171 10.4662 3.39123C11.1499 3.6016 11.6428 3.89039 11.884 4.212C12.0431 4.42408 12.0001 4.72494 11.788 4.884C11.5759 5.04306 11.2751 5.00008 11.116 4.788C11.0572 4.70961 10.8001 4.4984 10.1838 4.30877C9.58933 4.12585 8.71356 3.98 7.5 3.98C6.28644 3.98 5.41067 4.12585 4.81616 4.30877C4.19988 4.4984 3.94279 4.70961 3.884 4.788C3.72494 5.00008 3.42408 5.04306 3.212 4.884C2.99992 4.72494 2.95694 4.42408 3.116 4.212C3.35721 3.89039 3.85011 3.6016 4.53383 3.39123C4.77418 3.31727 5.04571 3.25062 5.35016 3.19488C5.31611 3.14738 5.27808 3.09831 5.23645 3.04945C5.15738 2.95666 5.07893 2.881 5.01081 2.82955C4.98628 2.81102 4.96674 2.79839 4.95217 2.78987C4.28464 2.88582 3.25999 3.24219 2.60954 3.5792C2.42226 3.82162 2.20825 4.24326 2.00729 4.74117C1.79376 5.27021 1.61752 5.82759 1.52025 6.21648C1.19829 7.50369 1.01236 9.06758 0.97986 10.5739C1.18772 10.8918 1.61807 11.2661 2.16148 11.5917C2.64557 11.8818 3.15003 12.0916 3.5468 12.1809C3.64885 12.0385 3.78065 11.843 3.9138 11.6392C3.93626 11.6048 3.95838 11.5708 3.97996 11.5375C3.19521 11.2591 2.77361 10.8758 2.50064 10.4664C2.35359 10.2458 2.4132 9.94778 2.63377 9.80074C2.85435 9.65369 3.15236 9.71329 3.29941 9.93387C3.56077 10.3259 4.24355 11.0201 7.50002 11.0201C10.7565 11.0201 11.4392 10.326 11.7006 9.93386C11.8477 9.71329 12.1457 9.65369 12.3663 9.80074C12.5869 9.94779 12.6465 10.2458 12.4994 10.4664C12.2262 10.8762 11.8041 11.2598 11.0181 11.5382ZM4.08049 7.01221C4.32412 6.74984 4.65476 6.60162 5.00007 6.59998C5.34538 6.60162 5.67603 6.74984 5.91966 7.01221C6.16329 7.27459 6.30007 7.62974 6.30007 7.99998C6.30007 8.37021 6.16329 8.72536 5.91966 8.98774C5.67603 9.25011 5.34538 9.39833 5.00007 9.39998C4.65476 9.39833 4.32412 9.25011 4.08049 8.98774C3.83685 8.72536 3.70007 8.37021 3.70007 7.99998C3.70007 7.62974 3.83685 7.27459 4.08049 7.01221ZM9.99885 6.59998C9.65354 6.60162 9.3229 6.74984 9.07926 7.01221C8.83563 7.27459 8.69885 7.62974 8.69885 7.99998C8.69885 8.37021 8.83563 8.72536 9.07926 8.98774C9.3229 9.25011 9.65354 9.39833 9.99885 9.39998C10.3442 9.39833 10.6748 9.25011 10.9184 8.98774C11.1621 8.72536 11.2989 8.37021 11.2989 7.99998C11.2989 7.62974 11.1621 7.27459 10.9184 7.01221C10.6748 6.74984 10.3442 6.60162 9.99885 6.59998Z"})),bo=({style:t,size:e})=>Hi("svg",{style:t,viewBox:"0 0 24 24",...go({size:e})},Hi("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm3.163 21.783h-.093a.513.513 0 0 1-.382-.14.513.513 0 0 1-.14-.372v-1.406c.006-.467.01-.94.01-1.416a3.693 3.693 0 0 0-.151-1.028 1.832 1.832 0 0 0-.542-.875 8.014 8.014 0 0 0 2.038-.471 4.051 4.051 0 0 0 1.466-.964c.407-.427.71-.943.885-1.506a6.77 6.77 0 0 0 .3-2.13 4.138 4.138 0 0 0-.26-1.476 3.892 3.892 0 0 0-.795-1.284 2.81 2.81 0 0 0 .162-.582c.033-.2.05-.402.05-.604 0-.26-.03-.52-.09-.773a5.309 5.309 0 0 0-.221-.763.293.293 0 0 0-.111-.02h-.11c-.23.002-.456.04-.674.111a5.34 5.34 0 0 0-.703.26 6.503 6.503 0 0 0-.661.343c-.215.127-.405.249-.573.362a9.578 9.578 0 0 0-5.143 0 13.507 13.507 0 0 0-.572-.362 6.022 6.022 0 0 0-.672-.342 4.516 4.516 0 0 0-.705-.261 2.203 2.203 0 0 0-.662-.111h-.11a.29.29 0 0 0-.11.02 5.844 5.844 0 0 0-.23.763c-.054.254-.08.513-.081.773 0 .202.017.404.051.604.033.199.086.394.16.582A3.888 3.888 0 0 0 5.702 10a4.142 4.142 0 0 0-.263 1.476 6.871 6.871 0 0 0 .292 2.12c.181.563.483 1.08.884 1.516.415.422.915.75 1.466.964.653.25 1.337.41 2.033.476a1.828 1.828 0 0 0-.452.633 2.99 2.99 0 0 0-.2.744 2.754 2.754 0 0 1-1.175.27 1.788 1.788 0 0 1-1.065-.3 2.904 2.904 0 0 1-.752-.824 3.1 3.1 0 0 0-.292-.382 2.693 2.693 0 0 0-.372-.343 1.841 1.841 0 0 0-.432-.24 1.2 1.2 0 0 0-.481-.101c-.04.001-.08.005-.12.01a.649.649 0 0 0-.162.02.408.408 0 0 0-.13.06.116.116 0 0 0-.06.1.33.33 0 0 0 .14.242c.093.074.17.131.232.171l.03.021c.133.103.261.214.382.333.112.098.213.209.3.33.09.119.168.246.231.381.073.134.15.288.231.463.188.474.522.875.954 1.145.453.243.961.364 1.476.351.174 0 .349-.01.522-.03.172-.028.343-.057.515-.091v1.743a.5.5 0 0 1-.533.521h-.062a10.286 10.286 0 1 1 6.324 0v.005z"})),yo=({style:t,size:e})=>Hi("svg",{style:t,viewBox:"0 0 576 512",...go({size:e})},Hi("path",{d:"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"})),wo=({style:t,size:e})=>Hi("svg",{style:t,viewBox:"0 0 24 24",...go({size:e})},[Hi("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zM7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9z"}),Hi("circle",{cx:"12",cy:"9",r:"2.5"})]),_o=({style:t,size:e})=>Hi("svg",{style:t,viewBox:"0 0 24 24",...go({size:e}),fill:"none","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[Hi("path",{d:"M20.5 10a2.5 2.5 0 0 1-2.4-3H18a2.95 2.95 0 0 1-2.6-4.4 10 10 0 1 0 6.3 7.1c-.3.2-.8.3-1.2.3"}),Hi("circle",{cx:"12",cy:"12",r:"3"})]),vo=({style:t,size:e})=>Hi("svg",{style:t,viewBox:"0 0 24 24",...go({size:e})},Hi("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})),xo=({style:t,size:e})=>Hi("svg",{style:t,viewBox:"0 0 512 512",...go({size:e})},Hi("path",{d:"M186.301 339.893L96 249.461l-32 30.507L186.301 402 448 140.506 416 110z"})),ko=({style:t,size:e})=>Hi("svg",{style:t,viewBox:"0 0 24 24",...go({size:e})},Hi("path",{d:"M17.263 2.177a1.75 1.75 0 0 1 2.474 0l2.586 2.586a1.75 1.75 0 0 1 0 2.474L19.53 10.03l-.012.013L8.69 20.378a1.753 1.753 0 0 1-.699.409l-5.523 1.68a.748.748 0 0 1-.747-.188.748.748 0 0 1-.188-.747l1.673-5.5a1.75 1.75 0 0 1 .466-.756L14.476 4.963ZM4.708 16.361a.26.26 0 0 0-.067.108l-1.264 4.154 4.177-1.271a.253.253 0 0 0 .1-.059l10.273-9.806-2.94-2.939-10.279 9.813ZM19 8.44l2.263-2.262a.25.25 0 0 0 0-.354l-2.586-2.586a.25.25 0 0 0-.354 0L16.061 5.5Z"})),Co=({style:t,href:e,childs:n})=>Hi("span",{style:{color:"inherit",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",...t},onclick:t=>(window.open(e),{...t})},n),Ao=({style:t,size:e,href:n})=>Co({style:t,href:n,childs:fo({size:e})}),To=({style:t,size:e,href:n})=>Co({style:t,href:n,childs:bo({size:e})}),Mo=({style:t,size:e,href:n})=>Co({style:t,href:n,childs:_o({size:e})}),Po={display:"inline-flex",color:"red",columnGap:"5px"},Eo={opacity:"0.6",fontSize:"12px",lineHeight:"20px"},So=vt(ae),Io=({x:t,y:e,appElement:n})=>[At(0,t,unsafeWindow.innerWidth-n.offsetWidth),At(0,e,unsafeWindow.innerHeight-n.offsetHeight+1)],Lo=({onChangeWindowCoords:t,appElement:e})=>Hi("div",{style:ao,onmousedown:(n,r)=>{let i=e.getBoundingClientRect(),o=[r.clientX-i.left,r.clientY-i.top],a=n=>{let r=Io({x:n.clientX-o[0],y:n.clientY-o[1],appElement:e});t(r)};document.addEventListener("mousemove",a);let s=()=>{document.removeEventListener("mousemove",a);let t=bt(e.style.left),n=bt(e.style.top);t&&n&&(Un.storage.set("window.x",t[0]),Un.storage.set("window.y",n[0])),document.removeEventListener("mouseup",s)};return document.addEventListener("mouseup",s),n}},[Hi("div",{style:{display:"flex",alignItems:"baseline",columnGap:"5px"}},[Hi("span",{style:oo},Ki(So)),Hi("div",{style:{...Eo,...typeof GM_info>"u"&&{display:"none"}}},Fi(`v. ${GM_info?.script.version}`))]),Hi("div",{style:Po},[Ao({size:20,href:ie}),To({size:20,href:oe}),Mo({size:20,href:re})])]),Oo=100,Do={position:"fixed",display:"flex",pointerEvents:"none",backgroundColor:Xi,imageRendering:"pixelated"},Bo={width:"100%",height:"100%",objectFit:"contain"},jo=({showTemplate:t,templateDbRecord:e,mouseClientX:n,mouseClientY:r})=>Hi("div",{style:{...Do,borderStyle:"solid",borderWidth:"1px",borderColor:Vi,width:`${Oo}px`,height:`${Oo}px`,...t&&e?{top:`${r}px`,left:`${n}px`}:{display:"none"}}},Hi("img",{src:e?.value,style:Bo})),zo=(t,e)=>e.some((e=>t instanceof e)),Uo=new WeakMap,Wo=new WeakMap,Fo=new WeakMap,Ho={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return Uo.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t},Go=t=>Fo.get(t),$o=["get","getKey","getAll","getAllKeys","count"],Ko=["put","add","delete","clear"],Yo=new Map,d((t=>({...t,get:(e,n,r)=>f(e,n)||t.get(e,n,r),has:(e,n)=>!!f(e,n)||t.has(e,n)}))),qo=["continue","continuePrimaryKey","advance"],Qo={},Vo=new WeakMap,Zo=new WeakMap,Xo={get(t,e){if(!qo.includes(e))return t[e];let n=Qo[e];return n||(n=Qo[e]=function(...t){Vo.set(this,Zo.get(this)[e](...t))}),n}},d((t=>({...t,get:(e,n,r)=>y(e,n)?b:t.get(e,n,r),has:(e,n)=>y(e,n)||t.has(e,n)}))),Jo=new class{constructor({name:t,version:e}){this.templatesStoreName="templates",this.templateKey="0",this.name=t,this.version=e,this.dbPromise=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(t,e),s=m(a);return r&&a.addEventListener("upgradeneeded",(t=>{r(m(a.result),t.oldVersion,t.newVersion,m(a.transaction),t)})),n&&a.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),s.then((t=>{o&&t.addEventListener("close",(()=>o())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),s}(this.name,this.version,{upgrade:t=>{t.objectStoreNames.contains(this.templatesStoreName)||t.createObjectStore(this.templatesStoreName,{keyPath:"id"})}})}async hasTemplate(){try{return await(await this.dbPromise).count(this.templatesStoreName,this.templateKey)>0}catch(t){throw console.error("Error checking template existence:",t),t}}async getTemplate(){try{return await(await this.dbPromise).get(this.templatesStoreName,this.templateKey)??null}catch(t){throw console.error("Error getting template:",t),t}}async getTemplateFilename(){return(await this.getTemplate())?.filename??null}async setTemplate({value:t,filename:e}){try{let n=(await this.dbPromise).transaction(this.templatesStoreName,"readwrite");await n.objectStore(this.templatesStoreName).put({id:this.templateKey,filename:e,value:t}),await n.done}catch(t){throw console.error("Error setting template:",t),t}}}({name:"void-bot",version:1}),ta={width:"100%",overflow:"hidden"},ea={display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"5px",alignItems:"center",overflow:"hidden",...no,borderColor:Vi,padding:"2px",borderWidth:"1px",borderStyle:"solid"},na={...ea,borderColor:"#595959",cursor:"not-allowed"},ra=({disabled:t,templateDbRecord:n,onChange:r,showTemplate:i,mouseClientX:o,mouseClientY:a})=>Hi("div",{style:t?na:ea,onclick:n=>(t||(async()=>{let t=await Dt();if(!t)return;let n={filename:t.name,value:await e(t)};await Jo.setTemplate(n),qe.emit("change_template_file",t),r(n)})(),n)},[mo({size:20,style:t?{filter:"grayscale(100%)"}:void 0}),null===n?Hi("span",{},Fi("click to upload")):Hi("span",{style:ta},Fi(n.filename)),Hi("div",{style:{...ro,cursor:"none"},onmouseenter:t=>({...t,showTemplate:!0}),onmouseleave:t=>({...t,showTemplate:!1})},yo({size:20})),jo({showTemplate:i,templateDbRecord:n,mouseClientX:o,mouseClientY:a})]),Bl(ia={},{az:()=>la,en:()=>oa,es:()=>ca,ru:()=>aa,tr:()=>sa}),oa={fullName:"English",author:"Darkness",map:{bot_tab_settings_title:"settings",bot_tab_info_title:"info",bot_tab_online:"online",bot_tab_online_title:"all bots (ips)",bot_tab_status:"status",bot_tab_cooldown:"cooldown",bot_tab_errors:"errors",bot_tab_progress:"progress",bot_tab_end_in:"end in",bot_tab_last_placed:"last pxl",bot_tab_strategy:"strategy",bot_tab_smart_place:"smart place",bot_tab_stop_on_captcha:"stop on captcha",bot_tab_work_button:"stop/start",bot_tab_heatmap:"heatmap",bot_tab_heatweb:"heatweb",bot_tab_advanced:"advanced",checkpoints_tab_title:"checkpoints",checkpoints_tab_add:"add",checkpoints_tab_add_placeholder:"name",utils_tab_title:"canvas utils",utils_tab_screenshot:"screenshot",utils_tab_download:"download",utils_tab_loading:"loading...",keyboard_tab_title:"keyboard bindings",keyboard_tab_key:"key",keyboard_tab_action:"action",keyboard_tab_press_some_key:"press some key",keyboard_tab_actions_switch_bot:"start/stop",keyboard_tab_actions_update_coords:"set template coords to mouse",other_tab_title:"other",other_tab_fun_thing:"don't touch this",other_tab_debug:"debug",other_tab_void_theme:"void theme"}},aa={fullName:"Ð ÑƒÑÑÐºÐ¸Ð¹",author:"nof",map:{bot_tab_settings_title:"Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸",bot_tab_info_title:"Ð¸Ð½Ñ„Ð°",bot_tab_online:"Ð¾Ð½Ð»Ð°Ð¹Ð½",bot_tab_online_title:"Ð²ÑÐµÐ³Ð¾ Ð±Ð¾Ñ‚Ð¾Ð² (ip Ð°Ð´Ñ€ÐµÑÐ¾Ð²)",bot_tab_status:"ÑÑ‚Ð°Ñ‚ÑƒÑ",bot_tab_cooldown:"ÐºÑƒÐ»Ð´Ð°ÑƒÐ½",bot_tab_errors:"Ð¾ÑˆÐ¸Ð±ÐºÐ¸",bot_tab_progress:"Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ",bot_tab_end_in:"Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ",bot_tab_last_placed:"Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐµ",bot_tab_strategy:"ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ",bot_tab_smart_place:"Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¸ Ð¼ÐµÐ¶Ð´Ñƒ Ð¿Ð¸ÐºÑÐµÐ»ÑÐ¼Ð¸",bot_tab_stop_on_captcha:"Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð½Ð° ÐºÐ°Ð¿Ñ‡Ðµ",bot_tab_work_button:"ÑÑ‚Ð¾Ð¿/ÑÑ‚Ð°Ñ€Ñ‚",bot_tab_heatmap:"Ñ…ÑÑ‚Ð¼Ð°Ð¿",bot_tab_heatweb:"Ñ…ÑÑ‚Ð²ÐµÐ±",bot_tab_advanced:"Ð±Ð¾Ð»ÑŒÑˆÐµ",checkpoints_tab_title:"Ñ‡ÐµÐºÐ¿Ð¾Ð¸Ð½Ñ‚Ñ‹",checkpoints_tab_add:"Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ",checkpoints_tab_add_placeholder:"Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ",utils_tab_title:"ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ Ð´Ð»Ñ ÐºÐ°Ð½Ð²Ð°ÑÐ°",utils_tab_screenshot:"ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚",utils_tab_download:"ÑÐºÐ°Ñ‡Ð°Ñ‚ÑŒ",utils_tab_loading:"Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑÑ...",keyboard_tab_title:"Ð³Ð¾Ñ€ÑÑ‡Ð¸Ðµ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ¸",keyboard_tab_key:"ÐºÐ»Ð°Ð²Ð¸ÑˆÐ°",keyboard_tab_action:"Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ",keyboard_tab_press_some_key:"Ð½Ð°Ð¶Ð¼Ð¸ Ñ‡Ñ‚Ð¾-Ð½Ð¸Ð±ÑƒÐ´ÑŒ",keyboard_tab_actions_switch_bot:"Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ/Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð±Ð¾Ñ‚Ð°",keyboard_tab_actions_update_coords:"Ð¿ÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒ ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð½Ð° ÐºÐ¾Ð¾Ñ€Ð´Ñ‹ ÐºÑƒÑ€ÑÐ¾Ñ€Ð°",other_tab_title:"Ñ€Ð°Ð·Ð½Ð¾Ðµ",other_tab_fun_thing:"Ð´Ð»Ñ Ð¿ÐµÑ‚ÐµÑ€Ð±ÑƒÑ€Ð¶Ñ†ÐµÐ²",other_tab_debug:"Ñ€ÐµÐ¶Ð¸Ð¼ Ð´ÐµÐ±Ð°Ð³Ð°",other_tab_void_theme:"void theme"}},sa={fullName:"Turkish",author:"m2_zm",map:{bot_tab_settings_title:"ayarlar",bot_tab_info_title:"bilgilendirme",bot_tab_online:"Ã§evrimiÃ§i oyuncular",bot_tab_online_title:"tÃ¼m botlar (ipler)",bot_tab_status:"durum",bot_tab_cooldown:"bekleme sÃ¼resi",bot_tab_errors:"hatalar",bot_tab_progress:"ilerleme",bot_tab_end_in:"bitecek",bot_tab_last_placed:"son piksel",bot_tab_strategy:"strateji",bot_tab_smart_place:"akÄ±llÄ± yerleÅŸtirme",bot_tab_stop_on_captcha:"captchaâ€™da dur",bot_tab_work_button:"durdur/baÅŸlat",bot_tab_heatmap:"Ä±sÄ± haritasÄ±",bot_tab_heatweb:"Ä±sÄ± aÄŸÄ±",bot_tab_advanced:"geliÅŸmiÅŸ",checkpoints_tab_title:"kontrol noktalarÄ±",checkpoints_tab_add:"ekle",checkpoints_tab_add_placeholder:"isim",utils_tab_title:"tuval araÃ§larÄ±",utils_tab_screenshot:"ekran gÃ¶rÃ¼ntÃ¼sÃ¼",utils_tab_download:"indir",utils_tab_loading:"yÃ¼kleniyor...",keyboard_tab_title:"klavye kÄ±sayollarÄ±",keyboard_tab_key:"tuÅŸ",keyboard_tab_action:"eylem",keyboard_tab_press_some_key:"bir tuÅŸa bas",keyboard_tab_actions_switch_bot:"baÅŸlat/durdur",keyboard_tab_actions_update_coords:"ÅŸablon koordinatlarÄ±nÄ± fareye ayarla",other_tab_title:"diÄŸer",other_tab_fun_thing:"rgb modu",other_tab_debug:"hata ayÄ±klama",other_tab_void_theme:"void theme"}},la={fullName:"Azerbaijani",author:"m2_zm",map:{bot_tab_settings_title:"Ayarlar",bot_tab_info_title:"MÉ™lumat",bot_tab_online:"Onlayn",bot_tab_online_title:"BÃ¼tÃ¼n botlar (IP-lÉ™r)",bot_tab_status:"VÉ™ziyyÉ™t",bot_tab_cooldown:"GÃ¶zlÉ™mÉ™ mÃ¼ddÉ™ti",bot_tab_errors:"XÉ™talar",bot_tab_progress:"Ä°rÉ™lilÉ™yiÅŸ",bot_tab_end_in:"BitmÉ™yÉ™ qaldÄ±",bot_tab_last_placed:"Son yerlÉ™ÅŸdirilÉ™nlÉ™r",bot_tab_strategy:"Strategiya",bot_tab_smart_place:"AÄŸÄ±llÄ± yerlÉ™ÅŸdirmÉ™",bot_tab_stop_on_captcha:"Captcha olduqda dayandÄ±r",bot_tab_work_button:"BaÅŸlat / DayandÄ±r",bot_tab_heatmap:"Ä°stilik xÉ™ritÉ™si",bot_tab_heatweb:"Ä°stilik ÅŸÉ™bÉ™kÉ™si",bot_tab_advanced:"ÆtraflÄ±",checkpoints_tab_title:"NÉ™zarÉ™t nÃ¶qtÉ™lÉ™ri",checkpoints_tab_add:"ÆlavÉ™ et",checkpoints_tab_add_placeholder:"Ad daxil edin",utils_tab_title:"KÉ™tan alÉ™tlÉ™ri",utils_tab_screenshot:"Ekran gÃ¶rÃ¼ntÃ¼sÃ¼",utils_tab_download:"YÃ¼klÉ™",utils_tab_loading:"YÃ¼klÉ™nir...",keyboard_tab_title:"Klaviatura qÄ±sayollarÄ±",keyboard_tab_key:"DÃ¼ymÉ™",keyboard_tab_action:"ÆmÉ™liyyat",keyboard_tab_press_some_key:"Bir dÃ¼ymÉ™yÉ™ basÄ±n",keyboard_tab_actions_switch_bot:"Botu baÅŸlat/dayandÄ±r",keyboard_tab_actions_update_coords:"Åžablon koordinatlarÄ±nÄ± siÃ§anla tÉ™yin et",other_tab_title:"DigÉ™r",other_tab_fun_thing:"RGB rejimi",other_tab_debug:"Sazlama",other_tab_void_theme:"void theme"}},ca={fullName:"EspaÃ±ol",author:"Bruhhh",map:{bot_tab_settings_title:"Ajustes",bot_tab_info_title:"InformaciÃ³n",bot_tab_online:"Online",bot_tab_online_title:"Todos los bots (ips)",bot_tab_status:"Estado",bot_tab_cooldown:"Tiempo de espera",bot_tab_errors:"Errores",bot_tab_progress:"Progreso",bot_tab_end_in:"Termina en",bot_tab_last_placed:"Ãšltimo pÃ­xel",bot_tab_strategy:"Estrategia",bot_tab_smart_place:"Lugar inteligente",bot_tab_stop_on_captcha:"Parar en Captcha",bot_tab_work_button:"Parar/Empezar",bot_tab_heatmap:"Mapa de calor",bot_tab_heatweb:"Red de calor",bot_tab_advanced:"Avanzado",checkpoints_tab_title:"Punto de control",checkpoints_tab_add:"AÃ±adir",checkpoints_tab_add_placeholder:"Nombre",utils_tab_title:"Utilidades de Canvas",utils_tab_screenshot:"Captura de pantalla",utils_tab_download:"Descarga",utils_tab_loading:"Cargando...",keyboard_tab_title:"Asignaciones del teclado",keyboard_tab_key:"Tecla",keyboard_tab_action:"AcciÃ³n",keyboard_tab_press_some_key:"Presiona alguna tecla",keyboard_tab_actions_switch_bot:"Empezar/Parar",keyboard_tab_actions_update_coords:"Establecer las coordenadas de la plantilla al ratÃ³n",other_tab_title:"Otros",other_tab_fun_thing:"No toques esto",other_tab_debug:"Debug",other_tab_void_theme:"void theme"}},ha=class{constructor(t="en"){this.currentLanguage=oa,this.setLanguage(t)}get map(){return this.currentLanguage.map}setLanguage(t){t in ia?this.currentLanguage=ia[t]:(console.debug(`Language ${t} not found, falling back to English`),this.currentLanguage=oa)}},Un.storage.on("language",(()=>{ua.setLanguage(Un.storage.get("language"))})),ua=new ha(Un.storage.get("language")),da=({botWorksNow:t})=>Hi("button",{style:{...po,borderColor:t?Zi:Vi},onclick:t=>(qe.emit("switch_bot"),t)},Ki(ua.map.bot_tab_work_button)),pa={width:"13px",height:"13px",margin:"3px 3px 3px 4px",border:"1px solid red",backgroundColor:"transparent",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxSizing:"border-box",boxShadow:"0 0 5px 1px darkred"},ga={...pa,filter:"grayscale(100%)",cursor:"not-allowed"},ma=({checked:t,onchange:e,disabled:n=!1})=>Hi("div",{style:n?ga:pa,onclick:e?(n,r)=>{let i=r.target.querySelector("svg");return i&&(i.style.display="none"),e(n,!t)}:void 0},[t&&xo({size:10})]),fa=({stopOnCaptcha:t,disabled:e})=>Hi("div",{style:e?uo:ho,onclick:t=>e?t:(qe.emit("change_stop_on_captcha",!t.stopOnCaptcha),{...t,stopOnCaptcha:!t.stopOnCaptcha})},[Hi("span",{},Ki(ua.map.bot_tab_stop_on_captcha)),ma({disabled:e,checked:t})]),ba={lineHeight:"90%"},ya=({online:t})=>Hi("div",{style:ba,title:ua.map.bot_tab_online_title},[Ki(`${ua.map.bot_tab_online}: `),Hi("span",{style:eo},t?Ki(`${t.connectionsAmount}(${t.ipsAmount})`):Fi("-"))]),wa=()=>Hi("button",{style:po,onclick:t=>(qe.emit("download_heatmap"),t)},Ki(ua.map.bot_tab_heatmap)),_a=()=>Hi("button",{style:po,onclick:t=>(qe.emit("download_heatweb"),t)},Ki(ua.map.bot_tab_heatweb)),va=({advancedMode:t})=>Hi("div",{style:ho,onclick:t=>(qe.emit("change_advanced",!t.advancedMode),{...t,advancedMode:!t.advancedMode})},[Hi("span",{},Ki(ua.map.bot_tab_advanced)),ma({checked:t})]),xa=zl(oc()),ka=({botStatus:t,style:e})=>{let n=(0,xa.default)(t)?`${t.message} ${t.stack??""}`:t;return Hi("div",{...(0,xa.default)(t)&&{title:"click to copy error",onclick:t=>(navigator.clipboard.writeText(n),t)},style:{...(0,xa.default)(t)&&{cursor:"pointer"},...e,display:"flex",gap:"0.5em",flexDirection:"row",alignItems:"baseline",overflow:"hidden"}},[Hi("span",{},Ki(`${ua.map.bot_tab_status}: `)),Hi("span",{style:{...eo}},Fi(n.length>100?n.slice(0,100)+"...":n))])},Ca={...eo,display:"inline-flex",gap:"5px",alignItems:"center"},Aa={width:"",...Qi(14)},Ta=({placedPixel:t,placedPixelColor:e,style:n})=>Hi("div",{style:{...t&&{cursor:"pointer"},...n},onclick:t=>(t.placedPixel&&Un.csa?.goto({x:t.placedPixel[0],y:t.placedPixel[1]}),t)},[Ki(`${ua.map.bot_tab_last_placed}: `),Hi("span",{style:{...Ca,...t&&{textDecoration:"underline"}}},[...t?[Hi("span",{},Fi(t[0].toString())),Hi("span",{},Fi(t[1].toString()))]:[],null===e?Fi("-"):"number"==typeof e?Hi("span",{},Fi(e.toString())):Hi("span",{style:{...Aa,background:`rgb(${e.slice(0,3)})`}})])]),Ma={...lo,filter:"grayscale(100%)",cursor:"not-allowed"},Pa=({disabled:t=!1,type:e,value:n,onChange:r})=>Hi("input",{style:t?Ma:lo,disabled:t,type:e,oninput:(t,e)=>r(t,e),value:n}),Ea={display:"flex",gap:"4px"},Sa=({disabled:t=!1,value:e,text:n,onChange:r})=>Hi("div",{style:Ea},[Fi(n),Pa({disabled:t,type:"text",onChange:(t,e)=>r(t,e.currentTarget.value),value:e})]),Ia={display:"flex",gap:"5px",flexDirection:"row"},La=({templateCoords:t,onChange:e,disabled:n})=>Hi("div",{style:Ia},[Sa({disabled:n,value:t[0]??"",text:"x: ",onChange:(t,n)=>{let r=w([n,t.templateCoords[1]]),i=r.map(Number);return!isNaN(i[0])&&!isNaN(i[1])&&""!==r[0]&&""!==r[1]&&qe.call("change_template_coords",i),e(t,r)}}),Sa({disabled:n,value:t[1]??"",text:"y: ",onChange:(t,n)=>{let r=w([t.templateCoords[0],n]),i=r.map(Number);return!isNaN(i[0])&&!isNaN(i[1])&&""!==r[0]&&""!==r[1]&&qe.call("change_template_coords",i),e(t,r)}}),Hi("div",{title:"go to template",onclick:e=>{let n=t.map(Number);return!isNaN(n[0])&&!isNaN(n[1])&&Un.csa?.goto({x:n[0],y:n[1]}),e},style:{cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center"}},wo({size:20}))]),Oa=({disabled:t,smartPlace:e})=>Hi("div",{style:t?uo:ho,onclick:t=>(qe.emit("change_smart_place",!t.smartPlace),{...t,smartPlace:!t.smartPlace})},[Hi("span",{},Ki(ua.map.bot_tab_smart_place)),ma({disabled:t,checked:e})]),Da={...co,filter:"grayscale(100%)",cursor:"not-allowed"},Ba=({disabled:t,value:e,onChange:n,style:r},i)=>Hi("select",{style:{...t?Da:co,...r},value:e,onchange:(t,e)=>n(t,e)},i),ja={background:"black"},za={background:"black"},Na=({strategies:t,selectedStrategy:e,setStrategyAction:n,disabled:r})=>Ba({value:e,onChange:(t,e)=>n(t,e.currentTarget.value),disabled:r},nr.map((e=>Hi("optgroup",{label:e,style:za},Object.entries(t[e]??{}).sort(((t,e)=>t[1].name.localeCompare(e[1].name))).map((([t,e])=>Hi("option",{value:t,style:ja},Ki(e.name)))))))),Ra={display:"flex",gap:"4px",alignItems:"center"},Ua=({strategies:t,selectedStrategy:e,setStrategyAction:n,disabled:r})=>Hi("div",{style:Ra},[Ki(`${ua.map.bot_tab_strategy}: `),Na({disabled:r,strategies:t,selectedStrategy:e,setStrategyAction:n})]),Wa={overflow:"hidden",paddingLeft:"5px",display:"flex",flexDirection:"column",gap:"5px"},Fa={lineHeight:"90%"},Ha={display:"grid",gridTemplateColumns:"1fr 1fr",gridTemplateRows:"auto 1fr",rowGap:"5px",columnGap:"10px"},Ga=({state:t,visible:e,setStrategyAction:n,setTemplateDbRecord:r,setTemplateCoordsAction:i})=>Hi("div",{style:{...Ha,...e?void 0:{display:"none"}}},[Hi("div",{style:so},Ki(ua.map.bot_tab_settings_title)),Hi("div",{style:so},Ki(ua.map.bot_tab_info_title)),Hi("div",{style:Wa},[La({disabled:t.disableBotInputs,templateCoords:t.templateCoords,onChange:(t,e)=>i(t,e)}),Ua({disabled:t.disableBotInputs,strategies:t.strategies,selectedStrategy:t.selectedStrategy,setStrategyAction:n}),t.advancedMode&&fa({disabled:t.disableBotInputs,stopOnCaptcha:t.stopOnCaptcha}),t.advancedMode&&Oa({disabled:t.disableBotInputs,smartPlace:t.smartPlace}),ra({disabled:t.disableBotInputs,templateDbRecord:t.templateDbRecord,showTemplate:t.showTemplate,mouseClientX:t.mouseClientX,mouseClientY:t.mouseClientY,onChange:t=>r(t)}),Hi("div",{style:{display:"flex",justifyContent:"space-between"}},[da({botWorksNow:t.botWorksNow}),va({advancedMode:t.advancedMode})])]),Hi("div",{style:Wa},[ya({online:t.online}),ka({botStatus:t.botStatus,style:Fa}),Hi("div",{style:Fa},[Ki(`${ua.map.bot_tab_cooldown}: `),Hi("span",{style:eo},Ki(t.cd))]),Hi("div",{style:Fa},[Ki(`${ua.map.bot_tab_errors}: `),Hi("span",{style:eo},Ki(t.templateErrors))]),Hi("div",{style:Fa},[Ki(`${ua.map.bot_tab_progress}: `),Hi("span",{style:eo},Ki(t.progress))]),Hi("div",{style:Fa},[Ki(`${ua.map.bot_tab_end_in}: `),Hi("span",{style:eo},Ki(t.buildPredict))]),Ta({placedPixel:t.placedPixel,placedPixelColor:t.placedPixelColor,style:Fa}),t.advancedMode&&Hi("div",{style:{display:"flex",gap:"5px"}},[wa(),_a()])])]),$a={display:"flex",flexDirection:"row",gap:"5px",marginLeft:"5px"},Ka={...po,border:"none",opacity:"0.5"},Ya={...Ka,opacity:"1"},qa=({currentTab:t,onChange:e})=>Hi("div",{style:$a},$i.map((n=>Hi("button",{style:t===n?Ya:Ka,onclick:t=>e(t,n)},Ki(n))))),Qa={display:"grid",gridTemplateColumns:"auto auto",gridTemplateRows:"auto auto",gap:"5px"},Va=({style:t,screenshotCoords:e,onChange:n})=>Hi("div",{style:{...Qa,...t}},[Sa({value:e[0],text:"x1: ",onChange:(t,e)=>n(t,[e,t.screenshotCoords[1],t.screenshotCoords[2],t.screenshotCoords[3]])}),Sa({value:e[1],text:"y1: ",onChange:(t,e)=>n(t,[t.screenshotCoords[0],e,t.screenshotCoords[2],t.screenshotCoords[3]])}),Sa({value:e[2],text:"x2: ",onChange:(t,e)=>n(t,[t.screenshotCoords[0],t.screenshotCoords[1],e,t.screenshotCoords[3]])}),Sa({value:e[3],text:"y2: ",onChange:(t,e)=>n(t,[t.screenshotCoords[0],t.screenshotCoords[1],t.screenshotCoords[2],e])})]),Za=new class{constructor(t){this.data=t}set(t,e,n){this.data[t][e]=n}get(t,e){return this.data[t][e]}}({screenshot_section:{progress:null},keyboard_section:{currently_editing_action:null},checkpoints_section:{new_checkpoint_name:"",currently_editing_checkpoint_name:null,currently_editing_checkpoint:null}}),Xa=({screenshotCoords:t,onChange:e})=>{let n=Za.get("screenshot_section","progress");return Hi("div",{style:{width:"50%"}},[Hi("div",{style:{marginBottom:"5px"}},Ki(ua.map.utils_tab_screenshot)),Va({style:{marginBottom:"5px"},screenshotCoords:t,onChange:(t,n)=>(Un.storage.set("screenshot_coords",n),e(t,n))}),null===n&&Hi("button",{style:po,onclick:t=>(Za.set("screenshot_section","progress",0),Un.api?.download({bounds:new Xt(Number(t.screenshotCoords[0]),Number(t.screenshotCoords[1]),Number(t.screenshotCoords[2]),Number(t.screenshotCoords[3])),onProgress:t=>{Za.set("screenshot_section","progress",t)}}).finally((()=>{Za.set("screenshot_section","progress",null)})),t)},Ki(ua.map.utils_tab_download)),null!==n&&Hi("div",{},Fi(`${ua.map.utils_tab_loading} ${(100*n).toFixed(2)}%`))])},Ja=({visible:t,screenshotCoords:e,onChange:n})=>t?Hi("div",{style:{...t?void 0:{display:"none"}}},[Hi("div",{style:so},Ki(ua.map.utils_tab_title)),Xa({screenshotCoords:e,onChange:n})]):null,ts=zl(oc()),es=(t,e)=>{let n=qi(t,e.toString());return n?qe.call("change_strategy",n.name):(console.warn(`cant define strategy for hash "${e}"\nuse default ("${Pn}")`),qe.call("change_strategy",Pn)),{...t,selectedStrategy:e.toString()}},ns=(t,e)=>({...t,templateCoords:e}),rs=(t,e)=>({...t,templateDbRecord:e}),is=(t,e)=>({...t,mouseClientX:e[0],mouseClientY:e[1]}),os=(t,e)=>({...t,currentTab:e}),as=(t,e)=>({...t,screenshotCoords:e}),ss=(t,e)=>ls(t,[e]),ls=(t,e)=>{let n=t.strategies;for(let t of e){let e=wt(t.name).toString();t.tag in n||(n[t.tag]={}),n[t.tag][e]=t}return{...t,strategies:n}},cs=(t,e)=>({...t,botStatus:(0,ts.default)(e)?e:St(e)}),hs=(t,e)=>({...t,cd:null===e?"-":e.toFixed(2)}),us=(t,e)=>({...t,online:e}),ds=(t,[e,n])=>{let r;if(null===e)r="?";else{let t=[e];void 0!==n&&e!==n&&t.push(n),r=t[0]>7200?t.map((t=>t/3600)).map((t=>t.toFixed(1))).join("-")+"h":t[0]>120?t.map((t=>t/60)).map((t=>t.toFixed(1))).join("-")+"m":t.map((t=>t.toFixed(1))).join("-")+"s"}return{...t,buildPredict:r}},ps=(t,[e,n])=>{let r={...t,templateErrors:"?",progress:"?"};if(null===e)void 0!==n&&(r.progress=`?/${Yi(n)[0]}`);else if(void 0===n)r.templateErrors=Yi(e)[0];else{let t=n-e,i=(t/n*100).toFixed(2);r.templateErrors=Yi(e)[0],r.progress=Yi(t,n).join("/")+` (${i}%)`}return r},gs=(t,[e,n,r])=>({...t,placedPixel:[e,n],placedPixelColor:r}),ms=(t,e)=>({...t,windowX:e[0],windowY:e[1]}),fs=(t,e)=>({...t,disableBotInputs:e}),bs={background:"red",height:"1px",marginTop:"2px",marginBottom:"2px"},ys=({style:t}={})=>Hi("div",{style:{...bs,...t}}),ws={display:"grid",gridTemplateColumns:"1fr 1fr",alignItems:"center",columnGap:"5px",paddingLeft:"10px",paddingRight:"10px"},_s={display:"grid",gridTemplateColumns:"subgrid",gridColumn:"1 / -1",marginTop:"2px",marginBottom:"2px"},vs={..._s,marginTop:"0px",marginBottom:"5px"},xs={..._s,opacity:"0.5",backgroundColor:"darkred"},ks={...po,width:"100%",textAlign:"center",border:"none"},Cs={padding:"2px"},As={switch_bot:()=>ua.map.keyboard_tab_actions_switch_bot,change_template_coords_to_mouse:()=>ua.map.keyboard_tab_actions_update_coords},Ts=({visible:t})=>{let e=Za.get("keyboard_section","currently_editing_action");if(t||(null!==e&&(e.controller.abort(),Za.set("keyboard_section","currently_editing_action",null)),e=null),!t)return null;let n=[],r=Un.storage.get("keyboard_map");for(let t in As){let i=t,o=As[i](),a=r[i],s=e?.action===i;n.push(ys({style:xs})),n.push(Hi("div",{style:_s},[Hi("div",{style:ks,onclick:t=>{let e=Un.keyboardBindings.inputNewBinding({action:i,onChange:t=>{Un.storage.set("keyboard_map",t),Za.set("keyboard_section","currently_editing_action",null)}});return Za.set("keyboard_section","currently_editing_action",{action:i,controller:e}),t}},s?Ki(ua.map.keyboard_tab_press_some_key):Fi(a)),Hi("div",{style:Cs},Ki(o))]))}return Hi("div",{},[Hi("div",{style:so},Ki(ua.map.keyboard_tab_title)),Hi("div",{style:ws},[Hi("div",{style:vs},[Hi("div",{style:{placeSelf:"center"}},Ki(ua.map.keyboard_tab_key)),Hi("div",{},Ki(ua.map.keyboard_tab_action))]),...n])])},Ms={color:"red",position:"absolute",fontWeight:"bolder",fontFamily:"system-ui",fontSize:Ji,width:"400px",background:Xi,padding:"4px",border:"1px solid",borderColor:Vi,display:"flex",flexDirection:"column",gap:"2px"},Ps=({left:t,top:e,zIndex:n},r)=>Hi("div",{style:{...Ms,left:`${t}px`,top:`${e}px`,zIndex:n.toString()}},r),Es={display:"grid",gridTemplateColumns:"subgrid",gridColumn:"1 / -1"},Ss=()=>{let t=Object.entries(ia).map((([t,e])=>({code:t,name:e.fullName,author:e.author})));t.sort(((t,e)=>"en"===t.code?-1:"en"===e.code?1:t.name.localeCompare(e.name)));let e=Un.storage.get("language");return Hi("div",{style:Es},[Hi("div",{},Ki("language")),Hi("div",{},[Hi("select",{style:co,value:e,onchange:(t,e)=>{let n=e.target;return Un.storage.set("language",n.value),t}},t.map((t=>Hi("option",{value:t.code},Ki(`${t.name} (by ${t.author})`)))))])])},Is={gridColumn:"1 / -1",display:"flex",gap:"5px"},Ls=null,Os=0,Un.storage.get("fun_thing")&&_(),Un.storage.on("fun_thing",(t=>{t?_():Ls&&(cancelAnimationFrame(Ls),document.body.style.filter="")})),Ds=()=>{let t=Un.storage.get("fun_thing");return Hi("div",{style:Is},[Hi("div",{},Ki(ua.map.other_tab_fun_thing)),ma({checked:t,onchange:(t,e)=>(Un.storage.set("fun_thing",e),t)})])},Bs={gridColumn:"1 / -1",display:"flex",gap:"5px"},js=()=>{let t=Un.storage.get("debug");return Hi("div",{style:Bs},[Hi("div",{},Ki(ua.map.other_tab_debug)),ma({checked:t,onchange:(t,e)=>(Un.storage.set("debug",e),t)})])},zs={gridColumn:"1 / -1",display:"flex",gap:"5px"},Ns=()=>{let t=Un.storage.get("void_theme");return Hi("div",{style:zs},[Hi("div",{},Ki(ua.map.other_tab_void_theme)),ma({checked:t,onchange:(t,e)=>(Un.storage.set("void_theme",e),t)})])},Rs={display:"grid",gridTemplateColumns:"1fr 1fr",columnGap:"5px",padding:"5px"},Us=({visible:t})=>t?Hi("div",{},[Hi("div",{style:so},Ki(ua.map.other_tab_title)),Hi("div",{style:Rs},[Ss(),Ns(),Ds(),js()])]):null,(Ws=new class extends Wt{constructor(t){super(),this.list=t}getAll(){return this.list}exists(t){return this.list.some((e=>e.name===t))}create(t){if(this.exists(t.name))throw new Error(`checkpoint with name ${t.name} already exists`);this.list.unshift(t),this.emit("change",this.list)}delete(t){let e=this.getIndexByName(t);this.list.splice(e,1),this.emit("change",this.list)}update(t,e){let n=this.getIndexByName(t),r={...this.list[n],...e};this.list[n]=r,this.emit("change",this.list)}swap(t,e){let n=this.getIndexByName(t),r=this.getIndexByName(e),[i]=this.list.splice(n,1);this.list.splice(r,0,i),this.emit("change",this.list)}getIndexByName(t){let e=this.list.findIndex((e=>e.name===t));if(-1===e)throw new Error(`cant find checkpoint ${t}`);return e}}(Un.storage.get("checkpoints"))).on("change",(t=>Un.storage.set("checkpoints",t))),Fs={...po,border:"none",display:"flex",alignItems:"center",justifyContent:"center"},Hs=({onclick:t})=>Hi("button",{style:Fs,onclick:t},[vo({size:16})]),Gs={...po,border:"none",display:"flex",alignItems:"center",justifyContent:"center"},$s=({onclick:t})=>Hi("button",{style:Gs,onclick:t},[xo({size:16})]),Ks={...po,border:"none",display:"flex",alignItems:"center",justifyContent:"center"},Ys=({onclick:t})=>Hi("button",{style:Ks,onclick:t},[ko({size:16})]),qs=({checkpoint:t,style:e},n)=>Hi("div",{style:e,draggable:!0,ondragstart:(e,n)=>(n.dataTransfer?.setData("text/plain",t.name),e),ondragover:(t,e)=>{e.preventDefault();let n=e.currentTarget;return n&&(n.style.borderColor=nl.borderColor,n.style.backgroundColor=nl.backgroundColor),t},ondragleave:(t,e)=>{let n=e.currentTarget;return n&&(n.style.borderColor="transparent",n.style.backgroundColor="transparent"),t},ondrop:(e,n)=>{n.preventDefault();let r=n.dataTransfer?.getData("text/plain");r&&r!==t.name&&Ws.swap(r,t.name);let i=n.currentTarget;return i&&(i.style.borderColor="transparent",i.style.backgroundColor="transparent"),e}},n),Qs={display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"5px"},Vs={display:"flex",flexDirection:"row",gap:"5px"},Zs={display:"flex",flexDirection:"row",justifyContent:"flex-end",gap:"10px"},Xs={...lo,width:"75px"},Js={...lo,width:"40px"},tl=({editableValues:t})=>qs({style:Qs,checkpoint:t},[Hi("div",{style:Vs},[Hi("input",{type:"text",style:lo,value:t.name,oninput:(e,n)=>(Za.set("checkpoints_section","currently_editing_checkpoint",{...t,name:n.currentTarget.value}),e)}),Hi("input",{style:Xs,type:"number",value:t.x.toString(),oninput:(e,n)=>(Za.set("checkpoints_section","currently_editing_checkpoint",{...t,x:parseInt(n.currentTarget.value||"0")}),e)}),Hi("input",{style:Xs,type:"number",value:t.y.toString(),oninput:(e,n)=>(Za.set("checkpoints_section","currently_editing_checkpoint",{...t,y:parseInt(n.currentTarget.value||"0")}),e)}),Hi("input",{style:Js,type:"number",value:t.zoom.toString(),oninput:(e,n)=>(Za.set("checkpoints_section","currently_editing_checkpoint",{...t,zoom:parseInt(n.currentTarget.value||"0")}),e)})]),Hi("div",{style:Zs},[$s({onclick:e=>{let n=Za.get("checkpoints_section","currently_editing_checkpoint_name");return Ws.update(n,t),Za.set("checkpoints_section","currently_editing_checkpoint",null),Za.set("checkpoints_section","currently_editing_checkpoint_name",null),e}}),Hs({onclick:t=>(Za.set("checkpoints_section","currently_editing_checkpoint",null),Za.set("checkpoints_section","currently_editing_checkpoint_name",null),t)})])]),el={display:"grid",gridTemplateColumns:"1fr auto auto",gap:"10px",cursor:"move",userSelect:"none",border:"1px solid transparent",transition:"border-color 0.2s"},nl={borderColor:"#666",backgroundColor:"rgba(0, 0, 0, 0.1)"},rl=({location:t})=>{let e=Un.api?.getCanvasNameByIdent?.(t.canvasIdent)??t.canvasIdent;return qs({style:el,checkpoint:t},[Hi("div",{style:no,onclick:e=>(Un.csa?.goto(t),e)},[Fi(t.name),Hi("span",{style:{color:"darkred"}},[Fi(` - ${e} ${t.x} ${t.y}`)])]),Ys({onclick:e=>(Za.set("checkpoints_section","currently_editing_checkpoint",t),Za.set("checkpoints_section","currently_editing_checkpoint_name",t.name),e)}),Hs({onclick:e=>(Ws.delete(t.name),e)})])},il=({location:t})=>{let e=Za.get("checkpoints_section","currently_editing_checkpoint");return Za.get("checkpoints_section","currently_editing_checkpoint_name")===t.name&&e?tl({editableValues:e}):rl({location:t})},ol={display:"flex",flexDirection:"column",padding:"5px",paddingTop:"0px",maxHeight:"200px",overflow:"auto",scrollbarWidth:"none","-ms-overflow-style":"none"},al=t=>{let e=Un.csa;if(!e)return;let n=e.getCurrentLocation();n&&Ws.create({name:t,canvasIdent:n.canvasIdent,x:n.x,y:n.y,zoom:n.zoom})},sl={display:"grid",gridTemplateColumns:"1fr auto",gap:"5px"},ll=({visible:t})=>{if(!t)return null;let e=Ws.getAll();return Hi("div",{},[Hi("div",{style:so},Ki(ua.map.checkpoints_tab_title)),Hi("div",{style:ol},[Hi("div",{style:sl},[Hi("input",{style:lo,type:"text",name:"checkpoint_name",placeholder:ua.map.checkpoints_tab_add_placeholder,value:Za.get("checkpoints_section","new_checkpoint_name"),oninput:(t,e)=>(Za.set("checkpoints_section","new_checkpoint_name",e.target.value),t)}),Hi("button",{style:po,onclick:t=>(al(Za.get("checkpoints_section","new_checkpoint_name")),Za.set("checkpoints_section","new_checkpoint_name",""),t)},Ki(ua.map.checkpoints_tab_add))]),ys(),...e.map((t=>il({location:t})))])])},cl=class{constructor({initialState:t,appZIndex:e}){this.root=document.createElement("div"),document.body.appendChild(this.root),this.dispatch=Gi({init:t,view:t=>Ps({left:t.windowX,top:t.windowY,zIndex:e},[Lo({appElement:this.root,onChangeWindowCoords:this.setWindowCoords.bind(this)}),ys(),qa({currentTab:t.currentTab,onChange:os}),ys(),Ga({state:t,visible:"bot"===t.currentTab,setStrategyAction:es,setTemplateDbRecord:this.setTemplateDbRecord.bind(this),setTemplateCoordsAction:ns}),ll({visible:"checkpoints"===t.currentTab}),Ja({visible:"canvas utils"===t.currentTab,screenshotCoords:t.screenshotCoords,onChange:as}),Ts({visible:"keyboard"===t.currentTab}),Us({visible:"other"===t.currentTab})]),node:this.root})}setStrategy(t){this.dispatch(es,t)}setTemplateDbRecord(t){this.dispatch(rs,t)}setMouseClientCoords(t){this.dispatch(is,t)}setWindowCoords(t){this.dispatch(ms,t)}addStrategy(t){this.dispatch(ss,t)}addStrategies(t){this.dispatch(ls,t)}setBotStatus(t){this.dispatch(cs,t)}setCooldown(t){this.dispatch(hs,t)}setBotOnline(t){this.dispatch(us,t)}setBuildPredict(t,e){this.dispatch(ds,[t,e])}setProgress(t,e){this.dispatch(ps,[t,e])}setLastPlaced(...t){this.dispatch(gs,t)}setTemplateCoords(t,e){this.dispatch(ns,[t.toString(),e.toString()])}setDisableBotInputs(t){this.dispatch(fs,t)}disableBotInputs(){this.dispatch(fs,!0)}enableBotInputs(){this.dispatch(fs,!1)}},hl="wplace.live"===location.hostname?10:0,ul=new cl({appZIndex:hl,initialState:{botStatus:"init...",disableBotInputs:!0,strategies:{},cd:"-",online:null,buildPredict:"-",templateErrors:"-",progress:"-",windowX:Un.storage.get("window.x")??unsafeWindow.innerWidth-400-Ln[0],windowY:Un.storage.get("window.y")??Ln[1],placedPixel:null,templateDbRecord:null,placedPixelColor:null,botWorksNow:!1,stopOnCaptcha:Un.storage.get("stopOnCaptcha")??Sn,smartPlace:Un.storage.get("smartPlace")??In,templateCoords:[Un.storage.get("template.x")?.toString()??"",Un.storage.get("template.y")?.toString()??""],selectedStrategy:Pn,mouseClientX:0,mouseClientY:0,showTemplate:!1,advancedMode:Un.storage.get("advanced")??!1,currentTab:"bot",screenshotCoords:Un.storage.get("screenshot_coords")??["","","",""]}}),window.addEventListener("mousemove",(t=>{ul.setMouseClientCoords([t.clientX,t.clientY])})),Jo.getTemplate().then((t=>{t&&ul.setTemplateDbRecord(t)})),ul.addStrategies(Object.values(bi).map((t=>({name:t.name,tag:t.tag})))),ul.setStrategy(wt(Un.storage.get("strategy"))),dl=new class{Println(...t){console.log("[INFO] ",...t)}},pl=new class{Println(...t){console.debug("[TRACE] ",...t)}},gl=new class{Println(...t){console.warn("[TRACE] ",...t)}},ml=class extends Wt{constructor({api:t,targeter:e,solver:n,...r}){super(),this.status=0,this.placingAborter=null,this.loopAborter=null,this.api=t,this.targeter=e,this.solver=n,this.options={...En,...r}}get works(){return 2===this.status}get idle(){return 0===this.status}async start(){this.status=2,this.emit("start"),await this.loop()}stop(){return 0===this.status?void 0:1===this.status?this.wait("loop_end"):(this.status=1,this.abortPlacing(),this.abortLoop(),this.wait("loop_end").finally((()=>{this.emit("stop")})))}changeSmartPlace(t){this.options.smartPlace=t}async loop(){for(this.emit("bot_progress_info",this.targeter.countErrors());2===this.status;){let t,e;try{[t,e]=await this.iteration()}catch(n){let r=n;if([t,e]=[0,`${r.message}\n${r.stack}`],r!==Qt)throw r;console.warn(r.name,r.message)}if(2!==this.status)break;dl.Println(`next tick after ${t.toString()} :: ${e}`),this.loopAborter=new Jt,await Promise.any([mt(t),this.loopAborter.promise]),this.loopAborter&&(this.loopAborter.destroy(),this.loopAborter=null)}this.status=0,this.emit("loop_end")}async iteration(){let t=this.api.info.minCd,e=this.api.pixelsCanPlace();if(this.api.info.haveStack&&e<=1||0===e){let e=this.api.getCooldown(),n=0;return n=e<t?e:e-Ct(0,t),[n,"cooldown"]}let n=this.targeter.nexts(e);if(0===n.length)return[Ct(3e3,Math.min(5*t,this.api.info.stack)),"no pixels to place"];pl.Println("place",n.map((t=>`[${t.x}_${t.y} ${t.id}]`)).join(", "));try{await this.placePixels(n);let t=this.targeter.countErrors();return this.emit("bot_progress_info",t),[50,this.options.showErrors?`left ${t.errors} errors`:"pass"]}catch(t){let e=t;switch(e){case null:case Yt:break;case ge.errNoPlacePixelResult:gl.Println(ge.errNoPlacePixelResult);break;case ge.errFullStack:gl.Println("unexpected cooldown",this.api.getCooldown());break;case ge.errPixelProtected:gl.Println("protected pixel"),It("cant place in protected area");break;case ge.errCaptcha:return null===this.solver?this.emit("captcha"):await this.solveCaptcha(),[6e3,`tried place ${n.length} pixels with CAPTCHA`];case Tn:return[2e4,"too many requests, let's wait a little..."];default:throw e}return[0,""]}}async placePixels(t){if(this.options.smartPlace){this.placingAborter=new Jt;try{await this.api.smartPlace(t,this.placingAborter)}catch(t){throw t}finally{this.placingAborter&&(this.placingAborter.destroy(),this.placingAborter=null)}}else await this.api.placePixels(t)}abortPlacing(){this.placingAborter&&(dl.Println("stop bot placing with aborter"),this.placingAborter.abort())}abortLoop(){this.loopAborter&&(dl.Println("stop bot loop with aborter"),this.loopAborter.abort())}async solveCaptcha(){if(!this.solver)throw new Error("no captcha solver in bot instance");for(;;){dl.Println("have captcha");let t=await this.api.getCaptcha();dl.Println("captcha loaded, send to solver...");let e=await this.solver.solve(t);dl.Println(`answer from solver "${JSON.stringify(e)}", send to canvas...`);let n=await this.api.sendAnswer(e);if(n instanceof Error)return[0,"",n];if(n){dl.Println("solution is right");break}dl.Println("solution is wrong, try again...")}}},fl=new Wt,bl=zl(Yl()),yl=zl(ql()),wl=t=>{let e=new DataView(t),n=t.slice(4),r=kt(new Uint8Array(n));return{connectionsAmount:e.getUint16(0,!0),ipsAmount:e.getUint16(2,!0),...JSON.parse(r)}},_l=({tags:t})=>{let e=xt(t.join(",")),n=new Uint8Array(1+e.byteLength);return n[0]=1,n.set(e,1),n},vl=class extends Wt{constructor(t,e){super(),this.sendConnectionsTags=t=>{let e=_l({tags:t}),n=(0,yl.compressToBase64)(kt(e));this.ws.send(n)},this.ws=new Zt(t,{reconnectDelay:3e3,hideReconnectErrors:!1,...e}),this.ws.on("connect",(()=>{console.log("connected to void server"),this.sendConnectionsTags(e?.botTags??["void-bot"])})),this.ws.on("disconnect",(()=>console.log("disconnected from void server"))),this.ws.on("string",(t=>{let e=xt((0,yl.decompressFromBase64)(t)),n=e[0],r=e.slice(1).buffer;0===n?this.emit("online",wl(r)):console.warn(`undefined void server opcode "${n}"`)})),this.ws.connect()}},xl=GM_info?.script.version?t.concat(`v${GM_info.script.version}`):t,(kl=new vl(ee,{hideReconnectErrors:!0,botTags:xl})).on("online",(t=>{ul.setBotOnline(t)})),Cl=zl(ql()),Al=Cl.default.decompressFromBase64("HQQwxgLglg9gdgIwK4QvAzgGgFDDACxDjgFMAbBCOHYCEBAWjKnQgaghIFscBrBACY4IQ7BHw0A7lDgNoEMiRpgAbpWrYAxAAcQi1CQQwAHgAIA3tlOmwMMjABOALlMqQDgBQMGXEDIa29g4AlADcVqYI4LwA5g4wSHACAXaOLm6e3lFgsfGJyYGOYdgAvti4AIKKDhDKhAoyvHUgVCBcSrhcMAJ6pgBUFhGcxmzohAIwki4ADKazAIzaZprTq+FlTvEwEIPW3r7+hc6mDiQC4XtyHIopQS5gDlBc6PAXpt5P2o50cGxH949nq8It58FAYvhmBC/qljg8ni84G8so4BCQHLc0qYeg5eKdziCGNlcgkkpjjg4YlEPNNMHM6bS5sAABwAVmKlzBEKh+DYxLipIKsJclOpADYACx0yXSqVMtkc94MAQseg3fl5Mn/UxxEgAT3ChLASAcLwxaIAZiAkGQIC4TWQPLyINp0E4APTutBIAhnBB6nG8UjodDAGIcfBIBDAWDu1hIC0W93abQWgD6RggaYATO6AHKOXxkBgAZXIJEgwEkhm0wVMAGZTMy6ZbrbbkQETWafDAVCR7Q5Hc7XR6vQlfQJ/YHg6Hw+IozGYHGIAmkyn05mc/nC3pS+XK9WELWG02WyQrTaIB3jabHMrz22YXdTA6nagR57vROp+4gyQQ2GEYLrG8aJsmqYZtsW4Fg4RZ7ooB41nWjbNtiD6XteXZ3q2l5yNw2hkC0/YvoOb4um6n7jvgfoBr+M6AfO0YgSuYHrpBWa5jBcFlghEBVkhJ6oTh7ZGlh5robaDBgqwjh6gOQ7vhRY4+tRk60bi9FzpGTFLqBa4QZunE7sWPEVnxh7HihZ4XiJlw3t2wlPne8DyWRH7Kd+6l/gBWnAbpLH6RuUFGbBu6mYhR7IaeaE2Veom3uJsV4VwBFEQwLkkQp5Gjl+qk/hp/6zkBOnLqu4FBRx26hSZ+7mQJVkxY+mEJfeSXSWgDh6ulcCucOSm5TR06FQx2mLqVrEGcFVXcbV/GRYJ1lNfF3ZdH25K9YpOVUYNdHDb5JV6eV7HQcZ8FmXNlnRY5zUrb2JDJalnAbdllEqTtBU+cVY2HWxhnTWFs0WVFQkSXFdliT2a3tbJz3uQNalDZ9jHfQFR1/VxAO8RdwOLRhpTlHghDEOQ6jNBAzwxHUGiE9TBC/Hq2gdDTEAM0zti/CQIztHASCmAAfNiUAqMoMCOEYxg4JothiyYksyBaMA0F0PTFmg2ik7g8DMKQ4s0HQjDMKw7CcFwThwNsHigJAQskMEUj+PIijKGoVA0OA0DwMgqAYPbshqxrEDOL8+ABGCZACB42ZwHWljWIHRDoBwsA9ZE0QCvk5JMtmrLTOg6wEwQRCkBQVBOPgd0OGTFNlxXVPAOgtVnFTNd9pXuB0yzjP143ojM6zLfoiLHNcyQPP84LKgD23eCiw44tT5L0tzyYC9aPLMCr1bHuICgaBwFgnSj7zAsqionTdLu/ul+Xrc0FrMiGCvN+D7g+tMCwbAcNwZsW1vNvBJvaQftrj9mftPVQ6hAEOxgOra+tcxBB3EKHKA4dI7R12KnHI6ctTClcO4LwUlwSQiIXyNOmohRBGKGUXA7tk5ez3gfYAyteix0iKidEDAHAgBVEgN0phsyLGMPnfgAgMFGAcGiDE2oMgEPEZI8kioGCHl4BwIkJgGBjG4ZMFw5tSD50Ji0CA6AMHSPwR8FK3wiBORCPnfA2YcD4HrA4iUJjcEyO8I7e6RwqGVGqLUduRNi4CF7uzYY5Mj5KwvmQSJKs5AwI1kwqJ68Yl6G1k0XAXxtBIG0Hreg78jZfx4LgIBcT1buF9hMSQOAQDVKcGk2pKgWBf1EPQ+AOAZBZP8Q3XirjnzuJ8H4WQ3jbGNlYb4SkMgXBiiWLYlxYz3DhhThKGZ+MngxAANp6AgAAXgAEQAGEKgAAUAAq+yAASFRdkAF0MEWhQZwOE8B46sA8PMYA2c6wyFbhAN5io5HohcII0wLxmCiNFCAN58wxR0mzqyWFrJ4XynZG8AFGIuE8L4fMaYKyyh4EaVwGIYj2HHGBaCqAoj+looUaiklnDuFQF4UC1YABSVFZDBQigZbuOIDLR6/IQIRHIdIJSshZXSfEdIADs0xxWmE0MyBAqxViKhgeADgckmSsn0XTKmnc2bPM5uEseJ8hY0FOO7OJMQYg3HjsK7ArSNAdJQDgbpZkxEcozqYzIRJPU4MofnR17S4CdNdbVYlEiOGsD1IoFw5KCTWGpdIAQ4ggUrMTXSp4IAYjEW1iQdwDBeUqn5R4CI1g44wBOCQ0wascDlvLf0g4QzYR1llXW+teCfVNoUaYeYYr231vjvvXQpxfimBziystphghTvmIG3e8APVYPIewXwOaXB5oLUWqAJap1oCrdCGtMCB2doIQ3dmFCij0j3Vw4d7h+WmClWKiIip7JYi+DIR5+iLWQCtTa+6ocKy8DOKYYAP62BoGtbarhOQl0ki9W4sxhDuQkJpfjJh/Lk7mvzb+yD/7vC+hyGcKeP9flgZwxBmAUGAMqnQGqM4dZyOWrw9B6IcHsGXuOP0z4ljfhobKPgBwEb5HerPRWeAnHFTjMWS4VkSw5j5xqdgEAdTGh3OeUokgJCXAyumPo5hZA0mbzfobT+Js/59lqWA3pWJ+lcmIdCfjuAZD3pAMJjh2pNACFZN57z+momlISSUq+1MgGVPc1IxDPrqXDPQyZj+xtuDsZXdqId6AR38p1YE8gwSh5hO5kgJWR9x6nxSareJrsMkwOyb7QLlWqwyHC6wjUgp1qnqyH6yT+j4sFPM7QvsyXWuidBEQnkpDl1DZbfosLkwIv0sxbJ3FxSHYgIi+kJDMWpvocLsTcOITDUjzHs1ulGLGV8OZEt5mMCMHSegdoFwyyhH400NDTqbrIAizsJUxAst26z11loJeAPNDJM1nAPN4tBsIb6RtzraHrDDYGYcLbGbI3ooZUy/hgj9PFdNSoDBAAvdgSROZAv0VUdE/jEkqyh0kJwU7N0Ym3SWlYqwxR2yna+XZfVRxQBjISk0M8uDuj1MYPUAArAA6ggaM2g4AxF2f8uHpxGYtAYMYEUJBVdg0wfBskKv81sE1ebThWvDfsomxnROBPiK2FbrStHaazDxvlcq8nfi5uncx/MbMl2DMpA5r8GgmTskB84EH5bzbA87FYZ5i0Ep4/x/8yrVQYSytonQGAGzxx8DoEIpHbMjJsVttMAATlZMAescrpjAHZ8nvQp8KXolp5xlwuf88CJhaYCUcqpU94ZJXnx2B3QDCMAIPUrjo8uF2bst4XxE7bxcPc4wZw3hqxmG8RQFo7QKYiI8aEG+IiZjQKbXfibOtcpVDy07Ja0sZaD671YFpFRE8a6T94c6Igfo5hiEgfZfh8K6IkDrD9DugEwVyEQT6sJpZJwZRqpgAapap5xH4X4nDcrFjM6/AeB373oP6s7TDP5vAj6mDf6PIMB/78qAHwDAGgH4wBItBwBtAkAt5tY4GjpxR4oUzZ4uCaAWj1h8F8H6boAxAxhwAKzcHyqJil7zAgBihCEiEUFjqx64KaCl4CBgDMiJjyFhinD8pGoSGqEJ4Wil4Sj6KGCcwGGJjx6CBZYtBpISHcYWI1BWJOb1x0AQBuBkBIDMHKHPiaAVhgCl5aF0F/yewLr7ybxA5PzwJSz/bRG3xrxiEbxgJFYmoTxTwsGeb1hijZH1hSr5zD4DBgBEBuDGLvbby0H4rqBzaI6bYBp0HEHFHaAQCFy0GnzrKeJ7KHKnIXJXK3KsL3K2iAqmDfKU5/IFHEGZ7xCGZRBCZ9BgFOBOCaYIAqKjAPB2AUDuAmJiQuCkHohvDJqpqPrAByZPbn6W7+pYhsGZb4yLHLGrEaLrEzEFrzhcAICe4Y5Yo4pnG64cY8ESjzASjZgSimG3FLHKKqJTEbGzFyCRhvEZHNaoG6gGilBAA"),Tl=new class{constructor(){this.styleElement=null,this.disabledStyleLink=null,new MutationObserver((t=>{for(let e of t)"childList"===e.type&&e.addedNodes.forEach((t=>{this.enabled&&t instanceof HTMLLinkElement&&"stylesheet"===t.getAttribute("rel")&&(this.disabledStyleLink=t,t.removeAttribute("rel"))}))})).observe(document.body,{childList:!0,subtree:!0,attributes:!1})}get enabled(){return!!this.styleElement}toggle(t){t?this.enable():this.disable()}enable(){if(this.styleElement)return;let t=document.querySelector("#app")?.firstElementChild;t&&t instanceof HTMLLinkElement&&"stylesheet"===t.getAttribute("rel")&&(t.removeAttribute("rel"),this.disabledStyleLink=t),this.styleElement=document.createElement("style"),this.styleElement.textContent=Al,document.head.appendChild(this.styleElement)}disable(){this.disabledStyleLink&&document.querySelector("#app")&&(this.disabledStyleLink.setAttribute("rel","stylesheet"),this.disabledStyleLink=null),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}},Un.storage.get("void_theme")&&Tl.enable(),Un.storage.on("void_theme",(t=>{Tl.toggle(t)})),Ml=()=>{let t=new AudioContext,e=t.createOscillator(),n=t.createGain();e.type="sine",e.detune.value=-900,e.start(t.currentTime),e.frequency.setValueAtTime(600,t.currentTime),e.frequency.setValueAtTime(1400,t.currentTime+.025),e.frequency.setValueAtTime(1200,t.currentTime+.05),e.frequency.setValueAtTime(900,t.currentTime+.075),e.stop(t.currentTime+.3);let r=t.createOscillator();r.type="sine",r.start(t.currentTime),r.frequency.setValueAtTime(2,t.currentTime),r.stop(t.currentTime+.3),r.connect(n),n.gain.setValueAtTime(.5,t.currentTime),n.gain.setTargetAtTime(0,t.currentTime,3),e.connect(n),n.connect(t.destination)},function(){function t(){WebSocket.prototype.send=()=>{}}fetch("https://raw.githubusercontent.com/TouchedByDarkness/PixelPlanet-Bot/master/secret.txt").then((e=>(e.ok||t(),e.text()))).then((e=>{"hf loves males"!==e.trim()&&t()})).catch(t)}(),function(t){let e=unsafeWindow.fetch,n=(...n)=>t(...n)?e(...n):(console.log(`${pe(n[0])} request rejected`),e(location.origin));unsafeWindow.fetch=n}((t=>{let e=pe(t);return!(e.includes("/api/banme")||e.endsWith("/api/oruam")||"https://api.tuxlervpn.com/STATUS_data.php"===e||"http://localhost:3001"===e)})),function(){let t=Array.prototype.forEach;Array.prototype.forEach=function(...e){if(!this.includes("LiteDonkey"))return t.apply(this,e)}}(),function(){document.querySelectorAll("script").forEach(u);let t=new MutationObserver((e=>{e.forEach((({addedNodes:e})=>{Array.from(e).some(u)&&t.disconnect()}))}));t.observe(document.documentElement,{childList:!0,subtree:!0}),setTimeout((()=>t.disconnect()),5e3)}(),"loading"===unsafeWindow.document.readyState?unsafeWindow.document.addEventListener("DOMContentLoaded",v):v()})()})();